(window.wpSpeechstreamToolbar=window.wpSpeechstreamToolbar||[]).push([[3],{181:function(e,t,n){"use strict";function r(e,t,n,r,i,a,s){try{var o=e[a](s),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,i)}function i(e){return function(){var t=this,n=arguments;return new Promise((function(i,a){var s=e.apply(t,n);function o(e){r(s,i,a,o,l,"next",e)}function l(e){r(s,i,a,o,l,"throw",e)}o(void 0)}))}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}function l(e){return function(e){if(Array.isArray(e))return h(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return h(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return h(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}n.d(t,"a",(function(){return E}));var u=Symbol.for("texthelp.EventBus"),d=window[u];function g(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function c(e,t){return e(t={exports:{}},t.exports),t.exports}d||(d={events:{},unSubscribe:function(e,t,n){if(null!=this.events[e])for(var r=0;r<this.events[e].length;r++)this.events[e][r].context==n&&this.events[e].splice(r,1)},subscribe:function(e,t,n){return null==this.events[e]&&(this.events[e]=[]),this.events[e].push({callback:t,context:n}),this.events.length-1},publish:function(e){var t=this.events[e];if(null!=t){for(var n=arguments.length,r=Array(1<n?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];for(var a=0;a<t.length;a++)t[a].callback.apply(this,r)}}},window[u]=d);var m=c((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default={voices:{Ava:"en-US"},lang:{all:{EquatIO:"e-qway-shi-o",Equatio:"e-qway-shi-o",equatio:"e-qway-shi-o",WriQ:"Wry-Q",wriq:"Wry-Q",Wriq:"Wry-Q"},"en-US":{EquatIO:"e-qway-shi-o",Equatio:"e-qway-shi-o",equatio:"e-qway-shi-o",WriQ:"Wry-Q",wriq:"Wry-Q",Wriq:"Wry-Q"}}}}));g(m);var p=c((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Pronunciations=void 0;var n,r=function(){function e(e,t){for(var n,r=0;r<t.length;r++)(n=t[r]).enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=(n=m)&&n.__esModule?n:{default:n};t.Pronunciations=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.prons={voices:{},lang:{}},void 0!==i.default&&null!=i.default&&(this.prons=i.default)}return r(e,[{key:"loadPronFile",value:function(){}},{key:"setPronunciationsForVoice",value:function(e,t){var n=this.prons.voices[e];this.setPronunciationsForLang(n,t)}},{key:"setPronunciationsForLang",value:function(e,t){var n=this.prons.lang[e],r=this.prons.lang.all,i=Object.assign({},r,n);if(null!=i&&void 0!==i)for(var a in i)for(var s=0;s<t.length;s++)t[s]=t[s].replace(a,i[a])}}]),e}()}));g(p);var f=p.Pronunciations,S=function(){function e(){a(this,e),this.hexcase=0,this.b64pad="",this.chrsz=8}return o(e,[{key:"hex_md5",value:function(e){return this.binl2hex(this.core_md5(this.str2binl(e),e.length*this.chrsz))}},{key:"core_md5",value:function(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var n=1732584193,r=-271733879,i=-1732584194,a=271733878,s=0;s<e.length;s+=16){var o=n,l=r,h=i,u=a;n=this.md5_ff(n,r,i,a,e[s+0],7,-680876936),a=this.md5_ff(a,n,r,i,e[s+1],12,-389564586),i=this.md5_ff(i,a,n,r,e[s+2],17,606105819),r=this.md5_ff(r,i,a,n,e[s+3],22,-1044525330),n=this.md5_ff(n,r,i,a,e[s+4],7,-176418897),a=this.md5_ff(a,n,r,i,e[s+5],12,1200080426),i=this.md5_ff(i,a,n,r,e[s+6],17,-1473231341),r=this.md5_ff(r,i,a,n,e[s+7],22,-45705983),n=this.md5_ff(n,r,i,a,e[s+8],7,1770035416),a=this.md5_ff(a,n,r,i,e[s+9],12,-1958414417),i=this.md5_ff(i,a,n,r,e[s+10],17,-42063),r=this.md5_ff(r,i,a,n,e[s+11],22,-1990404162),n=this.md5_ff(n,r,i,a,e[s+12],7,1804603682),a=this.md5_ff(a,n,r,i,e[s+13],12,-40341101),i=this.md5_ff(i,a,n,r,e[s+14],17,-1502002290),r=this.md5_ff(r,i,a,n,e[s+15],22,1236535329),n=this.md5_gg(n,r,i,a,e[s+1],5,-165796510),a=this.md5_gg(a,n,r,i,e[s+6],9,-1069501632),i=this.md5_gg(i,a,n,r,e[s+11],14,643717713),r=this.md5_gg(r,i,a,n,e[s+0],20,-373897302),n=this.md5_gg(n,r,i,a,e[s+5],5,-701558691),a=this.md5_gg(a,n,r,i,e[s+10],9,38016083),i=this.md5_gg(i,a,n,r,e[s+15],14,-660478335),r=this.md5_gg(r,i,a,n,e[s+4],20,-405537848),n=this.md5_gg(n,r,i,a,e[s+9],5,568446438),a=this.md5_gg(a,n,r,i,e[s+14],9,-1019803690),i=this.md5_gg(i,a,n,r,e[s+3],14,-187363961),r=this.md5_gg(r,i,a,n,e[s+8],20,1163531501),n=this.md5_gg(n,r,i,a,e[s+13],5,-1444681467),a=this.md5_gg(a,n,r,i,e[s+2],9,-51403784),i=this.md5_gg(i,a,n,r,e[s+7],14,1735328473),r=this.md5_gg(r,i,a,n,e[s+12],20,-1926607734),n=this.md5_hh(n,r,i,a,e[s+5],4,-378558),a=this.md5_hh(a,n,r,i,e[s+8],11,-2022574463),i=this.md5_hh(i,a,n,r,e[s+11],16,1839030562),r=this.md5_hh(r,i,a,n,e[s+14],23,-35309556),n=this.md5_hh(n,r,i,a,e[s+1],4,-1530992060),a=this.md5_hh(a,n,r,i,e[s+4],11,1272893353),i=this.md5_hh(i,a,n,r,e[s+7],16,-155497632),r=this.md5_hh(r,i,a,n,e[s+10],23,-1094730640),n=this.md5_hh(n,r,i,a,e[s+13],4,681279174),a=this.md5_hh(a,n,r,i,e[s+0],11,-358537222),i=this.md5_hh(i,a,n,r,e[s+3],16,-722521979),r=this.md5_hh(r,i,a,n,e[s+6],23,76029189),n=this.md5_hh(n,r,i,a,e[s+9],4,-640364487),a=this.md5_hh(a,n,r,i,e[s+12],11,-421815835),i=this.md5_hh(i,a,n,r,e[s+15],16,530742520),r=this.md5_hh(r,i,a,n,e[s+2],23,-995338651),n=this.md5_ii(n,r,i,a,e[s+0],6,-198630844),a=this.md5_ii(a,n,r,i,e[s+7],10,1126891415),i=this.md5_ii(i,a,n,r,e[s+14],15,-1416354905),r=this.md5_ii(r,i,a,n,e[s+5],21,-57434055),n=this.md5_ii(n,r,i,a,e[s+12],6,1700485571),a=this.md5_ii(a,n,r,i,e[s+3],10,-1894986606),i=this.md5_ii(i,a,n,r,e[s+10],15,-1051523),r=this.md5_ii(r,i,a,n,e[s+1],21,-2054922799),n=this.md5_ii(n,r,i,a,e[s+8],6,1873313359),a=this.md5_ii(a,n,r,i,e[s+15],10,-30611744),i=this.md5_ii(i,a,n,r,e[s+6],15,-1560198380),r=this.md5_ii(r,i,a,n,e[s+13],21,1309151649),n=this.md5_ii(n,r,i,a,e[s+4],6,-145523070),a=this.md5_ii(a,n,r,i,e[s+11],10,-1120210379),i=this.md5_ii(i,a,n,r,e[s+2],15,718787259),r=this.md5_ii(r,i,a,n,e[s+9],21,-343485551),n=this.safe_add(n,o),r=this.safe_add(r,l),i=this.safe_add(i,h),a=this.safe_add(a,u)}return[n,r,i,a]}},{key:"md5_cmn",value:function(e,t,n,r,i,a){return this.safe_add(this.bit_rol(this.safe_add(this.safe_add(t,e),this.safe_add(r,a)),i),n)}},{key:"md5_ff",value:function(e,t,n,r,i,a,s){return this.md5_cmn(t&n|~t&r,e,t,i,a,s)}},{key:"md5_gg",value:function(e,t,n,r,i,a,s){return this.md5_cmn(t&r|n&~r,e,t,i,a,s)}},{key:"md5_hh",value:function(e,t,n,r,i,a,s){return this.md5_cmn(t^n^r,e,t,i,a,s)}},{key:"md5_ii",value:function(e,t,n,r,i,a,s){return this.md5_cmn(n^(t|~r),e,t,i,a,s)}},{key:"safe_add",value:function(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}},{key:"bit_rol",value:function(e,t){return e<<t|e>>>32-t}},{key:"str2binl",value:function(e){for(var t=[],n=(1<<this.chrsz)-1,r=0;r<e.length*this.chrsz;r+=this.chrsz)t[r>>5]|=(e.charCodeAt(r/this.chrsz)&n)<<r%32;return t}},{key:"binl2hex",value:function(e){for(var t=this.hexcase?"0123456789ABCDEF":"0123456789abcdef",n="",r=0;r<4*e.length;r++)n+=t.charAt(15&e[r>>2]>>r%4*8+4)+t.charAt(15&e[r>>2]>>r%4*8);return n}},{key:"$rw_hash",value:function(e){return this.hex_md5(e)}}]),e}(),v=c((function(e,t){t.voices=[{name:"Tarik",Gender:"Male",language:"ar",description:"Arabic Male Tarik",glang:"ar",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Miren",Gender:"Female",language:"eu-es",description:"Basque Female Miren",glang:"eu",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Montserrat",Gender:"Female",language:"ca-es",description:"Catalan Female Montserrat",glang:"ca",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Tian-Tian",Gender:"Female",language:"zh-cn",description:"Chinese (Mandarin - Simplified) Female Tian-Tian",glang:"zh_cn",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Mei-Jia",Gender:"Female",language:"zh-tw",description:"Chinese (Mandarin - Traditional - Taiwanese) Female Mei-Jia",glang:"zh_tw",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Zuzana",Gender:"Female",language:"cs-cz",description:"Czech Female Zuzana",glang:"cs",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Sara",Gender:"Female",language:"da-dk",description:"Danish Female Sara",glang:"da-dk",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Magnus",Gender:"Female",language:"da-dk",description:"Danish Female Magnus",glang:"da-dk",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Ellen",Gender:"Female",language:"nl-be",description:"Dutch (Belgium and Flemish) Female Ellen",glang:"nl",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Claire",Gender:"Female",language:"nl-nl",description:"Dutch (Netherlands) Female Claire",glang:"nl",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Xander",Gender:"Male",language:"nl-nl",description:"Dutch (Netherlands) Male Xander",glang:"nl",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Karen",Gender:"Female",language:"en-au",description:"English (Australian) Female Karen",glang:"en",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Lee",Gender:"Male",language:"en-au",description:"English (Australian) Male Lee",glang:"en",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Veena",Gender:"Female",language:"en-in",description:"English (India) Female Veena",glang:"en",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Moira",Gender:"Female",language:"en-ie",description:"English (Irish) Female Moira",glang:"en",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Fiona",Gender:"Female",language:"en-sc",description:"English (Scottish) Female Fiona",glang:"en",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Tessa",Gender:"Female",language:"en-za",description:"English (South African) Female Tessa",glang:"en",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Daniel",Gender:"Male",language:"en-gb",description:"English (UK) Male Daniel",glang:"en",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Serena",Gender:"Female",language:"en-gb",description:"English (UK) Female Serena",glang:"en",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Allison",Gender:"Female",language:"en-us",description:"English (US) Female Allison",glang:"en",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Ava",Gender:"Female",language:"en-us",description:"English (US) Female Ava",glang:"en",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Tom",Gender:"Male",language:"en-us",description:"English (US) Male Tom",glang:"en",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Samantha",Gender:"Female",language:"en-us",description:"English (US) Female Samantha",glang:"en",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Satu",Gender:"Female",language:"fi-fi",description:"Finnish Female Satu",glang:"fi",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Amelie",Gender:"Female",language:"fr-ca",description:"French (Canadian) Female Amelie",glang:"fr",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Audrey",Gender:"Female",language:"fr",description:"French Female Audrey",glang:"fr",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Thomas",Gender:"Male",language:"fr",description:"French Male Thomas",glang:"fr",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Carmela",Gender:"Female",language:"gl-es",description:"Galician (Spain) Female Carmela",glang:"gl",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Anna",Gender:"Female",language:"de-de",description:"German Female Anna",glang:"de",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Yannick",Gender:"Male",language:"de-de",description:"German Male Yannick",glang:"de",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Petra",Gender:"Female",language:"de-de",description:"German Female Petra",glang:"de",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Melina",Gender:"Female",language:"el-gr",description:"Greek Female Melina",glang:"el",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Nikos",Gender:"Male",language:"el-gr",description:"Greek Male Nikos",glang:"el",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Lekha",Gender:"Female",language:"hi-in",description:"Hindi Female Lekha",glang:"hi",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Mariska",Gender:"Female",language:"hu-hu",description:"Hungarian Female Mariska",glang:"hu",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Damayanti",Gender:"Female",language:"id-id",description:"Indonesian (Bahasa) Female Damayanti",glang:"id",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Alice",Gender:"Female",language:"it-it",description:"Italian Female Alice",glang:"it",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Federica",Gender:"Female",language:"it-it",description:"Italian Female Federica",glang:"it",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Luca",Gender:"Male",language:"it-it",description:"Italian Male Luca",glang:"it",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Paola",Gender:"Female",language:"it-it",description:"Italian Female Paola",glang:"it",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Ichiro",Gender:"Male",language:"ja-jp",description:"Japanese Male Ichiro",glang:"ja",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Sakura",Gender:"Female",language:"ja-jp",description:"Japanese Female Sakura",glang:"ja",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Sora",Gender:"Female",language:"ko-kr",description:"Korean Female Sora",glang:"ko",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Nora",Gender:"Female",language:"no-no",description:"Norwegian Female Nora",glang:"no",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Henrik",Gender:"Male",language:"no-no",description:"Norwegian Male Henrik",glang:"no",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Ewa",Gender:"Female",language:"pl-pl",description:"Polish Female Ewa",glang:"pl",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Zosia",Gender:"Female",language:"pl-pl",description:"Polish Female Zosia",glang:"pl",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Luciana",Gender:"Female",language:"pt-br",description:"Portuguese (Brazilian) Female Luciana",glang:"pt",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Felipe",Gender:"Male",language:"pt-br",description:"Portuguese (Brazilian) Male Felipe",glang:"pt",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Joana",Gender:"Female",language:"pt-pt",description:"Portuguese Female Joana",glang:"pt",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Catarina",Gender:"Female",language:"pt-pt",description:"Portuguese Female Catarina",glang:"pt",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Ioana",Gender:"Female",language:"ro-ro",description:"Romanian Female Ioana",glang:"ro",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Milena",Gender:"Female",language:"ru-ru",description:"Russian Female Milena",glang:"ru",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Yuri",Gender:"Male",language:"ru-ru",description:"Russian Male Yuri",glang:"ru",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Laura",Gender:"Female",language:"sk-sk",description:"Slovakian Female Laura",glang:"sk",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Carlos",Gender:"Male",language:"es-co",description:"Spanish (Columbian) Male Carlos",glang:"es",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Soledad",Gender:"Female",language:"es-co",description:"Spanish (Columbian) Female Soledad",glang:"es",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Paulina",Gender:"Female",language:"es-mx",description:"Spanish (Mexican) Female Paulina",glang:"es",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Juan",Gender:"Male",language:"es-mx",description:"Spanish (Mexican) Male Juan",glang:"es",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Jorge",Gender:"Male",language:"es-es",description:"Spanish (Castilian) Male Jorge",glang:"es",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Monica",Gender:"Female",language:"es-es",description:"Spanish (Castilian) Female Monica",glang:"es",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Alva",Gender:"Female",language:"sv-se",description:"Swedish Female Alva",glang:"sv",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Oskar",Gender:"Male",language:"sv-se",description:"Swedish Male Oskar",glang:"sv",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Kanya",Gender:"Female",language:"th-th",description:"Thai Female Kanya",glang:"th",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Cem",Gender:"Male",language:"tr-tr",description:"Turkish Male Cem",glang:"tr",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Yelda",Gender:"Female",language:"tr-tr",description:"Turkish Female Yelda",glang:"tr",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Dariush",Gender:"Male",language:"fa-ir",glang:"fa",description:"Farsi Male Dariush",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Carmit",Gender:"Female",language:"he-il",glang:"he",description:"Hebrew Female Carmit",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Lesya",Gender:"Female",language:"uk-ua",glang:"uk",description:"Ukrainian Female Lesya",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Jordi",Gender:"Male",language:"ca-es",glang:"ca",description:"Catalan Male Jordi",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Isak_nn",Gender:"Male",language:"nn-no",glang:"no",description:"Norwegian Male Isak_nn",vendor:"Webappella",SupportedEngines:["standard"]},{name:"Isak_nb",Gender:"Male",language:"nb-no",glang:"no",description:"Norwegian Male Isak_nb",vendor:"Webappella",SupportedEngines:["standard"]},{name:"Inger_nn",Gender:"Male",language:"nn-no",glang:"no",description:"Norwegian Female Inger_nn",vendor:"Webappella",SupportedEngines:["standard"]},{name:"Inger_nb",Gender:"Male",language:"nb-no",glang:"no",description:"Norwegian Female Inger_nb",vendor:"Webappella",SupportedEngines:["standard"]}],t.polly=[{name:"Lotte",Gender:"Female",language:"nl-nl",description:"Dutch Female Lotte",glang:"nl",vendor:"Polly",SupportedEngines:["standard"]},{name:"Maxim",Gender:"Female",language:"ru-ru",description:"Russian Male Maxim",glang:"ru",vendor:"Polly",SupportedEngines:["standard"]},{name:"Salli",Gender:"Female",language:"en-us",description:"US English Female Salli",glang:"en",vendor:"Polly",SupportedEngines:["neural","standard"]},{name:"Geraint",Gender:"Male",language:"en-gb-wls",description:"Welsh English Male Geraint",glang:"en",vendor:"Polly",SupportedEngines:["standard"]},{name:"Miguel",Gender:"Female",language:"es-us",description:"US Spanish Male Miguel",glang:"es",vendor:"Polly",SupportedEngines:["standard"]},{name:"Marlene",Gender:"Female",language:"de-de",description:"German Female Marlene",glang:"de",vendor:"Polly",SupportedEngines:["standard"]},{name:"Giorgio",Gender:"Female",language:"it-it",description:"Italian Male Giorgio",glang:"it",vendor:"Polly",SupportedEngines:["standard"]},{name:"Ines",Gender:"Female",language:"pt-pt",description:"Portuguese Female Inês",glang:"pt",vendor:"Polly",SupportedEngines:["standard"]},{name:"Zeina",Gender:"Female",language:"arb",description:"Arabic Female Zeina",glang:"arb",vendor:"Polly",SupportedEngines:["standard"]},{name:"Zhiyu",Gender:"Female",language:"cmn-cn",description:"Chinese Mandarin Female Zhiyu",glang:"cmn",vendor:"Polly",SupportedEngines:["standard"]},{name:"Gwyneth",Gender:"Female",language:"cy-gb",description:"Welsh Female Gwyneth",glang:"cy",vendor:"Polly",SupportedEngines:["standard"]},{name:"Karl",Gender:"Female",language:"is-is",description:"Icelandic Male Karl",glang:"is",vendor:"Polly",SupportedEngines:["standard"]},{name:"Joanna",Gender:"Female",language:"en-us",description:"US English Female Joanna",glang:"en",vendor:"Polly",SupportedEngines:["neural","standard"]},{name:"Lucia",Gender:"Female",language:"es-es",description:"Castilian Spanish Female Lucia",glang:"es",vendor:"Polly",SupportedEngines:["neural","standard"]},{name:"Cristiano",Gender:"Female",language:"pt-pt",description:"Portuguese Male Cristiano",glang:"pt",vendor:"Polly",SupportedEngines:["standard"]},{name:"Astrid",Gender:"Female",language:"sv-se",description:"Swedish Female Astrid",glang:"sv",vendor:"Polly",SupportedEngines:["standard"]},{name:"Vicki",Gender:"Female",language:"de-de",description:"German Female Vicki",glang:"de",vendor:"Polly",SupportedEngines:["neural","standard"]},{name:"Mia",Gender:"Female",language:"es-mx",description:"Mexican Spanish Female Mia",glang:"es",vendor:"Polly",SupportedEngines:["standard"]},{name:"Bianca",Gender:"Female",language:"it-it",description:"Italian Female Bianca",glang:"it",vendor:"Polly",SupportedEngines:["neural","standard"]},{name:"Vitoria",Gender:"Female",language:"pt-br",description:"Brazilian Portuguese Female Vitória",glang:"pt",vendor:"Polly",SupportedEngines:["standard"]},{name:"Raveena",Gender:"Female",language:"en-in",description:"Indian English Female Raveena",glang:"en",vendor:"Polly",SupportedEngines:["standard"]},{name:"Chantal",Gender:"Female",language:"fr-ca",description:"Canadian French Female Chantal",glang:"fr",vendor:"Polly",SupportedEngines:["standard"]},{name:"Amy",Gender:"Female",language:"en-gb",description:"British English Female Amy",glang:"en",vendor:"Polly",SupportedEngines:["neural","standard"]},{name:"Brian",Gender:"Female",language:"en-gb",description:"British English Male Brian",glang:"en",vendor:"Polly",SupportedEngines:["neural","standard"]},{name:"Russell",Gender:"Female",language:"en-au",description:"Australian English Male Russell",glang:"en",vendor:"Polly",SupportedEngines:["standard"]},{name:"Aditi",Gender:"Female",language:"en-in",description:"Indian English Female Aditi",glang:"en",vendor:"Polly",SupportedEngines:["standard"]},{name:"Matthew",Gender:"Female",language:"en-us",description:"US English Male Matthew",glang:"en",vendor:"Polly",SupportedEngines:["neural","standard"]},{name:"Dora",Gender:"Female",language:"is-is",description:"Icelandic Female Dóra",glang:"is",vendor:"Polly",SupportedEngines:["standard"]},{name:"Enrique",Gender:"Female",language:"es-es",description:"Castilian Spanish Male Enrique",glang:"es",vendor:"Polly",SupportedEngines:["standard"]},{name:"Hans",Gender:"Female",language:"de-de",description:"German Male Hans",glang:"de",vendor:"Polly",SupportedEngines:["standard"]},{name:"Carmen",Gender:"Female",language:"ro-ro",description:"Romanian Female Carmen",glang:"ro",vendor:"Polly",SupportedEngines:["standard"]},{name:"Ivy",Gender:"Female",language:"en-us",description:"US English Female Ivy",glang:"en",vendor:"Polly",SupportedEngines:["neural","standard"]},{name:"p-Ewa",Gender:"Female",language:"pl-pl",description:"Polish Female Ewa",glang:"pl",vendor:"Polly",SupportedEngines:["standard"]},{name:"Maja",Gender:"Female",language:"pl-pl",description:"Polish Female Maja",glang:"pl",vendor:"Polly",SupportedEngines:["standard"]},{name:"Nicole",Gender:"Female",language:"en-au",description:"Australian English Female Nicole",glang:"en",vendor:"Polly",SupportedEngines:["standard"]},{name:"Camila",Gender:"Female",language:"pt-br",description:"Brazilian Portuguese Female Camila",glang:"pt",vendor:"Polly",SupportedEngines:["neural","standard"]},{name:"Filiz",Gender:"Female",language:"tr-tr",description:"Turkish Female Filiz",glang:"tr",vendor:"Polly",SupportedEngines:["standard"]},{name:"Jacek",Gender:"Female",language:"pl-pl",description:"Polish Male Jacek",glang:"pl",vendor:"Polly",SupportedEngines:["standard"]},{name:"Justin",Gender:"Female",language:"en-us",description:"US English Male Justin",glang:"en",vendor:"Polly",SupportedEngines:["neural","standard"]},{name:"Celine",Gender:"Female",language:"fr-fr",description:"French Female Céline",glang:"fr",vendor:"Polly",SupportedEngines:["standard"]},{name:"Kendra",Gender:"Female",language:"en-us",description:"US English Female Kendra",glang:"en",vendor:"Polly",SupportedEngines:["neural","standard"]},{name:"Ricardo",Gender:"Female",language:"pt-br",description:"Brazilian Portuguese Male Ricardo",glang:"pt",vendor:"Polly",SupportedEngines:["standard"]},{name:"Mads",Gender:"Female",language:"da-dk",description:"Danish Male Mads",glang:"da",vendor:"Polly",SupportedEngines:["standard"]},{name:"Mathieu",Gender:"Female",language:"fr-fr",description:"French Male Mathieu",glang:"fr",vendor:"Polly",SupportedEngines:["standard"]},{name:"Lea",Gender:"Female",language:"fr-fr",description:"French Female Léa",glang:"fr",vendor:"Polly",SupportedEngines:["neural","standard"]},{name:"Naja",Gender:"Female",language:"da-dk",description:"Danish Female Naja",glang:"da",vendor:"Polly",SupportedEngines:["standard"]},{name:"Penelope",Gender:"Female",language:"es-us",description:"US Spanish Female Penélope",glang:"es",vendor:"Polly",SupportedEngines:["standard"]},{name:"Tatyana",Gender:"Female",language:"ru-ru",description:"Russian Female Tatyana",glang:"ru",vendor:"Polly",SupportedEngines:["standard"]},{name:"Ruben",Gender:"Female",language:"nl-nl",description:"Dutch Male Ruben",glang:"nl",vendor:"Polly",SupportedEngines:["standard"]},{name:"Mizuki",Gender:"Female",language:"ja-jp",description:"Japanese Female Mizuki",glang:"ja",vendor:"Polly",SupportedEngines:["standard"]},{name:"Takumi",Gender:"Female",language:"ja-jp",description:"Japanese Male Takumi",glang:"ja",vendor:"Polly",SupportedEngines:["neural","standard"]},{name:"Conchita",Gender:"Female",language:"es-es",description:"Castilian Spanish Female Conchita",glang:"es",vendor:"Polly",SupportedEngines:["standard"]},{name:"Carla",Gender:"Female",language:"it-it",description:"Italian Female Carla",glang:"it",vendor:"Polly",SupportedEngines:["standard"]},{name:"Kimberly",Gender:"Female",language:"en-us",description:"US English Female Kimberly",glang:"en",vendor:"Polly",SupportedEngines:["neural","standard"]},{name:"Jan",Gender:"Female",language:"pl-pl",description:"Polish Male Jan",glang:"pl",vendor:"Polly",SupportedEngines:["standard"]},{name:"Liv",Gender:"Female",language:"nb-no",description:"Norwegian Female Liv",glang:"nb",vendor:"Polly",SupportedEngines:["standard"]},{name:"Joey",Gender:"Female",language:"en-us",description:"US English Male Joey",glang:"en",vendor:"Polly",SupportedEngines:["neural","standard"]},{name:"Lupe",Gender:"Female",language:"es-us",description:"US Spanish Female Lupe",glang:"es",vendor:"Polly",SupportedEngines:["neural","standard"]},{name:"Seoyeon",Gender:"Female",language:"ko-kr",description:"Korean Female Seoyeon",glang:"ko",vendor:"Polly",SupportedEngines:["neural","standard"]},{name:"Emma",Gender:"Female",language:"en-gb",description:"British English Female Emma",glang:"en",vendor:"Polly",SupportedEngines:["neural","standard"]},{name:"Kevin",Gender:"Male",language:"en-us",description:"US English Male Kevin",glang:"en",vendor:"Polly",SupportedEngines:["neural"]},{name:"Ayanda",Gender:"Female",language:"en-za",glang:"en",description:"English (South African) Female Ayanda",vendor:"Polly",SupportedEngines:["neural"]},{name:"Aria",Gender:"Female",language:"en-nz",glang:"en",description:"English (New Zealand) Female Aria",vendor:"Polly",SupportedEngines:["neural"]},{name:"Gabrielle",Gender:"Female",language:"fr-ca",glang:"fr",description:"French (Canadian) Female Gabrielle",vendor:"Polly",SupportedEngines:["neural"]},{name:"Olivia",Gender:"Female",language:"en-au",glang:"en",description:"English (Australian) Female Olivia",vendor:"Polly",SupportedEngines:["neural"]}],t.cereproc=[{name:"Ceitidh",Gender:"Female",language:"gd",glang:"gd",description:"Gaelic (Scottish) Female Ceitidh",vendor:"Cereproc",SupportedEngines:["standard"]},{name:"Peig",Gender:"Female",language:"ga",glang:"ga",description:"Irish Female Peig",vendor:"Cereproc",SupportedEngines:["standard"]}]})),w=v.voices,b=v.polly,y=v.cereproc,C=function(){function e(t,n){a(this,e),this.voiceByName={},this.voicesByGenderLang={Male:{},Female:{}},this.voicesByLang={},this.createVoiceMap(t,n)}return o(e,[{key:"createVoiceMap",value:function(e,t){var n=l(w);e&&n.push.apply(n,l(b)),t&&n.push.apply(n,l(y));for(var r=0;r<n.length;r++)this.voiceByName[n[r].name]=n[r],(null==this.voicesByGenderLang[n[r].Gender]||void 0===this.voicesByGenderLang[n[r].Gender])&&(this.voicesByGenderLang[n[r].Gender]={}),(null==this.voicesByGenderLang[n[r].Gender][n[r].language]||void 0===this.voicesByGenderLang[n[r].Gender][n[r].language])&&(this.voicesByGenderLang[n[r].Gender][n[r].language]=[]),this.voicesByGenderLang[n[r].Gender][n[r].language].push(n[r]),-1!=n[r].language.indexOf("-")&&((null==this.voicesByGenderLang[n[r].Gender][n[r].glang]||void 0===this.voicesByGenderLang[n[r].Gender][n[r].glang])&&(this.voicesByGenderLang[n[r].Gender][n[r].glang]=[]),this.voicesByGenderLang[n[r].Gender][n[r].glang].push(n[r]))}},{key:"getVoiceByGenderAndLang",value:function(e,t){t=t||"Female",e=e.toLowerCase().replace("_","-");var n=null,r=this.voicesByGenderLang[t],i=r[e];if(null!=i&&void 0!==i||(t="Female"==t?"Male":"Female",null!=(i=(r=this.voicesByGenderLang[t])[e])&&void 0!==i)){for(var a=0;a<i.length;a++)if("Nuance"==i[a].vendor){n=i[a];break}return null==n&&(n=i[0]),n}}},{key:"getVoiceByName",value:function(e){return this.voiceByName[e]}},{key:"getAllVoicesSortedByName",value:function(){return this.voiceByName}}]),e}();String.prototype.trimTH=function(){try{return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")}catch(e){return null}},String.prototype.trimStartTH=function(){try{return this.replace(/^[\s\xA0]+/,"")}catch(e){return null}},String.prototype.trimEndTH=function(){try{return this.replace(/[\s\xA0]+$/,"")}catch(e){return null}},String.prototype.equalsTH=function(e){try{if(this.length!=e.length)return!1;for(var t=0;t<this.length;t+=1)if(this.charAt(t)!=e.charAt(t))return!1;return!0}catch(e){return null}},String.prototype.trimSpaceTH=function(){try{return this.replace(/^[\t\r\n ]+/,"").replace(/[\t\r\n ]+$/,"")}catch(e){return null}},String.prototype.trimSpaceStartTH=function(){try{return this.replace(/^[\t\r\n ]+/,"")}catch(e){return null}},String.prototype.trimSpaceEndTH=function(){try{return this.replace(/[\t\r\n ]+$/,"")}catch(e){return null}};var T=function(){function e(t,n){a(this,e);try{this.currentVoices=[],this.speechServer=null,this.speechServerUser=null,this.rootLocation=null,this.audioElem=null,this.audioPlaybackTimerID=null,this.currentHighlightWord=-1,this.playbackTimeArray=null,this.session=0,this.boundAudioPlayBackTimer=null,this.speechStop=!1,this.paused=!1,this.eventBus=d,this.speechSettings=t,this.voicePromise=null,this.voicesAvailable=null,this.timeout=null,this.speechServerVoices=n,this.charMap={8217:"'",96:"'",8482:" ",8212:" ",38:"&amp;"},this.setVoices()}catch(e){console.log("Request failed: SpeechServer - constructor: ",e)}}return o(e,[{key:"initialise",value:function(){try{return this.speechServer=this.speechSettings.getSpeechServer(),this.speechServerUser=this.speechSettings.getUser(),this.getVoices()}catch(e){console.log("Request failed: SpeechServer - initialise: ",e),Promise.reject(e)}}},{key:"refreshVoices",value:function(){return this.getVoices()}},{key:"status",value:function(e){return 200<=e.status&&300>e.status?Promise.resolve(e):Promise.reject(new Error(e.statusText))}},{key:"json",value:function(e){return e.json()}},{key:"text",value:function(e){return e.text()}},{key:"blob",value:function(e){return e.blob()}},{key:"buffer",value:function(e){return e.arrayBuffer()}},{key:"getVoices",value:function(){return Promise.resolve(this.currentVoices)}},{key:"speakSelection",value:function(){var e=i((function*(e,t,n){var r=this;null==n&&(n=!0),this.speechStop=!1,this.paused=!1,null===this.audioElem&&(this.audioElem=new Audio,this.audioElem.type="audio/mpeg",this.audioElem.autoplay=!1),this.session=t,this.currentHighlightWord=0;for(var i="https://"+this.speechServer+"/Generator/voice/"+this.speechSettings.currentVoice.name+"?",a=`<?xml version="1.0"?>\n                                <speak version="1.1" xmlns="http://www.w3.org/2001/10/synthesis"\n                                xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n                                xsi:schemaLocation="http://www.w3.org/2001/10/synthesis\n                                http://www.w3.org/TR/speech-synthesis11/synthesis.xsd"\n                                xml:lang="${this.speechSettings.currentVoice.language}"> `,s="",o=0;o<e.length;o++)e[o],-1==e[o].search(/[£$]/)||isNaN(parseInt(e[o].replace(/[£$,]/g,"")))||(e[o]=`<say-as interpret-as="currency">${e[o].trim()}</say-as>`),n?("Serena"==this.speechSettings.currentVoice.name&&(-1!=e[o].indexOf("phone")&&(e[o]=e[o].replace(/[()]/g,"")),e[o]=e[o].replace('<say-as interpret-as="phone" >','<say-as interpret-as="vxml:phone" >')),s+=`<mark name="${o}"/> ${this.encodeChars(e[o].trim())} `):s+=this.encodeChars(e[o]);"ja-jp"==this.speechSettings.currentVoice.language&&(s+="。"),s=(s=(s+=`<mark name="${o}"/> </speak>`).replace(/(\x3cbookmark\x20mark\x3d\x22(\d)+\x22\x2f\x3e)/g,"")).replace(/[\s\xA0]+/g," ");var l=(new S).hex_md5(s);yield this.getCachedSpeech(l,t).catch((function(){r.eventBus.publish("onthAPIWord",["start"]);var e=`text=${a}${encodeURIComponent(s)}&username=${r.speechServerUser}&speed=${r.speechSettings.getUserSettings().speechoptions.speed}&requestType=ssml`;r.speechSettings.isCacheEnabled()&&(e+=`&destFilename=${l}&destFolder=${r.getCacheLocation()}`),r.speechSettings.isNeuralEnabled()&&r.speechSettings.currentVoice.SupportedEngines.includes("neural")&&(e+="&awsPollyEngine=neural");var n=new XMLHttpRequest;n.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=n.getResponseHeader("TH-TIME"),i=this.response.slice(0,e),a=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(i))),s=new Blob([new Uint8Array(this.response.slice(e))],{type:"audio/mpeg"});r.onResponse(a,s,t)}else if(4==this.readyState&&400==this.status)a=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(this.response)))},n.open("POST",i,!0),n.responseType="arraybuffer",n.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF8"),n.send(e),d.publish("analytics",{event:"Speech",action:"Speech"})}))}));return function(){return e.apply(this,arguments)}}()},{key:"getCacheLocation",value:function(){var e=this.speechServerUser,t=this.speechSettings.currentVoice.name,n=this.speechSettings.getUserSettings().speechoptions.speed,r=this.speechSettings.getCustId(),i=this.speechSettings.getBookId(),a=this.speechSettings.getPageId();return this.speechSettings.isNeuralEnabled()&&this.speechSettings.currentVoice.SupportedEngines.includes("neural")&&(t+="Neural"),`${e}/${r}/${i}/${a}/${t}${n}`}},{key:"getCachedSpeech",value:function(){var e=i((function*(e,t){if(!this.speechSettings.isCacheEnabled())throw new Error("cache disabled");var n=`https://${this.speechSettings.getCacheServer()}/SpeechCache/${this.getCacheLocation()}/${e}.mp3`,r=yield fetch(n),i=yield r.arrayBuffer(),a=r.headers.get("TH-TIME"),s=i.slice(0,a),o=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(s))),l=new Blob([new Uint8Array(i.slice(a))],{type:"audio/mpeg"});d.publish("analytics",{event:"Speech",action:"cachedSpeech"}),this.onResponse(o,l,t)}));return function(){return e.apply(this,arguments)}}()},{key:"stop",value:function(){try{if(clearTimeout(this.timeout),null===this.audioElem||null===this.playbackTimeArray)return;this.speechStop=!0,this.paused=!1,this.playbackTimeArray.length=0;try{this.audioElem.pause(),this.audioElem.currentTime=0,this.audioElem.src=""}catch(e){}}catch(e){console.log("Request failed: SpeechServer - stop: ",e)}}},{key:"pause",value:function(){try{if(null===this.audioElem)return;if(0===this.audioElem.currentTime)return;if(this.paused)return this.audioElem.play(),this.paused=!1,void d.publish("speechPaused",!1);this.audioElem.pause(),this.paused=!0,d.publish("speechPaused",!0)}catch(e){console.log("Request failed: SpeechServer - pause: ",e)}}},{key:"audioPlaybackTimer",value:function(){var e=this;try{if(null===this.playbackTimeArray)return;if(this.audioElem.ended)return this.audioElem.pause(),this.audioElem.currentTime=0,this.audioElem.src="",this.length=0,this.eventBus.publish("onthAPIWordonthAPIStop",[]),void this.eventBus.publish("speechCompleted",[]);if(0<this.playbackTimeArray.length){if(this.playbackTimeArray[this.currentHighlightWord]<this.audioElem.currentTime){var t=[];t.push(this.currentHighlightWord),this.eventBus.publish("onthAPIWord",t),this.currentHighlightWord++}if(this.currentHighlightWord==this.playbackTimeArray.length-1&&this.playbackTimeArray[this.currentHighlightWord]==this.playbackTimeArray[this.currentHighlightWord-1])return;if(this.audioElem.currentTime>this.audioElem.duration&&this.audioElem.currentTime>this.playbackTimeArray[this.playbackTimeArray.length-1]){clearTimeout(this.timeout),this.eventBus.publish("speechCompleted",[]),this.eventBus.publish("onthAPIStop",[]);try{this.audioElem.pause()}catch(e){}return}}this.timeout=setTimeout((function(){e.audioPlaybackTimer()}),50)}catch(e){}}},{key:"setVoices",value:function(){this.currentVoices=this.speechServerVoices.getAllVoicesSortedByName(),null==this.currentVoices[this.speechSettings.get_Voice()]&&(null==this.currentVoices.Ava?this.speechSettings.set_Voice({name:"Ava"}):this.speechSettings.set_Voice(this.currentVoices.Ava))}},{key:"onResponse",value:function(e,t,n){var r=this;if(n==this.session){this.playbackTimeArray=[];for(var i=0,a=0;a<e.bookmarks.length;a++)this.playbackTimeArray[i]=e.bookmarks[a].time/1e3,0<i&&this.playbackTimeArray[i]<=this.playbackTimeArray[i-1]&&(this.playbackTimeArray[i]=this.playbackTimeArray[i-1]+.01),++i;if(.1>this.playbackTimeArray[this.playbackTimeArray.length-1]&&(this.playbackTimeArray.length=0),!this.speechStop){d.publish("speechRendered",[]),this.audioElem.src=window.URL.createObjectURL(t);var s=this.audioElem.play();void 0!==s&&s.then((function(){r.audioPlaybackTimer()})).catch((function(){})),d.publish("analytics",{event:"Speech",action:"bandwidth",count:t.size/1024})}}}},{key:"encodeChars",value:function(e){try{var t="",n="";if(-1<e.search("<phoneme")||-1<e.search("<sub")||-1<e.search("<say-as")||-1<e.search("<emphasis")||-1<e.search("<break")||-1<e.search("<prosody"))return e;for(var r=0;r<e.length;r++)n=e.charCodeAt(r).toString(),t+=void 0===this.charMap[n]?e.charAt(r):this.charMap[n];return t}catch(e){}}}]),e}(),x=function(){function e(t){a(this,e),this.user=t.user,this.custId=t.custId||null,this.bookId=t.bookId||null,this.pageId=t.pageId||null,this.enableCache=t.enableCache||!1,this.continueOnSelect=t.continueOnSelect||!1,this.enablePollyVoices=t.enablePollyVoices||!1,this.enableNeural=t.enableNeural||!1,this.enableCereprocVoices=t.enableCereprocVoices||!1,this.speechServerDns=t.speechServer||"speech.speechstream.net",this.cacheDns=t.cacheDns||"cache.speechstream.net",this.locale=t.locale||"en-US",this.useElementLangTags=t.useElementLangTags||!1,this.currentVoice={name:"Ava",Gender:"Female",language:"en-us",description:"English (US) Female Ava",vendor:"Nuance"},this.userSettings={speechoptions:{voice:this.currentVoice,continousreading:!0,speed:50},language:{language:"en_US",services:"en_US"}},this.langVoiceMapping=t.langVoiceMapping}return o(e,[{key:"get_Voice",value:function(){try{return this.currentVoice}catch(e){console.log("SpeechSettings - get_Voice: ",e)}}},{key:"set_Voice",value:function(e){try{this.currentVoice=e,this.userSettings.speechoptions.voice=e}catch(e){console.log("SpeechSettings - set_Voice: ",e)}}},{key:"getVoiceByGenderAndLang",value:function(e,t){t=t.toLowerCase().replace("_","-");var n=null;if(null!=this.langVoiceMapping&&this.langVoiceMapping[t])n=this.voices.getVoiceByName(this.langVoiceMapping[t]);else{for(var r=this.voices.getVoiceByGenderAndLang(e,t),i=0;i<r.length;i++)if("Nuance"==r[i].vendor){n=r[i];break}null==n&&(n=r[0])}return n}},{key:"addVoices",value:function(){}},{key:"setVoiceByGenderAndLang",value:function(e,t){var n="Female";e&&(n="Male");var r=this.getVoiceByGenderAndLang(n,t);this.currentVoice=r,this.userSettings.speechoptions.voice=r}},{key:"set_Speed",value:function(e){try{this.userSettings.speechoptions.speed=e}catch(e){console.log("SpeechSettings - set_Speed: ",e)}}},{key:"getVoices",value:function(){try{return""}catch(e){console.log("SpeechSettings - getVoices: ",e)}}},{key:"getLocale",value:function(){return this.locale}},{key:"getUserSettings",value:function(){return this.userSettings}},{key:"getUser",value:function(){return this.user}},{key:"getPageId",value:function(){return this.pageId}},{key:"setPageId",value:function(e){this.pageId=this.filterId(e)}},{key:"getCustId",value:function(){return this.custId}},{key:"setCustId",value:function(e){this.custId=e}},{key:"getBookId",value:function(){return this.bookId}},{key:"setBookId",value:function(e){this.bookId=this.filterId(e)}},{key:"isCacheEnabled",value:function(){return this.enableCache}},{key:"isNeuralEnabled",value:function(){return this.enableNeural}},{key:"enabledNeural",value:function(e){this.enableNeural=e}},{key:"getSpeechServer",value:function(){return this.speechServerDns}},{key:"getCacheServer",value:function(){return this.cacheDns}},{key:"setUseElementLangTags",value:function(e){this.useElementLangTags=e}},{key:"getUseElementLangTags",value:function(){return this.useElementLangTags}},{key:"filterId",value:function(e){return 100<e.length?(new S).hex_md5(e):e}}]),e}(),_=function(){function e(e){for(var t in e)if(e.hasOwnProperty(t)){var r=e[t];if(null!=r.pronunciations)for(var i in r.pronunciations)if(r.pronunciations.hasOwnProperty(i)){var a=n(i,r.pronunciations[i]);null!=a&&(delete r.pronunciations[i],null==r.wildcards&&(r.wildcards=[]),r.wildcards.push(a))}}}function t(e){var t=e.indexOf("&#");return-1<t&&(e=function(e){return e.replace(/&#([0-9]+);?/gi,(function(e,t){return String.fromCharCode(parseInt(t,10))}))}(e)),-1<(t=e.indexOf("\\u0026#"))&&(e=function(e){return e.replace(/\\u0026#([0-9]+);?/gi,(function(e,t){return String.fromCharCode(parseInt(t,10))}))}(e)),e}function n(e,t){if(2<e.length&&"/"==e.charAt(0)&&"/"==e.charAt(e.length-1)){var n=e.substr(1,e.length-2);try{var r=new RegExp(n);if(null!=r)return{say:r,like:t}}catch(e){}}return null}function r(e,t){if(null==t)return null;var n=e;if(null!=t[n])return t[n];var r=n.toLowerCase();return r!=n&&null!=t[r]?t[r]:(n=(n=(n=e.replace("\\x82\\x91\\x92","'")).replace("\\x93\\x94",'"')).replace(l,""))==e?null:null==t[n]?(r=n.toLowerCase())!=n&&null!=t[r]?t[r]:null:t[n]}function a(e,t){if(null==t)return null;for(var n=0;n<t.length;n++){var r=t[n],i=e.replace(r.say,r.like);if(i!=e)return i}return null}function s(e,t){var n=e.split(/\s+/);if(n.length==t)return n;if(n.length>t){var r=n.length-(t-1),i=[],a=n.splice(0,r).join(" ");return i.push(a),i=i.concat(n)}if(n.length<t){var s;for(s=n.length;s<t;s++)n.push("");return n}return null}var o=this,l=/^[,.?!;:\x27\x22\xa3\x24\u20ac]+|[,.?!;:\x27\x22\xa3\x24\u20ac]+$/g,h=null,u=!1,g=!1,c=null,m=null,p=null,f=null,S=null,v=null,w=null,b=null,y=null,C=null,T=null;this.setVoice=function(e){var t;(y=null,C=null,T=null,v=null,w=null,b=null,"string"==typeof e&&(S=e,null!=c))&&(null!=(t=c.items[S])&&(y=t.pronunciations,C=t.multiPronunciations,T=t.wildcards),function(e){if("string"==typeof e)for(var t,n=0;n<x.length;n++)if(t=x[n],-1<e.indexOf(t))return!0;return!1}(S)&&null!=(t=c.items["English Voices"])&&(v=t.pronunciations,w=t.multiPronunciations,b=t.wildcards))},this.getVoice=function(){return S},this.loadData=function(e,t,n){if(h=e,d.publish("analytics",{event:"Pronunciation",action:"retrieve Global file"}),void 0!==h&&void 0!==t&&void 0!==n){var r="https://"+h+"/global/"+t+"/"+n+".json";o.send(r,o.fileLoaded,o.loadFailed)}else thLog("Global pronunciation failed to load as requested with invalid data.")},this.send=function(){var e=i((function*(e,t,n){try{var r=yield fetch(e);t(yield r.text())}catch(e){n(e)}}));return function(){return e.apply(this,arguments)}}(),this.loadFailed=function(){d.publish("analytics",{event:"Pronunciation",action:"retrieve Global file Failed"}),g=!0,u=!1},this.fileLoaded=function(n){g=!0,d.publish("analytics",{event:"Pronunciation",action:"retrieve Global file success"}),n=t(n);var r=JSON.parse(n);if(null!=r&&null!=r.items&&"object"==typeof r.items){e((c=r).items);var i=c.items.all;null!=i&&(m=i.pronunciations,p=i.multiPronunciations,f=i.wildcards),o.setVoice(S),u=!0}else thLog("Global pronunciation failed to load as no valid data returned."),u=!1},this.checkWords=function(e,t){if(!(u&&1<=e.length))return null;var n=null;null!=t&&t!=S&&(n=S,o.setVoice(t));try{var i,l,h=null,d=!1;if(1<e.length&&(l=(l=(l=(i=e[0].trimTH()).replace("\\x82\\x91\\x92","'")).replace("\\x93\\x94",'"')).replace(/^[,.?!;:\x27\x22\xa3\x24\u20ac]+/,""),(null!=C&&(-1<C.indexOf(i)||-1<C.indexOf(l))||null!=w&&(-1<w.indexOf(i)||-1<w.indexOf(l))||null!=p&&(-1<p.indexOf(i)||-1<p.indexOf(l)))&&(d=!0)),d){if(3<=e.length&&(null!=(h=r(i=e[0].trimTH()+" "+e[1].trimTH()+" "+e[2].trimTH(),y))||null!=(h=r(i,v))||null!=(h=r(i,m))))return s(h,3);if(2<=e.length&&(null!=(h=r(i=e[0].trimTH()+" "+e[1].trimTH(),y))||null!=(h=r(i,v))||null!=(h=r(i,m))))return s(h,2)}if(1<=e.length){if(null!=(h=r(i=e[0].trimTH(),y))||null!=(h=r(i,v))||null!=(h=r(i,m)))return[h];if(null!=(h=a(i,T))||null!=(h=a(i,b))||null!=(h=a(i,f)))return[h]}}catch(e){thLogE(e)}return null!=n&&o.setVoice(n),null},this.isEnabled=function(){return u},this.isLoaded=function(){return g};var x=["Allison","Ava","Daniel","Emily","Fiona","Jill","Karen","Lee","Moira","Samantha","Sangeeta","Serena","Tessa","Tom"]},N={speechEngines:[],initialised:!1,voices:[],controller:null,voiceToEngineMap:[],speechSettings:null,globalProns:!1,Pronunciation:null,prons:[],speechServerVoices:null,pronunciations:new(function(){function e(){a(this,e),this.rw_qouteRegex="\\x82\\x91\\x92",this.rw_dqouteRegex="\\x93\\x94",this.rw_trimRegex=/^[,.?!;:\x27\x22\xa3\x24\u20ac]+|[,.?!;:\x27\x22\xa3\x24\u20ac]+$/g,this.rw_internalSpaceRegex=/[\n\r\t ]{1,}/g,this.pronsArray=[],this.pronunciations=new f,this.pronunciations.prons.lang.MultiwordPron=[],this.gpData={}}return o(e,[{key:"setGlobalPronunciations",value:function(e){this.gpData=e}},{key:"add",value:function(e,t){this.pronunciations.prons.lang.all[e]=t}},{key:"delete",value:function(e){delete this.pronunciations.prons.lang.all[e]}},{key:"update",value:function(e,t){this.pronunciations.prons.lang.all[e]=t}},{key:"checkWords",value:function(e,t,n){var r=n.split(" "),i=!1;"censored"==this.pronunciations.prons.lang.all[n]&&(i=!0);for(var a="",s=t;s<t+r.length&&s<e.length;s++)a+=e[s].trim()+" ";var o={start:-1,end:-1};return a=a.trim(),i&&(a=a.toLowerCase(),n=n.toLowerCase()),a==n?o={start:t,end:t+r.length}:(a=a.replace(this.rw_internalSpaceRegex," "))==n?o={start:t,end:t+r.length}:(a=a.replace(this.rw_trimRegex,""))==n?o={start:t,end:t+r.length}:o}},{key:"fixWord",value:function(e){return e=(e=e.replace(this.rw_qouteRegex,"'")).replace(this.rw_dqouteRegex,'"')}},{key:"checkPronunciation",value:function(e,t){this.pronsArray;var n,r=!1,i=e.length;for(var a in this.pronunciations.prons.lang.all)for(var s=this.fixWord(a),o=0;o<e.length;o++)if(-1!=this.checkWords(e,o,s).start){var l=a.split(" ");r=!0;for(var h=this.fixWord(this.pronunciations.prons.lang.all[a]).split(" "),u=0;u<l.length;u++)if(1==h.length&&1==l.length)e[o+u]=this.pronunciations.prons.lang.all[a];else if(1==h.length&&1<l.length)e[o+u]=0==u?this.pronunciations.prons.lang.all[a]:" ";else if(1==l.length&&1<h.length){e[o+u]="";for(var d=0;d<h.length;d++)e[o+u]+=h[d]+" "}else e[o+u]=h[u]}for(n=0;n<i;n++)if(void 0!==this.gpData.isEnabled&&this.gpData.isEnabled()){var g;if(null!=(g=this.gpData.checkWords(e.slice(n,n+3),t))){3==g.length?(e[n+2]=g[2]+" ",e[n+1]=g[1]+" ",e[n]=g[0]+" ",r=!0):2==g.length?(e[n+1]=g[1]+" ",e[n]=g[0]+" ",r=!0):1==g.length&&(e[n]=g[0]+" ",r=!0);continue}}return r}},{key:"rw_checkPronunciationFromString",value:function(e,t){var n="";if(this.checkPronunciation(wordList,t)){var r,i=wordList.length;for(r=0;r<i;r++)n+=wordList[r],r<i-1&&(n+=" ");return n}return e}},{key:"setPronunciationsForVoice",value:function(e,t){var n=this.pronunciations.prons.voices[e];this.setPronunciationsForLang(n,t)}},{key:"setPronunciationsForLang",value:function(e,t){var n=this.pronunciations.prons.lang[e],r=this.pronunciations.prons.lang.all,i=Object.assign({},r,n);if(null!=i&&void 0!==i)for(var a in i)for(var s=0;s<t.length;s++)t[s]=t[s].replace(a,i[a])}}]),e}()),initialise:function(e){this.speechSettings=new x(e);try{e.globalPronunciations&&void 0!==e.pronunciationDns&&void 0!==e.user&&void 0!==e.custId&&(this.globalProns=new _(this),this.globalProns.setVoice(this.speechSettings.currentVoice.name),this.globalProns.loadData(e.pronunciationDns,e.user,e.custId),this.pronunciations.setGlobalPronunciations(this.globalProns))}catch(e){this.globalProns=!1}try{return this.initialised?Promise.resolve():(this.speechServerVoices=new C(e.enablePollyVoices,e.enableCereprocVoices),this.speechEngines.speechserver=new T(this.speechSettings,this.speechServerVoices),this.initialised=!0,this.initialiseEnginesVoices())}catch(e){console.log("SpeechManager - intialise: ",e)}},initialiseEnginesVoices:function(){var e=[];for(var t in this.speechEngines)this.speechEngines.hasOwnProperty(t)&&e.push(this.speechEngines[t].initialise());return Promise.all(e)},addPronunciation:function(e,t){this.pronunciations.add(e,t)},updatePronunciation:function(e,t){this.pronunciations.update(e,t)},deletePronunciation:function(e,t){this.pronunciations.delete(e,t)},getVoices:function(e){var t=this;try{if(!this.initialised)return Promise.resolve(null);if(null==e&&(e=!1),e&&(this.voices=[],this.voiceToEngineMap=[]),0<Object.keys(this.voices).length)return Promise.resolve(this.voices);var n=[],r=function(e){if(t.speechEngines.hasOwnProperty(e)){var r=t.speechEngines[e].getVoices().then((function(n){for(var r in n)n.hasOwnProperty(r)&&(t.voices[r]=n[r],t.voiceToEngineMap[r]=t.speechEngines[e])}));n.push(r)}};for(var i in this.speechEngines)r(i);return Promise.all(n).then((function(){return t.voices}))}catch(e){return console.log("SpeechManager - getVoices: ",e),Promise.reject(e)}},speakSelection:function(e,t,n,r,a){var s=this;return i((function*(){try{d.publish("WordsToSpeak",e);var o=Promise.resolve();0==Object.keys(s.voices).length&&(o=s.getVoices()),(null!=a||void 0!==a)&&(!(a="Female")&&(a="Male")),o.then(i((function*(){var i=s.voiceToEngineMap[s.speechSettings.get_Voice().name];if(null==r||void 0===r||void 0===s.speechServerVoices.getVoiceByGenderAndLang(r,a))null==s.voiceToEngineMap[s.speechSettings.get_Voice().name]?(i=s.voiceToEngineMap.Ava,s.speechSettings.set_Voice("Ava")):i=s.voiceToEngineMap[s.speechSettings.get_Voice().name],s.pronunciations.checkPronunciation(e,s.speechSettings.get_Voice().name),yield i.speakSelection(e,t,n);else{var o=s.speechSettings.get_Voice(),l=o.language.split("-"),h=r.split("-");s.speechSettings.getUseElementLangTags()&&null!=s.speechSettings.langVoiceMapping&&s.speechSettings.langVoiceMapping[r]?(s.speechSettings.set_Voice(s.speechServerVoices.getVoiceByName(s.speechSettings.langVoiceMapping[r])),i=s.voiceToEngineMap[s.speechSettings.langVoiceMapping[r]],s.pronunciations.checkPronunciation(e,s.speechSettings.get_Voice().name)):s.speechSettings.getUseElementLangTags()&&l[0]&&h[0]&&l[0]!=h[0]?(s.speechSettings.set_Voice(s.speechServerVoices.getVoiceByGenderAndLang(r,a)),i=s.voiceToEngineMap[s.speechServerVoices.getVoiceByGenderAndLang(r,a).name],s.pronunciations.checkPronunciation(e,s.speechSettings.get_Voice().name)):(i=s.voiceToEngineMap[o.name],s.pronunciations.checkPronunciation(e,o.name)),yield i.speakSelection(e,t,n),s.speechSettings.set_Voice(o)}})))}catch(e){console.log("SpeechManager - speakSelection: ",e)}}))()},speakSelectionWithVoice:function(e,t,n,r){var a=this;return i((function*(){d.publish("WordsToSpeak",e);var s=Promise.resolve();0==Object.keys(a.voices).length&&(s=a.getVoices()),s.then(i((function*(){var i=a.speechSettings.get_Voice(),s=a.voiceToEngineMap[r],o=a.speechServerVoices.getVoiceByName(r);a.speechSettings.set_Voice(o),null!=s&&(a.pronunciations.checkPronunciation(e,r),yield s.speakSelection(e,t,n)),a.speechSettings.set_Voice(i)})))}))()},setVoiceByName:function(e){var t=this.speechServerVoices.getVoiceByName(e);(null!=t||void 0!==t)&&this.speechSettings.set_Voice(t)},setVoiceByGenderAndLang:function(e,t){(null!=e||void 0!==e)&&(!(e="Female")&&(e="Male"));var n=this.speechServerVoices.getVoiceByGenderAndLang(t,e);(null!=n||void 0!==n)&&this.speechSettings.set_Voice(n)},setSpeed:function(e){this.speechSettings.set_Speed(e)},stop:function(){try{if(0==Object.keys(this.voiceToEngineMap).length)return;var e=this.voiceToEngineMap[this.speechSettings.get_Voice().name];if(void 0===e){var t=this.speechSettings.getLocale(),n=this.configuration.getConfiguration();this.speechSettings.set_Voice(n[t].speechoptions.voice),e=this.voiceToEngineMap[this.speechSettings.get_Voice().name]}null!==e&&e.stop()}catch(e){console.log("SpeechManager - stop: ",e)}},pause:function(){try{if(0==Object.keys(this.voiceToEngineMap).length)return;var e=this.voiceToEngineMap[this.speechSettings.get_Voice().name];if(void 0===e){var t=this.speechSettings.getLocale(),n=this.configuration.getConfiguration();this.speechSettings.set_Voice(n[t].voice),e=this.voiceToEngineMap[this.speechSettings.get_Voice().name]}null!==e&&e.pause()}catch(t){console.log("SpeechManager - pause: ",t)}},setPageId:function(e){this.speechSettings.setPageId(e)},setBookId:function(e){this.speechSettings.setBookId(e)},setCustId:function(e){this.speechSettings.setCustId(e)},enableNeural:function(e){this.speechSettings.enabledNeural(e)}},E=function(){function e(t,n,r){a(this,e),this.HtmlParser=n,this.useElementLangTags=null==typeof t.useElementLangTag||0!=t.useElementLangTag;var i={user:t.username,speechServer:t.dns,cacheDns:t.cacheDns,enableCache:t.enableCache,custId:t.custId,bookId:t.bookId,pageId:t.pageId,enablePollyVoices:t.enablePollyVoices,enableNeural:t.enableNeural,enableCereprocVoices:t.enableCereprocVoices,globalPronunciations:t.globalPronunciations,pronunciationDns:t.pronunciationDns,langVoiceMapping:r,useElementLangTags:this.useElementLangTags,continueOnSelect:t.continueOnSelect};N.initialise(i),this.clickToSpeakEnabled=t.clickToSpeakEnabled||!1,this.hoverSpeakEnabled=t.hoverSpeakEnabled||!1,this.continuousSpeechEnabled=t.continuousSpeechEnabled||!1,this.tempContinuousSpeechEnabled=this.continuousSpeechEnabled,this.speechEvents(),this.withOutHighlighting=!1,this.ignoreToolbarId=t.ignoreToolbarId,this.voice=null,this.firstHoverSpeak=!1,this.isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),this.wordCount=0,this.speakFromSelect=!1}return o(e,[{key:"setContinuousSpeechEnabled",value:function(e){this.continuousSpeechEnabled=e,this.tempContinuousSpeechEnabled=this.continuousSpeechEnabled}},{key:"speechEvents",value:function(){var e=this;d.subscribe("onthAPIWord",(function(t){e.onWord(t)})),d.subscribe("onthAPIStop",(function(){e._speechEnded(),e.playNextSentence()})),d.subscribe("onthAPIWordonthAPIStop",(function(){e._speechEnded(),e.playNextSentence()})),d.subscribe("setTempVoice",(function(t){e.setTranslateVoice(t)})),d.subscribe("setPageID",(function(t){e.setPageId(t)})),d.subscribe("setBookID",(function(t){e.setBookId(t)}))}},{key:"hoverSpeakOnOff",value:function(){this.stop(),this.hoverSpeakEnabled=!this.hoverSpeakEnabled,this.HtmlParser.hoverSpeakEnabled(this.hoverSpeakEnabled),this.hoverSpeakEnabled&&!this.firstHoverSpeak&&this.isSafari&&(this.speakWithOutHighlight([""]),this.firstHoverSpeak=!0,this.stop()),this.hoverSpeakEnabled&&d.publish("analytics",{event:"Speech",action:"hoverSpeakOn"})}},{key:"clickToSpeakOnOff",value:function(){this.stop(),this.clickToSpeakEnabled=!this.clickToSpeakEnabled,this.HtmlParser.clickToSpeakEnabled(this.clickToSpeakEnabled),this.clickToSpeakEnabled&&d.publish("analytics",{event:"Speech",action:"clickToSpeakOn"})}},{key:"speakWithOutHighlight",value:function(e,t){this.stop(),this.withOutHighlighting=!0,this.tempContinuousSpeechEnabled=this.continuousSpeechEnabled,this.continuousSpeechEnabled=!1;var n=(new S).hex_md5(e.toString())+Math.random();N.speakSelection(e,n,!0,t),d.publish("speechStarted",[])}},{key:"play",value:function(e){this.speakFromSelect=this.HtmlParser.hasSelection()||!1,this.wordCount=0,e&&(this.voice=e),d.publish("speechStarted",[]);var t=this.HtmlParser.hiliteSelection(),n=(new S).hex_md5(t.toString())+Math.random();if(this.wordCount=t.length||0,this.voice)N.speakSelectionWithVoice(t,n,!0,this.voice);else{var r=null;this.useElementLangTags&&(r=this.HtmlParser.getLanguageForSentence()),N.speakSelection(t,n,!0,r)}}},{key:"setTranslateVoice",value:function(e){this.voice=e}},{key:"playNextSentence",value:function(){var e,t=null;(this.wordCount=0,this.speakFromSelect&&!N.speechSettings.continueOnSelect&&this.HtmlParser.speechObject.m_contents.length-1===this.HtmlParser.speechObject.sentenceNo)||(t=this.HtmlParser.hiliteNextSentence(this.continuousSpeechEnabled),this.wordCount=(null===(e=t)||void 0===e?void 0:e.length)||0);if(null!=t){var n=null;this.useElementLangTags&&(n=this.HtmlParser.getLanguageForSentence());var r=(new S).hex_md5(t.toString())+Math.random();this.voice?N.speakSelectionWithVoice(t,r,!0,this.voice):N.speakSelection(t,r,!0,n),d.publish("analytics",{event:"Speech",action:"Continuous Sentence"}),d.publish("speechStarted",[])}else d.publish("pageCompleted",[]),d.publish("speechStopped",[]),this.voice=null,this.continuousSpeechEnabled=this.tempContinuousSpeechEnabled,this.speakFromSelect=!1}},{key:"playPreviousSentence",value:function(){this.wordCount=0;var e=this.HtmlParser.hilitePreviousSentence();if(this.wordCount=(null==e?void 0:e.length)||0,null!=e){var t=null;this.useElementLangTags&&(t=this.HtmlParser.getLanguageForSentence());var n=(new S).hex_md5(e.toString())+Math.random();this.voice?N.speakSelectionWithVoice(e,n,!0,this.voice):N.speakSelection(e,n,!0,t),d.publish("analytics",{event:"Speech",action:"Continuous Sentence"}),d.publish("speechStarted",[])}else d.publish("pageCompleted",[]),d.publish("speechStopped",[]),this.voice=null,this.continuousSpeechEnabled=this.tempContinuousSpeechEnabled}},{key:"speakById",value:function(e,t){this.wordCount=0,this.tempContinuousSpeechEnabled=this.continuousSpeechEnabled,this.continuousSpeechEnabled=!1,null!=t&&(this.voice=t);var n=this.HtmlParser.highlightElementById(e);this.wordCount=n.length||0;var r=null;if(this.useElementLangTags&&(r=this.HtmlParser.getLanguageForSentence()),null!=n){var i=(new S).hex_md5(n.toString())+Math.random();t?(N.speakSelectionWithVoice(n,i,!0,t),d.publish("speechStarted",[])):(N.speakSelection(n,i,!0,r),d.publish("speechStarted",[]))}}},{key:"speakElement",value:function(e,t,n){this.wordCount=0,t||(this.tempContinuousSpeechEnabled=this.continuousSpeechEnabled,this.continuousSpeechEnabled=!1),null!=n&&(this.voice=n);var r=this.HtmlParser.highlightElementById(e);this.wordCount=r.length||0;var i=null;if(this.useElementLangTags&&(i=this.HtmlParser.getLanguageForSentence()),null!=r){var a=(new S).hex_md5(r.toString())+Math.random();n?(N.speakSelectionWithVoice(r,a,!0,n),d.publish("speechStarted",[])):(N.speakSelection(r,a,!0,i),d.publish("speechStarted",[]))}}},{key:"onWord",value:function(e){this.withOutHighlighting||"start"==e[0]||this.HtmlParser.hiliteWord(e[0])}},{key:"stop",value:function(){this.withOutHighlighting=!1,N.stop(),this.HtmlParser.stop(),d.publish("speechStopped",[]),this.voice=null,this.continuousSpeechEnabled=this.tempContinuousSpeechEnabled}},{key:"_speechEnded",value:function(){this.withOutHighlighting=!1,this.HtmlParser.stop()}},{key:"pause",value:function(){N.pause()}},{key:"forward",value:function(){this.stop(),this.speakFromSelect=!1,this.playNextSentence()}},{key:"rewind",value:function(){this.stop(),this.speakFromSelect=!1,this.playPreviousSentence()}},{key:"setVoice",value:function(e){N.setVoiceByName(e)}},{key:"enableNeural",value:function(e){N.enableNeural(e)}},{key:"setCustId",value:function(e){N.setCustId(e)}},{key:"setBookId",value:function(e){N.setBookId(e)}},{key:"setPageId",value:function(e){N.setPageId(e)}},{key:"setVoiceByGenderAndLanguage",value:function(e,t){N.setVoiceByGenderAndLang(e,t)}},{key:"setVoiceSpeed",value:function(e){N.setSpeed(e)}},{key:"addPronunciations",value:function(e,t){N.addPronunciation(e,t)}},{key:"updatePronunciations",value:function(e,t){N.updatePronunciation(e,t)}},{key:"deletePronunciations",value:function(e,t){N.deletePronunciation(e,t)}},{key:"setLangVoiceMapping",value:function(e){N.speechSettings.langVoiceMapping=e}},{key:"getLangVoiceMapping",value:function(){return N.speechSettings.langVoiceMapping}},{key:"setUseElementLangTags",value:function(e){N.speechSettings.setUseElementLangTags(e),this.useElementLangTags=e}},{key:"getUseElementLangTags",value:function(){return N.speechSettings.getUseElementLangTags()}}]),e}()},255:function(e,t,n){"use strict";n.d(t,"a",(function(){return be}));var r=Symbol.for("texthelp.EventBus"),i=window[r];i||(i={events:{},unSubscribe:function(e,t,n){if(null!=this.events[e])for(var r=0;r<this.events[e].length;r++)this.events[e][r].context==n&&this.events[e].splice(r,1)},subscribe:function(e,t,n){return null==this.events[e]&&(this.events[e]=[]),this.events[e].push({callback:t,context:n}),this.events.length-1},publish:function(e){var t=this.events[e];if(null!=t){for(var n=arguments.length,r=Array(1<n?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];for(var a=0;a<t.length;a++)t[a].callback.apply(this,r)}}},window[r]=i);class a{constructor(){this._inputTypeEnum=this._makeEnum(["CONTENTEDITABLE","INPUT","TEXTAREA","NONE"])}_makeEnum(e){let t={};for(let n of e)t[n]=Symbol(n);return Object.freeze(t)}removeTextatCursor(e,t,n,r=null){if(null===r&&(r=this.getInputElement(document.activeElement)),null===r)throw"the input element is null.";let i=r.ownerDocument;if("right"==t&&(e=-Math.abs(e)),r.type==this._inputTypeEnum.CONTENTEDITABLE){let t=i.createRange(),a=window.getSelection();return t.setStart(a.focusNode,n-(e+1)),t.setEnd(a.focusNode,n),t.deleteContents(),void this.insertText(" ",r)}const a=r.element.value,s=a.substring(0,n-e),o=a.substring(n);r.element.value=s+o,r.element.selectionStart=r.element.selectionEnd=s.length,r.element.focus()}insertText(e,t=null){if(null===t&&(t=this.getInputElement(document.activeElement)),null===t)throw"the input element is null.";let n=t.ownerDocument,r=!1;if(void 0!==n&&void 0!==n.execCommand&&(r=n.execCommand("insertText",!1,e)),r)return void t.element.focus();if(t.type==this._inputTypeEnum.CONTENTEDITABLE)return void this._insertTextContentEditable(e,t.element);const i=t.element.selectionStart,a=t.element.selectionEnd,s=t.element.value,o=s.substring(0,i),l=s.substring(a,s.length);t.element.value=o+e+l,t.element.selectionStart=t.element.selectionEnd=i+e.length,t.element.focus()}insertImage(e,t=""){let n=this.getInputElement(document.activeElement);if(null===n)throw"The active input element could not be found.";if(n.type!==this._inputTypeEnum.CONTENTEDITABLE)throw"You can only insert an image into a contenteditable element.";t.length<1?this._pasteHtmlAtCaret(`<img src="${e}"></img>`):this._pasteHtmlAtCaret(`<img src="${e}" alt="${t}"></img>`)}getText(e=null){if(null==e&&(e=this.getInputElement(document.activeElement)),null==e)return{selectedText:"",textBeforeSelection:"",textAfterSelection:"",offsetCaretPosition:""};let t="",n="",r="",i=null,a=/[\uFEFF]/g;if(e.type==this._inputTypeEnum.CONTENTEDITABLE){let a=window.getSelection();t=a.toString(),i=a.anchorOffset;let s=this._getLeftToRightSelection(a);n=s.startNode.textContent.substring(0,s.startOffset),r=s.endNode.textContent.substring(s.endOffset);let o=this._getPrevTextNode(s.startNode,e.element);for(;null!==o&&o.nodeType<4;)n=o.textContent+n,o=this._getPrevTextNode(o,e.element);let l=this._getNextTextNode(s.endNode,e.element);for(;null!==l&&l.nodeType<4;)r+=l.textContent,l=this._getNextTextNode(l,e.element)}else void 0!==e.element.value?(i=e.element.selectionStart,window.getSelection().getRangeAt(0).getBoundingClientRect(),t=e.element.value.substring(e.element.selectionStart,e.element.selectionEnd),n=e.element.value.substring(0,e.element.selectionStart),r=e.element.value.substring(e.element.selectionStart+t.length)):(n="",t=window.getSelection());return{selectedText:t.replace(a,""),textBeforeSelection:n.replace(a,""),textAfterSelection:r.replace(a,""),offsetCaretPosition:i}}_getLeftToRightSelection(e){let t=e.anchorNode.compareDocumentPosition(e.focusNode),n=!1;if((!t&&e.anchorOffset>e.focusOffset||t===Node.DOCUMENT_POSITION_PRECEDING)&&(n=!0),n)return{startNode:e.focusNode,startOffset:e.focusOffset,endNode:e.anchorNode,endOffset:e.anchorOffset};let r=e.focusOffset;return 1==r&&(r=e.toString().length),{startNode:e.anchorNode,startOffset:e.anchorOffset,endNode:e.focusNode,endOffset:r}}getInputElement(e=null){if(null==e)throw"No source element for getInputElement.";let t=e.closest("[contenteditable=true]");return null!==t?{element:t,type:this._inputTypeEnum.CONTENTEDITABLE}:e.isContentEditable?{element:e,type:this._inputTypeEnum.CONTENTEDITABLE}:(t=e.closest("input"),null!==t?{element:t,type:this._inputTypeEnum.INPUT}:(t=e.closest("textarea"),null!==t?{element:t,type:this._inputTypeEnum.TEXTAREA}:{element:null,type:this._inputTypeEnum.NONE}))}getCaretPosition(e=null){if(null==e)throw"No input element for getCaretPosition.";return e.type==this._inputTypeEnum.CONTENTEDITABLE?this._getContentEditableDivCaretPos(e.element):this._getTextInputCaretPos(e.element)}setCaretPosition(e,t=null){if(null==t)throw"No input element for setCaretPosition.";let n=e;return t.type==this._inputTypeEnum.CONTENTEDITABLE?this._setContentEditableDivCaretPos(n,t.element):this._setTextInputCaretPos(n,t.element)}_getContentEditableDivCaretPos(e){return getSelection().getRangeAt(0).getClientRects()[0]}_setContentEditableDivCaretPos(e,t){let n=document.createRange(),r=window.getSelection();n.setStart(t,e),n.collapse(!0),r.removeAllRanges(),r.addRange(n)}_getTextInputCaretPos(e){let t=e.selectionStart;var n,r,i,a=!(null==window.mozInnerScreenX);(n=document.getElementById(e.nodeName+"--texthelp-mirror-div"))||((n=document.createElement("div")).id=e.nodeName+"--texthelp-mirror-div",document.body.appendChild(n)),i=n.style,r=getComputedStyle(e),i.whiteSpace="pre-wrap","INPUT"!==e.nodeName&&(i.wordWrap="break-word"),i.position="absolute",i.top=e.offsetTop+parseInt(r.borderTopWidth)+"px",i.left="400px",i.visibility="hidden",["boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing"].forEach((function(e){i[e]=r[e]})),a?(i.width=parseInt(r.width)-2+"px",e.scrollHeight>parseInt(r.height)&&(i.overflowY="scroll")):i.overflow="hidden",n.textContent=e.value.substring(0,t),"INPUT"===e.nodeName&&(n.textContent=n.textContent.replace(/\s/g," "));var s=document.createElement("span");s.textContent=e.value.substring(t)||".",s.style.backgroundColor="lightgrey",n.appendChild(s);let o=e.getBoundingClientRect(),l=parseInt(r.fontSize);return t={y:s.offsetTop+parseInt(r.borderTopWidth)+o.y,x:s.offsetLeft+parseInt(r.borderLeftWidth)+o.x,height:l/100*30+l},t.top=t.y,t.left=t.x,t.bottom=t.y+t.height,t}_setTextInputCaretPos(e,t){}_getTextNodesInRange(e){var t,n=e.startContainer,r=e.endContainer,i=e.commonAncestorContainer,a=[];function s(e){if(e.firstChild)return e.firstChild;for(;e;){if(e.nextSibling)return e.nextSibling;e=e.parentNode}}for(t=n.parentNode;t&&(3===t.nodeType&&a.push(t),t!=i);t=t.parentNode);for(a.reverse(),t=n;t&&(3===t.nodeType&&a.push(t),t!=r);t=s(t));return a}_getPrevTextNode(e,t){let n=e.previousSibling;return null!==n?n:null===e.parentNode||null===e.parentNode.previousSibling||3!==e.parentNode.previousSibling.nodeType?null:t.contains(e.parentNode.previousSibling)?e.parentNode.previousSibling:null}_getNextTextNode(e,t){let n=e.nextSibling;return null!==n?n:null===e.parentNode||null===t||null===e.parentNode.nextSibling||3!==e.parentNode.nextSibling.nodeType?null:t.contains(e.parentNode.nextSibling)?e.parentNode.nextSibling:null}_insertTextContentEditable(e,t){if(t.focus(),document.selection){const t=document.selection.createRange();return t.text=e,t.collapse(!1),void t.select()}if(!document.execCommand("insertText",!1,e)){const n=t.selectionStart,r=t.selectionEnd;if("function"==typeof t.setRangeText)t.setRangeText(e);else{const i=document.createRange(),a=document.createTextNode(e);if(canManipulateViaTextNodes(t)){let e=t.firstChild;if(e){let t=0,a=null,s=null;for(;e&&(null===a||null===s);){const o=e.nodeValue.length;n>=t&&n<=t+o&&i.setStart(a=e,n-t),r>=t&&r<=t+o&&i.setEnd(s=e,r-t),t+=o,e=e.nextSibling}n!==r&&i.deleteContents()}else t.appendChild(a)}if(canManipulateViaTextNodes(t)&&"#text"===i.commonAncestorContainer.nodeName)i.insertNode(a);else{const i=t.value;t.value=i.slice(0,n)+e+i.slice(r)}}t.setSelectionRange(n+e.length,n+e.length);const i=document.createEvent("UIEvent");i.initEvent("input",!0,!1),t.dispatchEvent(i)}t.focus()}_pasteHtmlAtCaret(e){var t,n;if(window.getSelection){if((t=window.getSelection()).getRangeAt&&t.rangeCount){(n=t.getRangeAt(0)).deleteContents();var r=document.createElement("div");r.innerHTML=e;for(var i,a,s=document.createDocumentFragment();i=r.firstChild;)a=s.appendChild(i);n.insertNode(s),a&&((n=n.cloneRange()).setStartAfter(a),n.collapse(!0),t.removeAllRanges(),t.addRange(n))}}else document.selection&&"Control"!=document.selection.type&&document.selection.createRange().pasteHTML(e)}_fireEvent(e,t){var n;if(e.ownerDocument)n=e.ownerDocument;else{if(9!=e.nodeType)throw new Error("Invalid node passed to fireEvent: "+e.id);n=e}if(e.dispatchEvent){var r="";switch(t){case"click":case"mousedown":case"mouseup":r="MouseEvents";break;case"keydown":case"focus":case"change":case"blur":case"select":r="HTMLEvents";break;default:throw"fireEvent: Couldn't find an event class for event '"+t+"'."}var i="change"!=t;(a=n.createEvent(r)).initEvent(t,i,!0),a.synthetic=!0,e.dispatchEvent(a,!0)}else if(e.fireEvent){var a;(a=n.createEventObject()).synthetic=!0,e.fireEvent("on"+t,a)}}}class s{constructor(e,t,n){this.node=e,this.offset=t,this.forwardBias=n,this.specialCase=!1}setSpecialCase(e){this.specialCase=e}isSpecialCase(){return this.specialCase}check(){var e=!0;return null==this.node||null==this.node.parentNode?e=!1:3!=this.node.nodeType?1==this.node.nodeType&&this.specialCase||(e=!1):(this.offset<0||this.offset>this.node.nodeValue.length)&&(e=!1),e}toString(){var e="THCaret ";return null!=this.node&&(3==this.node.nodeType?e+=this.node.nodeValue+" "+this.node.parentNode.tagName+" ":1==this.node.nodeType&&(e+=this.node.tagName+" ")),e+=this.offset}equals(e){return null!=e&&(this.node==e.node&&this.offset==e.offset&&this.forwardBias==e.forwardBias)}clone(){return new s(this.node,this.offset,this.forwardBias)}}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}String.prototype.trimTH=function(){try{return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")}catch(e){return}},String.prototype.trimSpaceTH=function(){try{return this.replace(/^[\t\r\n ]+/,"").replace(/[\t\r\n ]+$/,"")}catch(e){return}},String.prototype.trimSpaceStartTH=function(){try{return this.replace(/^[\t\r\n ]+/,"")}catch(e){return}},String.prototype.trimSpaceEndTH=function(){try{return this.replace(/[\t\r\n ]+$/,"")}catch(e){return}};class l{constructor(){this.extendedLetterPattern=/^[a-zA-Z\u00C6\u00D0\u018E\u018F\u0190\u0194\u0132\u014A\u0152\u1E9E\u00DE\u01F7\u021C\u00E6\u00F0\u01DD\u0259\u025B\u0263\u0133\u014B\u0153\u0138\u017F\u00DF\u00FE\u01BF\u021D\u0104\u0181\u00C7\u0110\u018A\u0118\u0126\u012E\u0198\u0141\u00D8\u01A0\u015E\u0218\u0162\u021A\u0166\u0172\u01AFY\u0328\u01B3\u0105\u0253\u00E7\u0111\u0257\u0119\u0127\u012F\u0199\u0142\u00F8\u01A1\u015F\u0219\u0163\u021B\u0167\u0173\u01B0y\u0328\u01B4\u00C1\u00C0\u00C2\u00C4\u01CD\u0102\u0100\u00C3\u00C5\u01FA\u0104\u00C6\u01FC\u01E2\u0181\u0106\u010A\u0108\u010C\u00C7\u010E\u1E0C\u0110\u018A\u00D0\u00C9\u00C8\u0116\u00CA\u00CB\u011A\u0114\u0112\u0118\u1EB8\u018E\u018F\u0190\u0120\u011C\u01E6\u011E\u0122\u0194\u00E1\u00E0\u00E2\u00E4\u01CE\u0103\u0101\u00E3\u00E5\u01FB\u0105\u00E6\u01FD\u01E3\u0253\u0107\u010B\u0109\u010D\u00E7\u010F\u1E0D\u0111\u0257\u00F0\u00E9\u00E8\u0117\u00EA\u00EB\u011B\u0115\u0113\u0119\u1EB9\u01DD\u0259\u025B\u0121\u011D\u01E7\u011F\u0123\u0263\u0124\u1E24\u0126I\u00CD\u00CC\u0130\u00CE\u00CF\u01CF\u012C\u012A\u0128\u012E\u1ECA\u0132\u0134\u0136\u0198\u0139\u013B\u0141\u013D\u013F\u02BCN\u0143N\u0308\u0147\u00D1\u0145\u014A\u00D3\u00D2\u00D4\u00D6\u01D1\u014E\u014C\u00D5\u0150\u1ECC\u00D8\u01FE\u01A0\u0152\u0125\u1E25\u0127\u0131\u00ED\u00ECi\u00EE\u00EF\u01D0\u012D\u012B\u0129\u012F\u1ECB\u0133\u0135\u0137\u0199\u0138\u013A\u013C\u0142\u013E\u0140\u0149\u0144n\u0308\u0148\u00F1\u0146\u014B\u00F3\u00F2\u00F4\u00F6\u01D2\u014F\u014D\u00F5\u0151\u1ECD\u00F8\u01FF\u01A1\u0153\u0154\u0158\u0156\u015A\u015C\u0160\u015E\u0218\u1E62\u1E9E\u0164\u0162\u1E6C\u0166\u00DE\u00DA\u00D9\u00DB\u00DC\u01D3\u016C\u016A\u0168\u0170\u016E\u0172\u1EE4\u01AF\u1E82\u1E80\u0174\u1E84\u01F7\u00DD\u1EF2\u0176\u0178\u0232\u1EF8\u01B3\u0179\u017B\u017D\u1E92\u0155\u0159\u0157\u017F\u015B\u015D\u0161\u015F\u0219\u1E63\u00DF\u0165\u0163\u1E6D\u0167\u00FE\u00FA\u00F9\u00FB\u00FC\u01D4\u016D\u016B\u0169\u0171\u016F\u0173\u1EE5\u01B0\u1E83\u1E81\u0175\u1E85\u01BF\u00FD\u1EF3\u0177\u00FF\u0233\u1EF9\u01B4\u017A\u017C\u017E\u1E93]+$/}trim(e){return e.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")}trimEndTH(e){return e.replace(/[\s\xA0]+$/,"")}rw_filterForHtml(e){var t=e.replace(/\x26/g,"&amp;");return t=(t=t.replace(/\x3c/g,"&lt;")).replace(/\x3e/g,"&gt;")}rw_isTextChar(e){return e>47&&e<58||e>63&&e<91||e>94&&e<123}rw_isWhiteSpace(e){return e.search(/[\s\xa0]/)>-1}encodeForXML(e){return e=(e=(e=(e=(e=e.replace(/\x26/g,"&amp;")).replace(/\x3c/g,"&lt;")).replace(/\x3e/g,"&gt;")).replace(new RegExp('"'),"&quot;")).replace(new RegExp("'"),"&apos;")}isNumber(e){return e.length>1&&(e=e.trimTH()),""!=e&&" "!=e&&!isNaN(e)}isAlpha(e){return this.extendedLetterPattern.test(e)}filterId(e){var t,n,r,i=e.length;if(i>100)return hex_md5(e);for(t=0;t<i;t++)(n=e.charCodeAt(t))>47&&n<58||n>63&&n<92||n>94&&n<124||(n>126||92==n||47==n||58==n||59==n||42==n||63==n||34==n||60==n||62==n||124==n||35==n||37==n||43==n||38==n||94==n)&&(r="^"+d2h(n),i=(e=e.substr(0,t)+r+e.substr(t+1)).length,t+=r.length-1);return e}}class h{constructor(){this.TEXTHELP_PREFIX="texthelp-",this.IGNORE_ATTR="ignore",this.ALLOW_ATTR="allow",this.PRON_ATTR="pron",this.COMMAND_ATTR="texthelpCmd",this.ARIA_ROLE_ATTR="role",this.ARIA_LABEL_ATTR="aria-label",this.ARIA_HIDDEN_ATTR="aria-hidden",this.bTexthelpPrefix=!1,this.strPrefix=""}setUseTexthelpPrefix(e){this.bTexthelpPrefix=!("boolean"!=typeof e)||e,this.bTexthelpPrefix?this.strPrefix=this.TEXTHELP_PREFIX:this.strPrefix=""}getIgnoreAttr(){return this.strPrefix+this.IGNORE_ATTR}getAllowAttr(){return this.strPrefix+this.ALLOW_ATTR}getPronunceAttr(){return this.strPrefix+this.PRON_ATTR}getCommandAttr(){return this.strPrefix+this.COMMAND_ATTR}rw_getAttribute(e,t){if(null!=e&&1==e.nodeType&&"string"==typeof t){var n=null;return 0!=t.indexOf("data-texthelp-")&&(n=e.getAttribute("data-texthelp-"+t)),null==n&&0!=t.indexOf("data-")&&(n=e.getAttribute("data-"+t)),null==n&&(n=e.getAttribute(t)),n}return null}rw_setAttribute(e,t,n){null!=e&&1==e.nodeType&&"string"==typeof t&&"string"==typeof n&&(0!=t.indexOf("data-")&&"style"!=t&&(t="data-"+t),e.setAttribute(t,n))}rw_removeAttribute(e,t){if(null!=e&&1==e.nodeType&&"string"==typeof t){if(0!=t.indexOf("data-")&&null!=e.getAttribute("data-"+t))return void e.removeAttribute("data-"+t);null!=e.getAttribute(t)&&e.removeAttribute(t)}}}const u={ignoreHidden:!0,ignoreFrames:!1,addEventsToFrames:!0,g_bAnnotationGlobalCheck:!1,g_bAnnotationGlobalUnknown:!1,g_nHighlightNotSyncedState:0,g_strStoredHighlightUnprocessedData:null,g_elemStoredHighlightLimitArea:null,bMathsSymbols:!1,mathWithContext:!1,overrideAriaHidden:!0,ariaLabelOnMathRoleEnabled:!0,ariaLabelOnMathJaxClassEnabled:!1,IELoadedFlag:!1,tagPage:!1,styleHacks:!1,no_scroll:!1,mathSymbolMapping:null,useCommands:!1,strAnnounceLinksAsWords:null,inlineImages:!1,voiceFromLangFlag:!0,playStartPoint:null,toolbarID:null,paths:{strFileLoc:"https://toolbar.speechstream.net/SpeechStream/v217/"},mathSre:{mathSpeakLocation:"toolbar.speechstream.net",mathSpeakVersion:"3.0.0-beta.6",sreSettings:{semantics:!0,domain:"clearspeak",style:"short",markup:"ssml_step",xpath:"https://toolbar.speechstream.net/MathSpeak/3.0.0-beta.6/wgxpath.install.js"},removeList:["start fraction","end fraction","start frac","end frac","StartFraction","EndFraction","empezar fracción","finalizar fracción","EndRoot","Baseline"],correctList:["square =squared","cube =cubed","RootIndex 3 StartRoot=cube root of","RootIndex 4 StartRoot=fourth root of","RootIndex 5 StartRoot=fifth root of","RootIndex 6 StartRoot=sixth root of","RootIndex 7 StartRoot=seventh root of","RootIndex 8 StartRoot=eighth root of","RootIndex 9 StartRoot=nineth root of","RootIndex 10 StartRoot=tenth root of","RootIndex n StartRoot=n-th root of","StartRoot=square root of","divide symbol=divided by","division-sign=divided by","division sign=divided by","Superscript ring=degrees","Superscript=to the power of",{regex:/\bdot\b/gi,replacement:"times"}]},init(e){({tagPage:this.tagPage,styleHacks:this.styleHacks,no_scroll:this.no_scroll,bMathsSymbols:this.bMathsSymbols,mathSymbolMapping:this.mathSymbolMapping,mathWithContext:this.mathWithContext,useCommands:this.useCommands,inlineImages:this.inlineImages,overrideAriaHidden:this.overrideAriaHidden=!0,playStartPoint:this.playStartPoint,ignoreHidden:this.ignoreHidden=!0,ignoreFrames:this.ignoreFrames=!1,addEventsToFrames:this.addEventsToFrames=!0,toolbarID:this.toolbarID}=e)}};let d;class g{constructor(){u.mathSre.mathSpeakLocation?this.mathSpeakLocation=u.mathSre.mathSpeakLocation:this.mathSpeakLocation="toolbar.speechstream.net",u.mathSre.removeList?this.removeList=u.mathSre.removeList:this.removeList=["start fraction","end fraction","start frac","end frac","StartFraction","EndFraction","empezar fracción","finalizar fracción","EndRoot","Baseline"],u.mathSre.correctList?this.correctList=u.mathSre.correctList:this.correctList=["square =squared","cube =cubed","RootIndex 3 StartRoot=cube root of","RootIndex 4 StartRoot=fourth root of","RootIndex 5 StartRoot=fifth root of","RootIndex 6 StartRoot=sixth root of","RootIndex 7 StartRoot=seventh root of","RootIndex 8 StartRoot=eighth root of","RootIndex 9 StartRoot=nineth root of","RootIndex 10 StartRoot=tenth root of","RootIndex n StartRoot=n-th root of","StartRoot=square root of","divide symbol=divided by","division-sign=divided by","division sign=divided by","Superscript ring=degrees","Superscript=to the power of",{regex:/\bdot\b/gi,replacement:"times"}],u.mathSre.mathSpeakVersion?this.mathSpeakVersion=u.mathSre.mathSpeakVersion:this.mathSpeakVersion="3.0.0-beta.6",u.mathSre.sreSettings?this.sreSettings=u.mathSre.sreSettings:this.sreSettings={semantics:!0,domain:"clearspeak",style:"short",markup:"ssml_step",xpath:"https://"+this.mathSpeakLocation+"/MathSpeak/"+this.mathSpeakVersion+"/wgxpath.install.js"},this.mathObjectArray,d?this.instance=d:(sre.System.getInstance().setupEngine(this.sreSettings),this.instance=sre.System.getInstance())}loadNewSreInstance(){"undefined"==typeof sre||(sre.System.getInstance().setupEngine(this.sreSettings),this.instance=sre.System.getInstance())}getRawTextFromMathJax(e){if(e.isMathJax){for(var t=e;null!=t&&t.isMathJax&&!t.id;)t=t.parentNode;t&&t.id?"math:"+t.id+";":"math:none;"}let n=e.ownerDocument.defaultView.MathJax.Hub.getJaxFor(e);if(null!=n){var r=this.sreSettings.markup;"none"!=this.sreSettings.markup&&(this.sreSettings.markup="none",this.loadNewSreInstance());var i=null,a="";try{(null!=(i=n.root.toMathML(""))||i.length>0)&&(a=(a=(a=(a=(a=(a=(a=this.instance.processExpression(i,!1,!1)).replace(/BOOKMARK MARK/g,"bookmark mark")).replace(/<bookmark mark="0"\/>/g,"")).replace(/a\./g,"a")).replace(new RegExp("silence msec","gi"),(function(e){return e.toLowerCase()}))).replace(new RegExp("\\bbold\\b","gi")," ")).replace(new RegExp("\\s{2,}/g")," "),a=this.filterMathSpeakFixUndesiredMathSpeakOutput(a))}catch(e){console.log(e)}return this.sreSettings.markup!=r&&(this.sreSettings.markup=r,this.loadNewSreInstance()),a}return""}getSpeech(e){if("string"==typeof e){let t=document.getElementById(e);if(null!=t&&1==t.isMathJax){let n=this.getMathMLText(e),r=this.getMathMLObject(e);return this.mathObjectArray=new Array,n=n.replace(/<\/([^>]+)/g,"</mathml:$1>"),n=n.replace(/<([^>]+)/g,"<mathml:$1>"),this.instance.processExpression(this.getMathMLWithBookmarks(this.mathObjectArray,r,n,!1,t.ownerDocument))}}return""}getSpeechWithBookmarks(e){if("string"==typeof e){this.sreSettings.markup;g_bSSMLSpeechEnabled&&"ssml_step"!=this.sreSettings.markup&&(this.sreSettings.markup="ssml_step",this.loadNewSreInstance());let t=document.getElementById(e);if(null!=t&&1==t.isMathJax){let n=this.getMathMLText(e),r=this.getMathMLObject(e);this.mathObjectArray=new Array;let i=this.instance.processExpression(this.getMathMLWithBookmarks(this.mathObjectArray,r,n,!0,t.ownerDocument));return i=i.replace(/BOOKMARK MARK/g,"bookmark mark"),text=text.replace('<speak version="1.1" xmlns="http://www.w3.org/2001/10/synthesis">','<speak version="1.1" xmlns="http://www.w3.org/2001/10/synthesis"\n                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n                   xsi:schemaLocation="http://www.w3.org/2001/10/synthesis\n                             http://www.w3.org/TR/speech-synthesis11/synthesis.xsd"\n                   ">'),text=text.replace('<prosody rate="100%">','<prosody rate="0%">'),text=text.replace("</prosody>",'<mark name="0"/>'),i=i.replace(/a\./g,"a."),i=i.replace(new RegExp("silence msec","gi"),(function(e){return e.toLowerCase()})),i=i.replace(new RegExp("\\bbold\\b","gi")," "),i=i.replace(new RegExp("\\s{2,}/g")," "),this.filterMathSpeakFixUndesiredMathSpeakOutput(i)}}return""}getSpeechFromElement(e){if(null!=e&&1==e.isMathJax){this.sreSettings.markup;"none"!=this.sreSettings.markup&&(this.sreSettings.markup="none",this.loadNewSreInstance());let t=this.getMathMLText(e),n=self.instance.processExpression(t);return n=n.replace(new RegExp("silence msec","gi"),""),n=n.replace(new RegExp("\\bbold\\b","gi")," "),n=n.replace(new RegExp("\\s{2,}/g")," "),this.filterMathSpeakFixUndesiredMathSpeakOutput(n)}return""}getSpeechWithBookmarksFromElement(e){if(null!=e&&1==e.isMathJax){let t="";try{let n=this.sreSettings.markup;"ssml_step"!=this.sreSettings.markup&&(this.sreSettings.markup="ssml_step",this.loadNewSreInstance());let r=this.getMathMLText(e),i=this.getMathMLObject(e);this.mathObjectArray=new Array;let a=this.getMathMLWithBookmarks(this.mathObjectArray,i,r,!0,e.ownerDocument);""!=a&&(t=this.instance.processExpression(a),t=t.replace(/BOOKMARK MARK/g,"bookmark mark"),t=t.replace('<?xml version="1.0"?><speak version="1.1" xmlns="http://www.w3.org/2001/10/synthesis">',""),t=t.replace('<prosody rate="100%">','<prosody rate="0%">'),t=t.replace("</speak>",""),t=t.replace(new RegExp('interpret-as="character"',"g"),'interpret-as="spell"'),t=t.replace(new RegExp("silence msec","gi"),(function(e){return e.toLowerCase()})),t=t.replace(new RegExp("\\bbold\\b","gi")," "),t=t.replace(new RegExp("\\s{2,}/g")," "),t=this.filterMathSpeakFixUndesiredMathSpeakOutput(t),this.sreSettings.markup!=n&&(this.sreSettings.markup=n,this.loadNewSreInstance()))}catch(e){console.log(e)}return t}return""}getMathMLOriginalText(e){if("string"==typeof e){let t=document.getElementById(e);if(null!=t&&1==t.isMathJax){let t=document.getElementById(e);return t.ownerDocument.defaultView.MathJax.Hub.getJaxFor(t).originalText}}return""}getMathMLText(e){if(null!=e&&1==e.isMathJax){let t=e.ownerDocument.defaultView.MathJax.Hub.getJaxFor(e).root.toMathML(),n=(new DOMParser).parseFromString(t,"text/xml");return"parsererror"!=n.documentElement.nodeName&&"parsererror"!=n.documentElement.firstChild.nodeName||(t=""),t}return""}getMathMLObject(e){return null!=e&&1==e.isMathJax?e.ownerDocument.defaultView.MathJax.Hub.getJaxFor(e).root:""}isMathML(e){if("string"==typeof e){let t=document.getElementById(e);if(null!=t&&1==t.isMathJax)return!0}return!1}getMathMLWithBookmarks(e,t,n,r,i){if(null!=n&&(n=n.replace(/<mathml:math.*>/,'<math xmlns="http://www.w3.org/1998/Math/MathML">')),null!=t.data)for(let a=0;a<t.data.length;a++)if(null!=t.data[a]){let s=t.data[a].spanID?t.data[a].spanID:t.data[a].CHTMLnodeID;if(s=null!=s&&null!=s?s:t.data[a].PHTMLspanID,t.data[a].toMathML&&t.data[a].toMathML()&&null!=s&&null!=t.data[a].data[0]&&null!=t.data[a].data[0].data[0]&&null==t.data[a].data[0].data[0].toMathML){let o,l=new Object;l.data=t.data[a],l.span=t.data[a].toMathML(),l.jaxSpanid=s,l.htmlElem=i.getElementById("MathJax-Span-"+l.jaxSpanid),-1==n.indexOf(l.span)&&(l.span=l.span.replace(/>.*</,">"+t.data[a].data[0].data[0]+"<")),o=r?l.span.replace(">",' extid="'+s+'">'):l.span.replace(">",' nobookmark ="">'),n=n.replace(l.span,o),e.push(l)}n=this.getMathMLWithBookmarks(e,t.data[a],n,r,i)}return n}getMathMLTextWithBookmarks(e){if("string"==typeof e){let t=document.getElementById(e);if(null!=t&&1==t.isMathJax){let t=document.getElementById(e),n=this.getMathMLText(e),r=this.getMathMLObject(e),i=new Array;return this.getMathMLWithBookmarks(i,r,n,!0,t.ownerDocument)}}return""}filterMathSpeakFixUndesiredMathSpeakOutput(e){var t,n,r,i,a,s=e,o=this.removeList.length;for(t=0;t<o;t++)for(r=this.removeList[t],n=s.indexOf(r);n>-1;)n=(s=s.replace(r,"")).indexOf(r);for(o=this.correctList.length,t=0;t<o;t++){const e=this.correctList[t];if("string"==typeof e)a=this.correctList[t].split("="),r=new RegExp(a[0],"gi"),i=a[1];else{if(!e.regex)continue;r=e.regex,i=e.replacement}s=s.replace(r,i)}return s!=e?s:e}}var c="texthelphighlightspan",m="thspan",p="thspan",f=["p","br","head","body","hr","div","h1","h2","h3","h4","h5","h6","blockquote","table","tbody","tr","td","th"],S=["em","strong","b","i","u","tt","font","kbd","dfn","cite","sup","sub","a","embed","span","small","nobr","wbr","acronym","abbr","code","s","chunk","th:pron","img","/th:pron","w","/w","lic/lic","break","silence","thspan","beelinereader","x-marker",c,m];function v(e){p=e}function w(e){m=e}function b(e){c=e}function y(e,t){f=t?e:f.concat(e)}function C(e,t){S=t?e:S.concat(e)}const T=/[\n\r\t ]{2,}/g;class x{constructor(e,t){if(this.CMD_LIST="list",this.CMD_STOP="stop",this.CMD_STOPAFTER="stopafter",this.CMD_JUMP="jump",this.CMD_JUMPBACK="jumpback",this.CMD_VOICE="voice",this.CMD_PAGEID="pageid",this.CMD_BOOKID="bookid",this.CMD_EXEC="exec",this.CMD_EXECAFTER="execafter",this.command=null,this.param=null,this.element=t,null!=e){var n=e.indexOf(":");n>-1?(this.command=e.substr(0,n).toLowerCase(),this.param=e.substr(n+1)):this.command=e.toLowerCase()}}}class _{constructor(){}getActualNextNodeIgnoreChildren(e,t){if(null==e||e==t)return null;if(null!=e.nextSibling)return e.nextSibling;for(var n=e;null!=n;){if(t==(n=n.parentNode))return null;if(null!=n.nextSibling)return n.nextSibling}return null}getActualNextNode(e,t){if(null==e)return null;if(null!=e.firstChild)return e.firstChild;if(e==t)return null;if(null!=e.nextSibling)return e.nextSibling;for(var n=e;null!=n;){if(t==(n=n.parentNode))return null;if(null!=n.nextSibling)return n.nextSibling}return null}getNodeFromPosition(e,t){var n=new h,r=e;if(t.lastIndexOf("*")>-1){var i=t.lastIndexOf("*");t=t.substring(i+1)}var a,s=t.split("~");for(a=s.length-2;a>-1;a--){if(null==(r=r.firstChild))return null;var o;o=0==s[a].length?0:parseInt(s[a],10);for(var l=!1,u=3==r.nodeType||1==r.nodeType&&r.tagName.toLowerCase()==c&&null!=n.rw_getAttribute(r,"rwstate");o>0;){if(null==(r=r.nextSibling))return null;(l=3==r.nodeType||1==r.nodeType&&r.tagName.toLowerCase()==c&&null!=n.rw_getAttribute(r,"rwstate"))&&u||(--o,u=l)}}return r}getTextFromNode(e){var t=new M,n=new h,r="";if(t.isInvalidNode(e)||t.isIgnored(e)||t.isAriaHidden(e))return r;if(3==e.nodeType)"textarea"!=e.parentNode.tagName.toLowerCase()&&("option"==e.parentNode.tagName.toLowerCase()?null==(r=t.getDropdownSelectedItem(e.parentNode.parentNode))||""==r?r=e.nodeValue:e.parentNode.selected||(r=""):r=e.nodeValue);else if(1==e.nodeType){var i=e.tagName.toLowerCase();if("img"==i)null==(a=n.rw_getAttribute(e,"msg"))&&(a=n.rw_getAttribute(e,"alt")),null!=a&&a.trimTH().length>0&&(r=" "+a.trimTH()+" ");else if("span"==i||"thspan"==i){if(null!=(a=n.rw_getAttribute(e,"pron"))&&a.trimTH().length>0&&(r=a.trimTH()),null!=(a=n.rw_getAttribute(e,"chunk"))&&"1"==a&&(r=e.innerHTML),a=e.isMathJax)r=(new g).getSpeechWithBookmarksFromElement(e)}else if("acronym"==i||"abbr"==i){var a=n.rw_getAttribute(e,"pron"),s=new l;(null!=a&&s.trim(a).length>0||null!=(a=e.getAttribute("title"))&&s.trim(a).length>0)&&(r=s.trim(a))}else"math"==i&&(r=this.getTextFromMathMl(e))}return r}getNextNodeAllowMoveToChild(e,t,n){return this.getNextNodeImpl(e,t,n,!0,!1)}getNextNodeIgnoreChildren(e,t,n){return this.getNextNodeImpl(e,t,n,!1,!0)}getLastChildTextNode(e,t){var n=new h,r=new M;if(null==e||null==e.lastChild||r.isInvalidNode(e))return e;if(r.isSpecialCaseWithIgnoredContent(e))return e;for(var i=e.lastChild;null!=i;){var a=r.isIgnored(e)||r.isAriaHidden(e);if(!a&&3==i.nodeType)return i;if(!a&&1==i.nodeType&&t&&"img"==i.tagName.toLowerCase()&&(null!=n.rw_getAttribute(i,"msg")&&n.rw_getAttribute(i,"msg").length>0||null!=n.rw_getAttribute(i,"alt")&&n.rw_getAttribute(i,"alt").length>0))return i;if(r.isInvalidNode(i)||null==i.lastChild||r.isSpecialCaseWithIgnoredContent(e))return t?this.getPreviousTextNode(i,!1,e):this.getPreviousTextNodeNoImg(i,!1,e,!0);i=i.lastChild}return e}getPreviousTextNodeNoImg(e,t,n,r,i){for(var a=r?this.getPreviousTextNode(e,t,n):this.getPreviousTextNodeNoBlank(e,t,n,i);null!=a&&3!=a.nodeType&&a!=n&&(null==a.tagName||"math"!=a.tagName.toLowerCase())&&!a.isMathJax;)a=r?this.getPreviousTextNode(a,t,n):this.getPreviousTextNodeNoBlank(a,t,n,i);return a}getPreviousTextNodeNoBlank(e,t,n,r){for(var i=new h,a=new M,s=e;null!=s&&s!=n;)if(null!=(s=this.getPreviousTextNode(s,t,n))){var o;if(3==s.nodeType)o=s.nodeValue.trimTH();else if("img"!=s.tagName.toLowerCase()||null==i.rw_getAttribute(s,"alt")&&null==i.rw_getAttribute(s,"msg")){if(null!=s.tagName&&"math"==s.tagName.toLowerCase())o=this.getTextFromMathMl(s);else if(s.isMathJax){o=(new g).getRawTextFromMathJax(s)}}else null==(o=i.rw_getAttribute(s,"msg").trimTH())&&(o=i.rw_getAttribute(s,"alt").trimTH());if(a.rw_isWordSpeakable(o,r))return s}return null}getPreviousTextNode(e,t,n){for(var r=new h,i=e,a=!1;null!=i&&i!=n;)if(null!=(i=this.getPreviousNode(i,t,n))){if(3==i.nodeType&&"textarea"!=i.parentNode.tagName.toLowerCase()&&i.nodeValue.length>0&&(a=!0),1==i.nodeType&&null!=i.tagName&&"math"==i.tagName.toLowerCase())a=!0;else if(1==i.nodeType&&i.isMathJax)a=!0;else if(1==i.nodeType&&"img"==i.tagName.toLowerCase()){var s=r.rw_getAttribute(i,"msg");null==s&&(s=r.rw_getAttribute(i,"alt")),null!=s&&s.length>0&&(a=!0)}if(a)return i}return null}getPreviousNode(e,t,n){var r=new M;if(null==e||e==n)return null;var i=e;if(null!=i.previousSibling){if(i=i.previousSibling,t&&!r.isStyleNode(i))return null;if(null!=i&&r.isInvalidNode(i)){if(n==i)return null;i=this.getPreviousNode(i,t,n)}else{for(;null!=i&&null!=i.lastChild&&!r.isSpecialCaseWithIgnoredContent(i);)if(i=i.lastChild,t&&(r.isStyleNode(i)||(i=null)),null!=i&&r.isInvalidNode(i)){if(n==i)return null;i=this.getPreviousNode(i,t,n);break}if(null!=i&&(r.isIgnored(i)||r.isAriaHidden(i))){if(i==n)return null;i=this.getPreviousNode(i,t,n)}}}else if(i=i.parentNode,t&&null!=i&&(r.isStyleNode(i)||(i=null)),null!=i&&(r.isIgnored(i)||r.isAriaHidden(i))){if(i==n)return null;i=this.getPreviousNode(i,t,n)}return i}getFirstChildTextNode(e,t){var n=new M,r=new h;if(null==e||null==e.firstChild||n.isInvalidNode(e))return e;if(n.isSpecialCaseWithIgnoredContent(e))return e;var i=e.firstChild;return 3==i.nodeType||1==i.nodeType&&t&&"img"==i.tagName.toLowerCase()&&(null!=r.rw_getAttribute(i,"msg")&&r.rw_getAttribute(i,"msg").length>0||null!=r.rw_getAttribute(i,"alt")&&r.rw_getAttribute(i,"alt").length>0)?i:t?this.getNextTextNode(i,!1,e):this.getNextTextNodeNoImg(i,!1,e,!0)}getNextTextNodeNoImg(e,t,n,r){for(var i=r?this.getNextTextNode(e,t,n):this.getNextTextNodeNoBlank(e,t,n);null!=i&&3!=i.nodeType&&i!=n&&(null==i.tagName||"math"!=i.tagName.toLowerCase())&&!i.isMathJax;)i=r?this.getNextTextNode(i,t,n):this.getNextTextNodeNoBlank(i,t,n);return i}getNextTextNodeNoBlank(e,t,n,r){for(var i=new h,a=new M,s=e;null!=s&&s!=n;)if(null!=(s=this.getNextTextNode(s,t,n))){var o;if(3==s.nodeType)o=s.nodeValue.trimTH();else if("img"!=s.tagName.toLowerCase()||null==i.rw_getAttribute(s,"alt")&&null==i.rw_getAttribute(s,"msg")){if(null!=s.tagName&&"math"==s.tagName.toLowerCase())o=this.getTextFromMathMl(s);else if(s.isMathJax){o=(new g).getRawTextFromMathJax(s)}}else null==(o=i.rw_getAttribute(s,"msg"))&&(o=i.rw_getAttribute(s,"alt")),null!=o&&o.trimTH();if(a.rw_isWordSpeakable(o,r))return s}return null}getTextFromMathMl(e){var t,n=new M;if(null!=e.previousSibling||null!=e.nextSibling){var r=n.createWrapperElement();e.parentNode.replaceChild(r,e),r.appendChild(e)}return null!=(t=e.parentNode.innerHTML)&&t.length>0?t:""}getNextTextNode(e,t,n){for(var r=new h,i=e,a=!1;null!=i&&i!=n;)if(null!=(i=this.getNextNode(i,t,n))){if(3==i.nodeType&&"textarea"!=i.parentNode.tagName.toLowerCase()&&i.nodeValue.length>0&&(a=!0),1==i.nodeType&&null!=i.tagName&&"math"==i.tagName.toLowerCase())a=!0;else if(1==i.nodeType&&i.isMathJax)a=!0;else if(1==i.nodeType&&"img"==i.tagName.toLowerCase()){var s=r.rw_getAttribute(i,"msg");null==s&&(s=r.rw_getAttribute(i,"alt")),null!=s&&s.length>0&&(a=!0)}if(a)return i}return null}getNextNode(e,t,n){return this.getNextNodeImpl(e,t,n,!1,!1)}getNextNodeImpl(e,t,n,r,i){var a=new M;if(null==e||e==n&&(i||!r))return null;var s=a.isInvalidNode(e);a.isSpecialCaseWithIgnoredContent(e)&&(s=!0);var o=null;if(e==n&&r){if(s||null==e.firstChild)return null;o=e.firstChild}else if(null==(o=e).firstChild||s||i){if(null!=o.firstChild&&i&&null!=n&&a.checkIfElementInsideElement(n,o))return null;if(null!=o.nextSibling)o=o.nextSibling;else{for(;null!=o&&null==o.nextSibling&&(o=o.parentNode,t&&(a.isStyleNode(o)||(o=null)),n!=o););null!=o&&n!=o&&(o=o.nextSibling)}}else o=o.firstChild;return null!=o&&t&&(a.isStyleNode(o)||(o=null)),null!=o&&(a.isInvalidNode(o)?o=this.getNextNodeImpl(o,t,n,!1,!0):(a.isIgnored(o)||a.isAriaHidden(o))&&(o=this.getNextNodeImpl(o,t,n,!1,!1)),r&&o==n&&e==n&&(o=null)),o}findCommands(e){var t=[];if(null!=e){let s=e.ownerDocument.body,o=e.getRootNode();o.mode&&"open"==o.mode&&(s=o);var n=e;if(3==n.nodeType&&null!=n.parentNode&&(n=n.parentNode),1!=n.nodeType)return t;for(var r=new h;null!=n&&n!=s;){if(null!=r.rw_getAttribute(n,"texthelpCmd")){var i=r.rw_getAttribute(n,"texthelpCmd").trimTH();if(i==this.CMD_LIST||i==this.CMD_LIST+":"){var a=1;for(i=r.rw_getAttribute(n,"texthelpCmd"+a);null!=i;)t.push(new x(i,n)),++a,i=r.rw_getAttribute(n,"texthelpCmd"+a)}else t.push(new x(i,n));break}n=n.parentNode}}return t}findCommandNode(e){if(null!=e){var t=e.ownerDocument.body,n=e;if(3==n.nodeType&&(n=n.parentNode),1!=n.nodeType)return null;for(var r=new h;null!=n&&n!=t;){if(null!=r.rw_getAttribute(n,"texthelpCmd"))return n;n=n.parentNode}}return null}actOnPageIDCommand(e){if(u.useCommands){var t=e.getCaretRange();if(null!=t){var n=this.findCommandsInRange(t);if(n.length>0){let t=new l;for(var r=0;r<n.length;r++){var i=n[r];i.command==i.CMD_&&(e.pageId=t.filterId(i.param))}}}}}checkForCommandChange(e,t){var n=this.findCommandNode(e),r=e;for(r=this.getNextNodeAllowMoveToChild(r,!1,t);null!=r;){var i=this.findCommandNode(r);if(null==n)n=i;else if(i!=n){var a=this.getPreviousTextNodeNoBlank(r,!1,e);return null==a&&null==(a=this.getPreviousTextNode(r,!1,e))?null:3==a.nodeType?new s(a,a.nodeValue.length,!1):new s(a,0,!0)}r=this.getNextNode(r,!1,t)}return null}getLangAttr(e){for(var t=e;null!=t;){if(1==t.nodeType){var n=t.getAttribute("lang");if(null!=n&&n.length>0)return n;try{if(null!=(n=t.getAttribute("xml:lang"))&&n.length>0)return n}catch(e){}}t=t.parentNode}return null}checkForVoiceChange(e,t,n){var r=e;for(r=this.getNextNodeAllowMoveToChild(r,!1,t);null!=r;){if(this.getLangAttr(r)!=n){var i=this.getPreviousTextNodeNoBlank(r,!1,e);if(null==i&&null==(i=this.getPreviousTextNode(r,!1,e)))return null;if(3==i.nodeType)return new s(i,i.nodeValue.length,!1);var a=new s(i,0,!0);return a.setSpecialCase(!0),a}r=this.getNextNode(r,!1,t)}return null}}class N{constructor(e,t,n){this.body=e,this.startRef=t,this.endRef=n}equals(e){return this.body==e.body&&this.startRef.path==e.startRef.path&&this.startRef.offset==e.startRef.offset&&this.endRef.path==e.endRef.path&&this.endRef.offset==e.endRef.offset}toString(){return null!=this.getAsRange()?g_bIEOld?this.getAsRange().text:this.getAsRange().toString():""}getAsRange(){var e=null;void 0!==this.body&&null!=this.body||(this.body=document.body),e=this.body.ownerDocument.createRange();var t=new I(this.body,this.startRef.path,this.startRef.offset,this.endRef.path,this.endRef.offset),n=t.leftCaret,r=t.rightCaret;return null!=n&&null!=r?(e.setStart(n.node,n.offset),e.setEnd(r.node,r.offset)):e=null,e}clone(){return new N(this.body,this.startRef,this.endRef)}rw_getTHCaretRangeFromTHRange(){var e=new M;if(null==this.startRef||null==this.endRef)return null;var t=e.getCaretFromDomPosition(this.body,this.startRef.path,this.startRef.offset,!0),n=e.getCaretFromDomPosition(this.body,this.endRef.path,this.endRef.offset,!1);if(null!=t&&null!=n){var r=new I;return r.setCaretRange(t,n),r}return null}rw_getTHRangeFromElement(e){if(null==e)return null;var t=new M,n=new _;if(t.isSpecialCaseNested(e)){var r=t.checkForSpecialParent(e);return new N(r.ownerDocument.body,t.rw_getRefPt(r,0),t.rw_getRefPt(r,0))}if(3==e.nodeType)return new N(e.ownerDocument.body,t.rw_getRefPt(e,0),t.rw_getRefPt(e,e.nodeValue.length));var i=n.getFirstChildTextNode(e,!0),a=n.getLastChildTextNode(e,!0),s=3==a.nodeType?a.nodeValue.length:0;return new N(e.ownerDocument.body,t.rw_getRefPt(i,0),t.rw_getRefPt(a,s))}}//!*
//*! Used by safariReader
class E{constructor(e,t){this.path=e,this.offset=t}toString(){return"THDomRefPt "+this.path+" "+this.offset}getPath(){return this.path}getOffset(){return this.getOffset}}//!*
class A{constructor(){}setMathSymbolControl(e,t){this.mathSymbolControl=e,this.mathWithContext=t}getSentenceFromPoint(e){if(null!=e.node.tagName&&"img"==e.node.tagName.toLowerCase()){(t=new I).setCaretRange(e,e)}else{var t,n=this.getSentenceBreakToRight(e),r=this.getSentenceBreakToLeft(n);if(null==r||null==n)return null;(t=new I).setCaretRange(r,n)}return t}getNextSentence(e,t){var n=new _,r=new M;if(null==e)return null;void 0===t&&(t=null);var i,a,o=e.rightCaret.node,l=e.rightCaret.offset;if(r.rw_checkForHiddenParent(e.rightCaret.node))return null;for(e.rightCaret.isSpecialCase()&&(o=n.getNextNodeIgnoreChildren(o,!1,t),l=0);null!=o;){if(3==o.nodeType&&l<o.nodeValue.length){if(null==(i=this.getSentenceBreakToRight(new s(o,l,!1),t)))return null;if(i.node==o&&i.offset==l){if(null==(h=n.getNextTextNodeNoBlank(o,!1,t)))return null;i=this.getSentenceBreakToRight(new s(h,0,!1),t)}}else{var h;if(null==(h=n.getNextTextNodeNoBlank(o,!1,t)))return null;i=this.getSentenceBreakToRight(new s(h,0,!1),t)}if(null==(a=this.getSentenceBreakToLeft(i,null)))return null;if(e.leftCaret.node!=a.node||e.leftCaret.offset!=a.offset){var u=new I;if(u.setCaretRange(a,i),this.checkSentence(u)&&r.rw_caretRangeIsSpeakable(u,this.mathSymbolControl))return u}if(3==(o=i.node).nodeType){var d=o.nodeValue.replace(/[\x21\x3f\x3a]/g,"."),g=d.indexOf(".",i.offset+1);l=-1==g?d.length:g}}return null}checkSentence(e){for(var t=new h,n=e.leftCaret.node,r=n.ownerDocument.body;null!=n&&n!=r;){if(1==n.nodeType){if("rwDictDefin"==n.className||"rwPopupContent"==n.className||"rwToolbarBarCollect"==n.className)break;if(null!=t.rw_getAttribute(n,"rwTHcomp"))return!1}n=n.parentNode}var i=e.rightCaret.node;if(i!=n)for(;null!=i&&i!=r&&"rwDictDefin"!=i.className&&"rwPopupContent"!=i.className&&"rwToolbarBarCollect"!=i.className;){if(1==i.nodeType&&null!=t.rw_getAttribute(i,"rwTHcomp"))return!1;i=i.parentNode}return!0}getPreviousSentence(e,t){var n=new _,r=new M;void 0===t&&(t=null);for(var i,a,o=e.leftCaret.node,l=e.leftCaret.offset;null!=o;){if(3==o.nodeType){var h,u=o.nodeValue.replace(/[\x21\x3f\x3a]/g,".");for(h=l>0?u.lastIndexOf(".",l):0==l?-1:u.lastIndexOf(".");h>-1;){if(l=h,null==(a=this.getSentenceBreakToRight(new s(o,l,!0),t)))return null;if(a.node!=e.rightCaret.node||a.offset!=e.rightCaret.offset){if(null==(i=this.getSentenceBreakToLeft(a,t)))return null;if((d=new I).setCaretRange(i,a),this.checkSentence(d)&&r.rw_caretRangeIsSpeakable(d,this.mathSymbolControl))return d}h=0==h?-1:u.lastIndexOf(".",h-1)}}l=-1;let g=n.getPreviousTextNodeNoImg(o,!0,t,!1,this.mathSymbolControl);if(null!=g)o=g;else if(null!=(o=n.getPreviousTextNodeNoBlank(o,!1,t,this.mathSymbolControl))){if(null==(a=3==o.nodeType?this.getSentenceBreakToRight(new s(o,o.nodeValue.length,!1),t):this.getSentenceBreakToRight(new s(o,0,!1),t)))return null;if(null==(i=this.getSentenceBreakToLeft(a,t)))return null;var d;if(a.node!=e.rightCaret.node||a.offset!=e.rightCaret.offset)if((d=new I).setCaretRange(i,a),this.checkSentence(d)&&r.rw_caretRangeIsSpeakable(d,this.mathSymbolControl))return d}}return null}getSentenceBreakToLeft(e,t){var n=new _,r=new M;if(void 0===t&&(t=null),null==e||null==e.node)return null;var i=e.node,a=e.offset;if(1==e.node.nodeType&&"math"==e.node.tagName.toLowerCase())return e;if(1==e.node.nodeType&&e.node.isMathJax)return e;if(e.forwardBias)3==i.nodeType&&a==i.nodeValue.length&&(a=0,null==(i=n.getNextTextNode(i,!0,t))&&(i=e.node,a=e.offset));else if(a>0)--a;else{if(null==(i=n.getPreviousTextNode(i,!0,t)))return e;if(3==i.nodeType)a=i.nodeValue.length-1;else{if(a=0,null!=i.tagName&&"math"==i.tagName.toLowerCase())return e;if(i.isMathJax)return e}}if(3==i.nodeType){var o=i.nodeValue.charAt(a);if("."==o||"!"==o||"?"==o||":"==o)if(a>0)--a;else{if(null==(i=n.getPreviousTextNode(i,!0,t)))return e;if(3==i.nodeType)a=i.nodeValue.length-1;else{if(a=0,null!=i.tagName&&"math"==i.tagName.toLowerCase())return e;if(i.isMathJax)return e}}}for(var h=i,u=a,d=i,g=a,c=!1,m=" ";!c;){if(r.isSpecialCaseNested(d)){if(null!=(d=r.checkForSpecialParent(d)).tagName&&"math"==d.tagName.toLowerCase()){c=!0;break}if(d.isMathJax){c=!0;break}h=d,u=0}else if(3==d.nodeType){var p;if((p=d.nodeValue).length>0){-1==g&&(g=p.length);for(var f=(p=p.replace(/[\x21\x3f\x3a]/g,".")).lastIndexOf(".",g);f>-1;){if(r.rw_isFullStop(p,f,d)){if(f<p.length-1){h=d,u=f+1,c=!0;break}if(!r.rw_isTextChar(m)){c=!0;break}}f=0==f?-1:p.lastIndexOf(".",f-1)}if(c)break;(new l).trim(p).length>0&&(h=d,u=0),m=p.charAt(0)}}if(g=-1,null==(d=n.getPreviousNode(d,!0,t))){c=!0;break}if(3==d.nodeType&&r.isSpecialCaseNested(d)&&null==(d=r.checkForSpecialParent(d))){c=!0;break}}if(3==h.nodeType&&u<(p=h.nodeValue).length)for(;u<p.length&&r.rw_isWhiteSpace(p.charAt(u));)++u;return new s(h,u,!0)}getSentenceBreakToRight(e,t){var n=new _,r=new M;if(void 0===t&&(t=null),null==e||null==e.node)return null;for(var i=e.node,a=e.offset,o=i,h=a,u=!1,d=" ";!u;){if(r.isSpecialCaseNested(i)){if(null!=(i=r.checkForSpecialParent(i)).tagName&&"math"==i.tagName.toLowerCase()){u=!0;break}if(i.isMathJax){u=!0;break}o=i,h=0,i=n.getNextNodeIgnoreChildren(i,!0,t)}else if(3==i.nodeType){if((m=i.nodeValue).length>0){if("."==d){var g=m.charAt(a);if(!r.rw_isTextChar(g)){u=!0;break}}for(var c=(m=m.replace(/[\x21\x3f\x3a]/g,".")).indexOf(".",a);c>-1;){if(r.rw_isFullStop(m,c,i)){c<m.length-1&&(o=i,h=c+1,u=!0);break}a=c+1,c=m.indexOf(".",a)}if(u)break;(new l).trim(m).length>0&&(o=i,h=m.length),"."==(d=m.charAt(m.length-1))&&(r.rw_isFullStop(m,m.length-1,i)||(d=" "))}i=n.getNextNode(i,!0,t)}else i=n.getNextNode(i,!0,t);if(a=0,null==i){u=!0;break}}if(3==o.nodeType){var m=o.nodeValue;if(h>0&&h<=m.length)for(;h>0&&r.rw_isWhiteSpace(m.charAt(h-1));)--h}return new s(o,h,!1)}tagSentences(e){if(null!=e){var t=new _,n=new M,r=new h;try{for(var i=t.getNextNodeAllowMoveToChild(e,!1,e);null!=i;)if(3==i.nodeType){if("textarea"==i.parentNode.tagName.toLowerCase()){i=t.getNextNode(i,!1,e);continue}var a,s=i.nodeValue;if(!(s.trimSpaceTH().length>0)){i=t.getNextNode(i,!1,e);continue}a=s.search("[\\x21\\x2E\\x3F\\x3A]");var o=null!=r.rw_getAttribute(i.parentNode,"texthelpSkip");if(a>-1&&a<s.length-1){for(var l=!0;;){if(n.rw_isFullStop(s,a,i))break;var u=s.substring(a+1).search("[\\x21\\x2E\\x3F\\x3A]");if(!(u>-1)){l=!1;break}a=a+1+u}if(l){var d=s.substring(0,a+1),g=s.substring(a+1),c=n.createWrapperElement();r.rw_setAttribute(c,"rwTHpgen","1");var m=document.createTextNode(d),p=document.createTextNode(g);(f=i.parentNode).insertBefore(p,i),f.insertBefore(c,p),c.appendChild(m),f.removeChild(i),i=p,m}else{if(null!=i.previousSibling||null!=i.nextSibling||o){c=n.createWrapperElement();r.rw_setAttribute(c,"rwTHpgen","1");m=document.createTextNode(s);(f=i.parentNode).insertBefore(c,i),c.appendChild(m),f.removeChild(i),i=m}i,i=t.getNextNode(i,!1,e)}}else{if(null!=i.previousSibling||null!=i.nextSibling||o){c=n.createWrapperElement();r.rw_setAttribute(c,"rwTHpgen","1");var f;m=document.createTextNode(s);(f=i.parentNode).insertBefore(c,i),c.appendChild(m),f.removeChild(i),i=m}i,i=t.getNextNode(i,!1,e)}}else if(1==i.nodeType){var S=r.rw_getAttribute(i,"rwTHcomp"),v=r.rw_getAttribute(i,"rwDontAlter"),w=r.rw_getAttribute(i,"rwstate");"pre"==i.tagName.toLowerCase()||"button"==i.tagName.toLowerCase()||null!=S&&S.length>0||null!=v&&v.length>0||null!=w&&w.length>0?(i=t.getNextNodeIgnoreChildren(i,!1,e),!0):i=t.getNextNode(i,!1,e)}else i=t.getNextNode(i,!1,e)}catch(e){}}}}const k={isIgnorePageDefault:()=>!1};class P{constructor(){this.hexcase=0,this.b64pad="",this.chrsz=8}hex_md5(e){return this.binl2hex(this.core_md5(this.str2binl(e),e.length*this.chrsz))}core_md5(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var n=1732584193,r=-271733879,i=-1732584194,a=271733878,s=0;s<e.length;s+=16){var o=n,l=r,h=i,u=a;n=this.md5_ff(n,r,i,a,e[s+0],7,-680876936),a=this.md5_ff(a,n,r,i,e[s+1],12,-389564586),i=this.md5_ff(i,a,n,r,e[s+2],17,606105819),r=this.md5_ff(r,i,a,n,e[s+3],22,-1044525330),n=this.md5_ff(n,r,i,a,e[s+4],7,-176418897),a=this.md5_ff(a,n,r,i,e[s+5],12,1200080426),i=this.md5_ff(i,a,n,r,e[s+6],17,-1473231341),r=this.md5_ff(r,i,a,n,e[s+7],22,-45705983),n=this.md5_ff(n,r,i,a,e[s+8],7,1770035416),a=this.md5_ff(a,n,r,i,e[s+9],12,-1958414417),i=this.md5_ff(i,a,n,r,e[s+10],17,-42063),r=this.md5_ff(r,i,a,n,e[s+11],22,-1990404162),n=this.md5_ff(n,r,i,a,e[s+12],7,1804603682),a=this.md5_ff(a,n,r,i,e[s+13],12,-40341101),i=this.md5_ff(i,a,n,r,e[s+14],17,-1502002290),r=this.md5_ff(r,i,a,n,e[s+15],22,1236535329),n=this.md5_gg(n,r,i,a,e[s+1],5,-165796510),a=this.md5_gg(a,n,r,i,e[s+6],9,-1069501632),i=this.md5_gg(i,a,n,r,e[s+11],14,643717713),r=this.md5_gg(r,i,a,n,e[s+0],20,-373897302),n=this.md5_gg(n,r,i,a,e[s+5],5,-701558691),a=this.md5_gg(a,n,r,i,e[s+10],9,38016083),i=this.md5_gg(i,a,n,r,e[s+15],14,-660478335),r=this.md5_gg(r,i,a,n,e[s+4],20,-405537848),n=this.md5_gg(n,r,i,a,e[s+9],5,568446438),a=this.md5_gg(a,n,r,i,e[s+14],9,-1019803690),i=this.md5_gg(i,a,n,r,e[s+3],14,-187363961),r=this.md5_gg(r,i,a,n,e[s+8],20,1163531501),n=this.md5_gg(n,r,i,a,e[s+13],5,-1444681467),a=this.md5_gg(a,n,r,i,e[s+2],9,-51403784),i=this.md5_gg(i,a,n,r,e[s+7],14,1735328473),r=this.md5_gg(r,i,a,n,e[s+12],20,-1926607734),n=this.md5_hh(n,r,i,a,e[s+5],4,-378558),a=this.md5_hh(a,n,r,i,e[s+8],11,-2022574463),i=this.md5_hh(i,a,n,r,e[s+11],16,1839030562),r=this.md5_hh(r,i,a,n,e[s+14],23,-35309556),n=this.md5_hh(n,r,i,a,e[s+1],4,-1530992060),a=this.md5_hh(a,n,r,i,e[s+4],11,1272893353),i=this.md5_hh(i,a,n,r,e[s+7],16,-155497632),r=this.md5_hh(r,i,a,n,e[s+10],23,-1094730640),n=this.md5_hh(n,r,i,a,e[s+13],4,681279174),a=this.md5_hh(a,n,r,i,e[s+0],11,-358537222),i=this.md5_hh(i,a,n,r,e[s+3],16,-722521979),r=this.md5_hh(r,i,a,n,e[s+6],23,76029189),n=this.md5_hh(n,r,i,a,e[s+9],4,-640364487),a=this.md5_hh(a,n,r,i,e[s+12],11,-421815835),i=this.md5_hh(i,a,n,r,e[s+15],16,530742520),r=this.md5_hh(r,i,a,n,e[s+2],23,-995338651),n=this.md5_ii(n,r,i,a,e[s+0],6,-198630844),a=this.md5_ii(a,n,r,i,e[s+7],10,1126891415),i=this.md5_ii(i,a,n,r,e[s+14],15,-1416354905),r=this.md5_ii(r,i,a,n,e[s+5],21,-57434055),n=this.md5_ii(n,r,i,a,e[s+12],6,1700485571),a=this.md5_ii(a,n,r,i,e[s+3],10,-1894986606),i=this.md5_ii(i,a,n,r,e[s+10],15,-1051523),r=this.md5_ii(r,i,a,n,e[s+1],21,-2054922799),n=this.md5_ii(n,r,i,a,e[s+8],6,1873313359),a=this.md5_ii(a,n,r,i,e[s+15],10,-30611744),i=this.md5_ii(i,a,n,r,e[s+6],15,-1560198380),r=this.md5_ii(r,i,a,n,e[s+13],21,1309151649),n=this.md5_ii(n,r,i,a,e[s+4],6,-145523070),a=this.md5_ii(a,n,r,i,e[s+11],10,-1120210379),i=this.md5_ii(i,a,n,r,e[s+2],15,718787259),r=this.md5_ii(r,i,a,n,e[s+9],21,-343485551),n=this.safe_add(n,o),r=this.safe_add(r,l),i=this.safe_add(i,h),a=this.safe_add(a,u)}return Array(n,r,i,a)}md5_cmn(e,t,n,r,i,a){return this.safe_add(this.bit_rol(this.safe_add(this.safe_add(t,e),this.safe_add(r,a)),i),n)}md5_ff(e,t,n,r,i,a,s){return this.md5_cmn(t&n|~t&r,e,t,i,a,s)}md5_gg(e,t,n,r,i,a,s){return this.md5_cmn(t&r|n&~r,e,t,i,a,s)}md5_hh(e,t,n,r,i,a,s){return this.md5_cmn(t^n^r,e,t,i,a,s)}md5_ii(e,t,n,r,i,a,s){return this.md5_cmn(n^(t|~r),e,t,i,a,s)}safe_add(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}bit_rol(e,t){return e<<t|e>>>32-t}str2binl(e){for(var t=Array(),n=(1<<this.chrsz)-1,r=0;r<e.length*this.chrsz;r+=this.chrsz)t[r>>5]|=(e.charCodeAt(r/this.chrsz)&n)<<r%32;return t}binl2hex(e){for(var t=this.hexcase?"0123456789ABCDEF":"0123456789abcdef",n="",r=0;r<4*e.length;r++)n+=t.charAt(e[r>>2]>>r%4*8+4&15)+t.charAt(e[r>>2]>>r%4*8&15);return n}$rw_hash(e){return this.hex_md5(e)}}class R{constructor(e,t,n,r){let i=e.getRootNode();this.body=e.ownerDocument.body,i.mode&&"open"==i.mode&&(this.body=i),this.startCaret=new s(e,t,!0),this.endCaret=new s(n,r,!1),this.startRef=this.rw_getRefPt(e,t),this.endRef=this.rw_getRefPt(n,r)}getPositionInDom(e){var t=new M,n=new h,r="",i=0,a="";if(null!=e&&null!=e.ownerDocument){var s=!1,o=!1,l=e.ownerDocument.body;let h=e;for(;null!=h.parentNode;)h=h.parentNode;for(h.mode&&"open"==h.mode&&(l=h);null!=e&&e!=l;){t.isSpecialCase(e)&&(r=""),s=3==e.nodeType||1==e.nodeType&&e.tagName.toLowerCase()==c&&null!=n.rw_getAttribute(e,"rwstate");for(var u=e.previousSibling;null!=u;)o=3==u.nodeType||1==u.nodeType&&u.tagName.toLowerCase()==c&&null!=n.rw_getAttribute(u,"rwstate"),s&&o||++i,u=u.previousSibling,s=o;if(r=r+i+"~",i=0,null!=(e=e.parentNode)&&null!=e.getAttribute&&null!=e.tagName){var d=n.rw_getAttribute(e,"chunk");if("span"==e.tagName.toLowerCase()&&"1"==d)a="#^th*"+n.getPositionInDom(e)+"#^th*"}}}return a+r}rw_getRefPt(e,t){var n=new M,r=new h;try{if(null==e)return null;if(1==e.nodeType||3==e.nodeType){var i,a,s=n.checkForSpecialParent(e);if(null!=s)return new E(this.getPositionInDom(s),t);1==e.nodeType?(i=0,a=e):(i=this.getNodeOffset_(e),a=e.parentNode);for(var o=r.rw_getAttribute(a,"rwstate"),l=r.rw_getAttribute(a,"rwTHgen");null!=o&&o.length>0||null!=l;)i+=this.getNodeOffset_(a),a=a.parentNode,o=r.rw_getAttribute(a,"rwstate"),l=r.rw_getAttribute(a,"rwTHgen");return-1==t&&(i=-1),new E(this.getPositionInDom(a),i+t)}return null}catch(e){return null}}getNodeOffset_(e){var t=new M;if(null==e)return 0;var n=0,r=e.previousSibling;return null!=r&&(n=t.rw_getNodeOffsetImpl(r)),n}refresh(){if(0==this.startCaret.check()||0==this.endCaret.check()){var e=new I(this.body,this.startRef.path,this.startRef.offset,this.endRef.path,this.endRef.offset);this.startCaret=e.leftCaret,this.endCaret=e.rightCaret,null==this.startCaret&&null==this.endCaret?(this.startCaret=new s(document.body,0,!0),this.endCaret=new s(document.body,0,!1)):null!=this.startCaret&&null!=this.endCaret||(null==this.startCaret?this.startCaret=new s(this.endCaret.node,this.endCaret.offset,!0):this.endCaret=new s(this.startCaret.node,this.startCaret.offset,!1))}}toString(){new M;if("INPUT"==this.startCaret.node.nodeName||"TEXTAREA"==this.startCaret.node.nodeName)return this.startCaret.node.value.substring(this.startCaret.node.selectionStart,this.startCaret.node.selectionEnd);this.refresh();let e=new I;return e.setCaretRange(this.startCaret,this.endCaret),e.getTextSpokenOverCaretRange(e)}getRangeObject(e){return void 0!==e&&null!=e||(e=document.body),e.ownerDocument.createRange()}getStartAsRange(){var e=this.getRangeObject(this.body);return e.setStart(this.startCaret.node,this.startCaret.offset),e.setEnd(this.startCaret.node,this.startCaret.offset),e}getEndAsRange(){var e=this.getRangeObject(this.body);return e.setStart(this.endCaret.node,this.endCaret.offset),e.setEnd(this.endCaret.node,this.endCaret.offset),e}equals(e){return this.startRef.path==e.startRef.path&&this.startRef.offset==e.startRef.offset&&this.endRef.path==e.endRef.path&&this.endRef.offset==e.endRef.offset}compareRange(e){if(this.equals(e))return 0;this.refresh(),e.refresh();var t=this.getStartAsRange(),n=this.getEndAsRange(),r=e.getStartAsRange(),i=e.getEndAsRange();try{var a=t.compareBoundaryPoints("START_TO_START",r),s=t.compareBoundaryPoints("START_TO_START",i),o=n.compareBoundaryPoints("START_TO_START",r),l=n.compareBoundaryPoints("START_TO_START",i)}catch(e){return 1}return s>-1?1:o<1?2:-1==a?-1==l?6:3:0==a?-1==l?7:0==l?0:3:-1==l?4:0==l?8:5}rw_getTextFromRange(){return this.text?this.text:this.toString()}rw_getTHCaretRangeFromTHDomRange(){var e=new M;if(null==this.startRef||null==this.endRef)return null;var t=e.getCaretFromDomPosition(this.body,this.startRef.path,this.startRef.offset,!0),n=e.getCaretFromDomPosition(this.body,this.endRef.path,this.endRef.offset,!1);if(null!=t&&null!=n){var r=new I;return r.setCaretRange(t,n),r}return null}getAsRange(){var e=null;e=this.getRangeObject(this.body);var t=new I(this.body,this.startRef.path,this.startRef.offset,this.endRef.path,this.endRef.offset),n=t.leftCaret,r=t.rightCaret;return null!=n&&null!=r?(e.setStart(n.node,n.offset),e.setEnd(r.node,r.offset)):e=null,e}}class M{constructor(){o(this,"hasAriaRoleMathWithLabel",(function(e){if(!u.ariaLabelOnMathRoleEnabled&&!u.ariaLabelOnMathJaxClassEnabled)return!1;if(null!=e&&3==e.nodeType&&(e=e.parentNode),null==e)return!0;for(var t=new h,n=t.ARIA_ROLE_ATTR,r=t.ARIA_LABEL_ATTR,i=e.ownerDocument.body,a=e;null!=a&&1==a.nodeType;){var s=t.rw_getAttribute(a,n),o=t.rw_getAttribute(a,r),l=!1;if(u.ariaLabelOnMathJaxClassEnabled&&null!=t.rw_getAttribute(a,"class")&&-1!==t.rw_getAttribute(a,"class").indexOf("mjx-chtml")&&(l=!0),(null!=s&&"math"==s&&u.ariaLabelOnMathRoleEnabled||l)&&null!=o)return!0;if(a==i)break;a=a.parentNode}return!1})),o(this,"getAriaRoleMathWithLabel",(function(e){if(!u.ariaLabelOnMathRoleEnabled&&!u.ariaLabelOnMathJaxClassEnabled)return null;if(null!=e&&3==e.nodeType&&(e=e.parentNode),null==e)return null;for(var t=new h,n=t.ARIA_ROLE_ATTR,r=t.ARIA_LABEL_ATTR,i=e.ownerDocument.body,a=e;null!=a&&1==a.nodeType;){var s=t.rw_getAttribute(a,n),o=t.rw_getAttribute(a,r),l=!1;if(u.ariaLabelOnMathJaxClassEnabled&&null!=t.rw_getAttribute(a,"class")&&-1!==t.rw_getAttribute(a,"class").indexOf("mjx-chtml")&&(l=!0),(null!=s&&"math"==s&&u.ariaLabelOnMathRoleEnabled||l)&&null!=o)return o;if(a==i)break;a=a.parentNode}return null})),o(this,"checkRangeForMathElement",(function(e){var t,n,r=e;return null!=r.startCaret.node&&(t=this.getParentMathElementFromNode(r.startCaret.node)),null!=r.endCaret.node&&(n=this.getParentMathElementFromNode(r.endCaret.node)),null!=t?r=new R(t,0,t,0):null!=n&&(r=new R(n,0,n,0)),r})),o(this,"getParentMathElementFromNode",(function(e){if(null!=e&&3==e.nodeType&&(e=e.parentNode),null==e)return null;for(var t,n=e.ownerDocument.body,r=e;null!=r&&1==r.nodeType;){if(!r.isMathJax)return t;if(r==n)break;t=r,r=r.parentNode}return null})),o(this,"isAriaHidden",(function(e){if(u.overrideAriaHidden)return!1;if(null!=e&&3==e.nodeType&&(e=e.parentNode),null==e)return!0;for(var t=new h,n=t.ARIA_HIDDEN_ATTR,r=e.ownerDocument.body,i=e;null!=i&&1==i.nodeType;){if("true"==t.rw_getAttribute(i,n))return!0;if(i==r)break;i=i.parentNode}return!1})),o(this,"isElementContainedByElement",(function(e,t){if(null==t||1!=t.nodeType||null==e||1!=e.nodeType&&3!=e.nodeType)return!1;if(e==t)return!0;for(var n=e,r=n.ownerDocument.body;null!=n&&n!=r;)if((n=n.parentNode)==t)return!0;return!1})),o(this,"getTargetElement",(function(e){return u.g_bIE?e.srcElement:(u.g_bSafari,e.target)})),o(this,"getClickPoint",(function(e){var t,n=null;if(u.g_bIE){if(1==(t=e.srcElement).nodeType&&"textarea"==t.tagName.toLowerCase());else if(null!=(n=this.rw_getTargetNodeAsCaretIE(e,!0))){if(null==n.node||null==n.node.parentNode||n.node.parentNode!=t)return n=null,null;3==n.node.nodeType&&(n.node=this.mergeTextNodes(n.node))}}else if(null!=(t=e.target))if(null!=t.firstChild&&3==t.firstChild.nodeType&&"textarea"!=t.tagName.toLowerCase()){t.firstChild.nodeValue.trimTH().length>0&&(t=t.firstChild)}else{if("thstickynote"==t.tagName.toLowerCase())return;if("textarea"!=t.tagName.toLowerCase()){var r=t.firstChild,i=this.getNextTextNodeNoImg(r,!1,t,!1);if(null!=i&&3==i.nodeType)i.nodeValue.trimTH().length>0&&(t=i)}}return null==n&&null!=t&&(n=new s(t,0,!0)),n})),o(this,"getListOfNodes",(function(e,t){let n=new _;var r=new Array;try{var i=e.node,a=t.node;if(i==a)r.push(i);else{r.push(i);for(var s=n.getNextTextNode(i,!1,a,!0);null!=s;)r.push(s),s=n.getNextTextNodeNoImg(s,!1,a,!0)}}catch(e){thLog("getListOfNodes error:"+e.message)}return r})),o(this,"getDropdownSelectedItem",(function(e){for(var t=0;t<e.childNodes.length;t++)if(e.childNodes[t].selected)return e.childNodes[t].textContent;return null}))}checkForSpecialParent(e){if(null!=e)for(var t=this.getBody(e),n=e;null!=n&&n!=t;){if(this.isSpecialCase(n))return n;n=n.parentNode}return null}getBody(e){if(e.document)return e.document.body;{let t=e.ownerDocument.body,n=e.getRootNode();return n.mode&&"open"==n.mode&&(t=n),t}}isSpecialCase(e){if(null==e)return!1;var t=new h;if(1==e.nodeType){var n=e.tagName.toLowerCase();if(n==c||"span"==n||"thspan"==n){if(null!=(r=t.rw_getAttribute(e,"pron")))return!0;if(null!=(r=t.rw_getAttribute(e,"chunk")))return!0;if(null!=(r=e.isMathJax)&&r)return!0}else if("acronym"==n||"abbr"==n){if(null!=(r=e.getAttribute("title")))return!0}else{if("chunk"==n)return!0;var r;if("img"==n){if(null==(r=t.rw_getAttribute(e,"msg"))&&(r=t.rw_getAttribute(e,"alt")),null!=r)return!0}else if("math"==n)return!0}}return!1}isSpecialCaseHighlightable(e){var t=new h;if(1==e.nodeType){var n=e.tagName.toLowerCase();if("span"==n||"thspan"==n){if(null!=(r=t.rw_getAttribute(e,"pron")))return!0;if(null!=(r=t.rw_getAttribute(e,"chunk"))&&"1"==r)return!0;if(null!=(r=e.isMathJax)&&r)if((new g).getMathMLText(e).length>0)return!0}else if("acronym"==n||"abbr"==n){var r;if(null!=(r=e.getAttribute("title")))return!0}else if("math"==n)return!1}return!1}checkIfElementInsideElement(e,t){if(null==e||null==t)return!1;for(var n=e.parentNode;null!=n;){if(n==t)return!0;n=n.parentNode}return!1}isSpecialCaseWithIgnoredContent(e){var t=new h;if(null==e)return!1;if(1==e.nodeType){var n=e.tagName.toLowerCase();if("span"==n){if(null!=(r=e.isMathJax)&&r)return!0}else{if("textarea"==n)return!0;var r;if("img"==n){if(null==(r=t.rw_getAttribute(e,"msg"))&&(r=t.rw_getAttribute(e,"alt")),null!=r)return!0}else if("math"==n)return!0}}return!1}rw_isWordSpeakable(e,t){if(null==e||0==e.length)return!1;var n=(new l).trim(e);if(1==n.length){var r=n.charCodeAt(0);if(96==r||180==r||8216==r||8217==r||8220==r||8221==r)return!1}var i,a=n.length,s=0;for(s=0;s<a;s++){if((i=n.charCodeAt(s))>63&&i<91||i>96&&i<123||i>127&&160!=i)return!0;if(i>46&&i<58)return!0;if(i>35&&i<39||43==i||61==i)return!0;if(42==i||45==i||92==i||i>93&&i<97)return!0}return!(!u.bMathsSymbols||void 0===t||"function"!=typeof t.mathsSymbolCheck||!t.mathsSymbolCheck(n))}createWrapperElement(){return this.createObject(m,null,null,p)}createObject(e,t,n,r){return this.createObjectForDoc(e,t,n,r,document)}createObjectForDoc(e,t,n,r,i){var a=i.createElement(e);if(null!=n&&(a.id=n),null!=r&&(a.className=r),null!=t)for(var s=t.length,o=0;o<s;o+=2)a.setAttribute(t[o],t[o+1]);return a}isStyleNode(e){var t=new h;if(null==e)return!1;if(1!=e.nodeType)return 3==e.nodeType||8==e.nodeType;var n=e.tagName.toLowerCase().trimTH();if(n==c){var r=t.rw_getAttribute(e,"started");if(null!=r&&"1"==r)return!1}return this.isInStyleList(n)}isInvalidNode(e){if(null==e)return!0;if(1!=e.nodeType)return 3!=e.nodeType||this.isInvalidNode(e.parentNode);if(u.ignoreHidden){var t=this.getComputedStyle(e);if(null!=t&&("hidden"==t.visibility||"none"==t.display))return!0}var n=e.tagName.toLowerCase();return"link"==n||"area"==n||"script"==n||"noscript"==n||"annotation"==n||"style"==n||"!--"==n||"title"==n||"html:script"==n}getComputedStyle(e){return null==e||3==e.nodeType&&null==(e=e.parentNode)?null:window.getComputedStyle(e,null)}isIgnored(e){var t=new h;if(u.bOverrideIgnore)return!1;if(null!=e&&3==e.nodeType&&(e=e.parentNode),null==e)return!0;for(var n=t.IGNORE_ATTR,r=t.ALLOW_ATTR,i=e.ownerDocument.body,a=e;null!=a&&1==a.nodeType;){if(null!=t.rw_getAttribute(a,n))return!0;if(null!=t.rw_getAttribute(a,r))return!1;if("button"==a.tagName.toLowerCase())return!1;if(a==i)break;a=a.parentNode}return!1}allTextFromNodeTH(e){var t="";if(3==e.nodeType)t=e.nodeValue;else if(1==e.nodeType)for(var n=e.firstChild;null!=n;)3==n.nodeType?t+=n.nodeValue:1==n.nodeType&&(t+=this.allTextFromNodeTH(n)),n=n.nextSibling;return t}mergeTextNodes(e){if(null==e)return e;var t=e.parentNode;if(null!=t&&3==e.nodeType){for(var n=e.ownerDocument;null!=e.previousSibling&&3==e.previousSibling.nodeType;){var r=e.previousSibling.nodeValue+e.nodeValue,i=n.createTextNode(r);t.removeChild(e.previousSibling),t.replaceChild(i,e),e=i}for(;null!=e.nextSibling&&3==e.nextSibling.nodeType;){r=e.nodeValue+e.nextSibling.nodeValue,i=n.createTextNode(r);t.removeChild(e.nextSibling),t.replaceChild(i,e),e=i}}return e}rw_reduceSelectionForNonSpeechChar(e){var t=new _,n=!1,r=e.rightCaret.node,i=e.rightCaret.offset,a=e.leftCaret.node,o=e.leftCaret.offset;try{var l,h;if(!e.rightCaret.isSpecialCase())for(var u=r.nodeValue;;){if(0==i){if(null==(l=t.getPreviousTextNode(r,!1,a)))break;if(1==l.nodeType){r=l,i=0,n=!0;break}i=(u=(r=l).nodeValue).length,n=!0}if(r==a&&i==o)break;if(!(i>0))break;if(h=u.charAt(i-1),!this.rw_isWhiteSpace(h))break;--i,n=!0}if(!e.leftCaret.isSpecialCase())for(var d=a.nodeValue,g=d.length;;){if(o==g){if(null==(l=t.getNextTextNode(a,!1,r)))break;if(1==l.nodeType){a=l,o=0,g=0,n=!0;break}d=(a=l).nodeValue,o=0,g=d.length,n=!0}if(r==a&&i==o)break;if(!(o<g))break;if(h=d.charAt(o),!this.rw_isWhiteSpace(h))break;++o,n=!0}}catch(e){}return n?new I(new s(a,o,!0),new s(r,i,!1)):e}rw_isWhiteSpace(e){return e.search(/[\s\xa0]/)>-1}getSentenceFromPointByLang(e){var t=new A,n=t.getSentenceBreakToRight(e),r=t.getSentenceBreakToLeft(n),i=new I;return i.setCaretRange(r,n),i}isSpecialCaseNested(e){if(null!=e)for(var t=this.getBody(e),n=e;null!=n&&n!=t;){if(this.isSpecialCase(n))return!0;n=n.parentNode}return!1}rw_isTextChar(e){return e>47&&e<58||e>63&&e<91||e>94&&e<123}rw_isFullStop(e,t,n){var r=new _,i=!0;if(e.length>t+1){var a=e.charCodeAt(t+1);this.rw_isTextChar(a)&&(i=!1),u.bMathsSymbols&&61==a&&mathsSymbolCheck("!=")&&null!=n&&"!"==n.nodeValue.charAt(t)&&(i=!1)}if(i&&null!=n&&"."!=n.nodeValue.charAt(t))return!0;if(i)if(t>1){var s=e.substring(t-2,t);if((" "==s.charAt(0)||"\n"==s.charAt(0)||"\r"==s.charAt(0)||"\t"==s.charAt(0))&&s.charCodeAt(1)>63&&s.charCodeAt(1)<91)i=!1;else if("."==s.charAt(0)&&this.rw_isTextChar(s.charCodeAt(1)))i=!1;else if("Dr"==s||"Mr"==s||"Ms"==s||"Av"==s||"St"==s||"eg"==s)i=!1;else if(t>2){var o=e.substring(t-3,t);if("Mrs"==o||"etc"==o||"i.e"==o||"P.O"==o||"PhD"==o)i=!1;else if(t>3){"Ph.D"==e.substring(t-4,t)&&(i=!1)}}}else try{if(null!=n&&0==t){var l=r.getPreviousTextNode(n,!0,null);if(null!=l&&3==l.nodeType&&l!=n)return!!this.rw_isFullStop(l.nodeValue+e,l.nodeValue.length,null)}}catch(e){}return i}rw_caretRangeIsSpeakable(e,t){var n=new _;try{if(null==e||null==e.leftCaret||null==e.rightCaret)return!1;if(this.rw_checkForHiddenParent(e.leftCaret.node))return!1;for(var r=e.leftCaret,i=e.rightCaret,a=r.node,s=i.node,o=!0,l=!1,h=a;null!=h;){if((l=this.isSpecialCase(h))||3==h.nodeType){var u=n.getTextFromNode(h);if(null!=u&&""!=u&&(l||(h==s&&i.offset>-1&&(u=u.substring(0,i.offset)),h==a&&r.offset>0&&(u=u.substring(r.offset))),this.rw_isWordSpeakable(u,t)))return!0}h=l?n.getNextNodeIgnoreChildren(h,!1,s):o?n.getNextNodeAllowMoveToChild(h,!0,s):n.getNextNode(h,!1,s),o=!1}}catch(e){}return!1}rw_checkForHiddenParent(e){try{var t=this.getComputedStyle(e);if(null!=t&&("none"==t.display||"hidden"==t.visibility))return!0;for(var n=e,r=n.ownerDocument.body;n!=r;)if(n=n.parentNode,"none"==this.getComputedStyle(n).display)return!0}catch(e){}return!1}rw_getRefPt(e,t){var n=new h;try{if(null==e)return null;if(1==e.nodeType||3==e.nodeType){var r,i,a=this.checkForSpecialParent(e);if(null!=a)return new E(this.getPositionInDom(a),t);1==e.nodeType?(r=0,i=e):(r=this.rw_getNodeOffset(e),i=e.parentNode);for(var s=n.rw_getAttribute(i,"rwstate"),o=n.rw_getAttribute(i,"rwTHgen");null!=s&&s.length>0||null!=o;)r+=this.rw_getNodeOffset(i),i=i.parentNode,s=n.rw_getAttribute(i,"rwstate"),o=n.rw_getAttribute(i,"rwTHgen");return-1==t&&(r=-1),new E(this.getPositionInDom(i),r+t)}return null}catch(e){return null}}rw_getNodeOffset(e){if(null==e)return 0;var t=0,n=e.previousSibling;return null!=n&&(t=this.rw_getNodeOffsetImpl(n)),t}getPositionInDom(e){var t=new h,n="",r=0,i="";if(null!=e&&null!=e.ownerDocument){var a=!1,s=!1,o=e.ownerDocument.body;let h=e.getRootNode();for(h.mode&&"open"==h.mode&&(o=h);null!=e&&e!=o;){this.isSpecialCase(e)&&(n=""),a=3==e.nodeType||1==e.nodeType&&e.tagName.toLowerCase()==c&&null!=t.rw_getAttribute(e,"rwstate");for(var l=e.previousSibling;null!=l;)s=3==l.nodeType||1==l.nodeType&&l.tagName.toLowerCase()==c&&null!=t.rw_getAttribute(l,"rwstate"),a&&s||++r,l=l.previousSibling,a=s;if(n=n+r+"~",r=0,null!=(e=e.parentNode)&&null!=e.getAttribute&&null!=e.tagName){var u=t.rw_getAttribute(e,"chunk");if("span"==e.tagName.toLowerCase()&&"1"==u)i="#^th*"+this.getPositionInDom(e)+"#^th*"}}}return i+n}rw_getBreakInCurrentWord(e){if(null==e||0==e.length)return-1;let t=new Array;t.push(this.extractProbablePhoneNumbers(e)),t.push(this.extractProbablePostcode(e)),t.push(this.containsTempSymbol(e)),t=t.filter(e=>null!=e);let n=e.search("["+String.fromCharCode(8212)+'\\s"]');if(null!=t&&t.length>0){let r=this.checkForFirstInstance(e,t);n>r.index&&n<r.length&&(n=r.length)}return n}rw_isLetter(e){return e>64&&e<91||e>96&&e<123}rw_getNodeOffsetImpl(e){for(var t=0,n=e;null!=n;)3!=n.nodeType||this.isIgnored(n)||this.isAriaHidden(n)?1==n.nodeType&&(this.isInvalidNode(n)||(this.isSpecialCase(n)?t+=1:"textarea"!=n.tagName.toLowerCase()?t+=this.rw_getNodeOffsetImpl(n.lastChild):t+=1)):t+=n.nodeValue.length,n=n.previousSibling;return t}rw_getCaretFromRefPt(e,t){return this.getCaretFromDomPosition(e,t.path,t.offset,!0)}getCaretFromDomPosition(e,t,n,r,i){var a=new _;void 0===i&&(i=!1);try{if(null==e)return null;var o=a.getNodeFromPosition(e,t);if(i){var l=new s(o,0,r);return l.setSpecialCase(!0),l}var h=this.checkForSpecialParent(o);if(null!=h){if(o=h,this.isSpecialCaseHighlightable(h)){if(r){var u=a.getFirstChildTextNode(o,!1);return new s(null!=u?u:o,0,r)}return null!=(c=a.getLastChildTextNode(o,!1))?3==c.nodeType?new s(c,c.length,r):new s(c,0,r):new s(o,0,r)}return new s(h,0,r)}var d=0;if(r||++d,n>-1){if(null==o)return null;for(var g=!1,c=o.parentNode,m=o;!g;){if(3==o.nodeType){if(n<d+o.nodeValue.length){g=!0;break}m=o,d+=o.nodeValue.length,o=a.getNextNode(o,!1,c)}else if(1==o.nodeType)if(null!=(h=this.checkForSpecialParent(o))){if(o=h,!(n-d>0)){g=!0;break}d+=1,o=a.getNextNodeIgnoreChildren(o,!1,c)}else o=a.getNextNode(o,!1,c);if(null==o||o==c){if(null!=m){d=3==(o=m).nodeType?n-o.nodeValue.length:0,r||++d;break}return null}}return new s(o,r?n-d:n-(d-1),r)}return new s(o,n,r)}catch(e){return null}}getNodesOverRange(e,t){var n=new _,r=[];if(null==e||null==t)return r;for(var i=e;i;)this.isInvalidNode(i)?i=n.getActualNextNodeIgnoreChildren(i,t):(this.isIgnored(i)||this.isAriaHidden(i)||r.push(i),i=n.getActualNextNode(i,t));return r}getWindow(e){try{if(null==e)return window;if(0===top.frames.length)return window;var t=e.ownerDocument.body;if(t===window.document.body)return window;if(!u.ignoreFrames){var n,r=top.frames.length;for(n=0;n<r;n++)try{var i=top.frames[n].document.body;if(i===t)return top.frames[n];if(i.getElementsByTagName("iframe").length>0)for(var a=0;a<i.getElementsByTagName("iframe").length;a++)try{if(i.getElementsByTagName("iframe")[a].contentDocument.body===t)return i.getElementsByTagName("iframe")[a]}catch(e){}}catch(e){}}}catch(e){}return window}rw_getTextRangeAsTHRange(e,t){var n=t.duplicate();n.collapse(!0);var r=rw_getTextRangeAsRefPtIE(e,n);(n=t.duplicate()).collapse(!1);var i=rw_getTextRangeAsRefPtIE(e,n);return new N(e,r,i)}rw_getAsTextRange(e,t,n,r,i){var a=this.getRangeObject(e),s=new I(e,t,-1,r,-1),o=s.leftCaret,l=s.rightCaret;if(null!=o&&null!=o.node&&null!=l&&null!=l.node){var h=o.node;if(3==h.nodeType){var u=this.rw_getNodeOffset(h);h=h.parentNode,n+=u}var d=l.node;if(3==d.nodeType){u=this.rw_getNodeOffset(d);d=d.parentNode,i+=u}a.moveToElementText(h),a.collapse(),rw_moveEnd(a,n),a.collapse(!1),a.select();var g=this.getRangeObject(e);g.moveToElementText(d),g.collapse(),rw_moveEnd(g,i),g.collapse(!1),a.setEndPoint("EndToEnd",g)}else a=null;return a}rw_collapseSelection(){var e=this.getSelectionObject();null!=e&&(e.collapseToStart?e.collapseToStart():e.execCommand&&e.execCommand("UnSelect",!1,null))}getSelectionObject(){var e=null;if(window.getSelection){var t=window.getSelection(),n=null;if(t.isCollapsed?(t=this.getFrameSelectionSFF(window)).foundSel&&(n=t.foundSel):n=t,null==n)return null;e=n}else if(document.selection){var r=document.selection.createRange();if(r.text.length>0)theWindow=window,e=r;else{var i=this.getFrameSelectionOldIE(window);i.theRange&&(e=i.theRange)}}return e}getFrameSelectionOldIE(e){var t,n={};if(!u.ignoreFrames&&e.frames&&e.length>0){var r,i=e.length;for(r=0;r<i;r++)try{var a=e[r];if(null!=(t=a.document.selection.createRange())&&null!=t.text&&t.text.length>0){n.theWindow=a,n.theRange=t;break}if(a.length>0){var s=this.getFrameSelectionOldIE(a);if(s.theRange){n=s;break}}}catch(e){}}return n}getFrameSelectionSFF(e){var t={},n=this.getFrameSelection(e);return null!=n&&(t.theWindow=n,t.foundSel=n.getSelection()),t}getFrameSelection(e){if(!u.ignoreFrames&&e.frames&&e.length>0){var t,n=e.length;for(t=0;t<n;t++)try{var r=e[t].getSelection();if(null!=r&&!r.isCollapsed)return e[t];if(e[t].document.getElementsByTagName("textarea").length>0)for(var i=e[t].document.getElementsByTagName("textarea"),a=0;a<i.length;a++)if(i[a].selectionStart!=i[a].selectionEnd)return e[t];if(e[t].length>0){var s=this.getFrameSelection(e[t]);if(s)return s}}catch(e){}}return null}getFrameSelectionInTextAreas(e){return this.getFrameSelectionInTextarea(e)}getFrameSelectionInTextarea(e){if(!u.ignoreFrames&&e.frames&&e.length>0){var t,n=e.length;for(t=0;t<n;t++)try{if(e[t].document.getElementsByTagName("textarea").length>0)for(var r=e[t].document.getElementsByTagName("textarea"),i=0;i<r.length;i++)if(r[i].selectionStart!=r[i].selectionEnd)return{frame:e[t],textArea:r[i]}}catch(e){}}return null}isLineBreakNode(e){if(1!=e.nodeType)return!1;var t=e.tagName.toLowerCase().trimTH();return this.isInBreakList(t)}isInBreakList(e){return f.includes(e)}isInStyleList(e){return S.includes(e)}isAriaHidden(e){let t=new h;if(u.overrideAriaHidden)return!1;var n=k.isIgnorePageDefault();if(null!=e&&3==e.nodeType&&(e=e.parentNode),null==e)return!0;for(var r=e.ownerDocument.body,i=e;null!=i&&1==i.nodeType;){if("true"==t.rw_getAttribute(i,"aria-hidden"))return!0;if(i==r)break;i=i.parentNode}return n}rw_getUniqueIdForTextNode(e,t){if(null!=e&&3==e.nodeType){var n=e.ownerDocument.body,r=e.nodeValue;if(null!=r){r=r.replace(/\s+/g,"");for(var i=e.parentNode;null!=i&&null!=i.parentNode;){if(null!=(i=i.parentNode).id&&i.id.length>0&&"rwTH"!=i.id.substr(0,4)){r=i.id+r;break}if(i==n)break}null!=t&&(r=t+r);var a="rwTH"+(new P).hex_md5(r);if(null!=this.rw_getElementQuerySelector("[data-ss-id="+a+"]")){for(var s=1;null!=this.rw_getElementQuerySelector("[data-ss-id="+a+s+"]");)++s;a+=s}return a}}return null}rw_getElementById(e){var t=document.getElementById(e);if(null==t){if(!u.ignoreFrames){var n,r=top.frames.length;for(n=0;n<r;n++)try{var i=top.frames[n].document.getElementById(e);if(null!=i)return i}catch(e){}}return null}return t}rw_getElementQuerySelector(e){var t=document.querySelector(e);if(null==t){if(!u.ignoreFrames){var n,r=top.frames.length;for(n=0;n<r;n++)try{var i=top.frames[n].document.querySelector(e);if(null!=i)return i}catch(e){}}return null}return t}rw_getSelection(){var e=null,t=null;if(u.g_bIEOld){if(null==(o=document.selection.createRange())||null==o.text||0==o.text.length)(s=this.getFrameSelectionOldIE(window)).theRange&&(e=s.theWindow,t=s.theRange);else e=window,t=o;if(null!=t){var n=t.duplicate();n.collapse();var r=n.parentElement();(this.isIgnored(r)||this.isAriaHidden(r))&&(t=null)}null!=t&&null!=t.parentElement()&&"input"==t.parentElement().tagName.toLowerCase()&&(t=new String(t.text))}else{null!=u.g_ipadSelectionRange&&u.g_ipadSelectionWindow.getSelection().addRange(u.g_ipadSelectionRange);var i=window.getSelection(),a=null;if(!i.isCollapsed&&i.toString().trimTH().length>0)e=window,a=i;else{if(u.g_lastInputSelectSFF&&u.g_lastInputSelectSFF.selectionStart!=u.g_lastInputSelectSFF.selectionEnd)return{frame:window,range:new String(u.g_lastInputSelectSFF.value.substring(u.g_lastInputSelectSFF.selectionStart,u.g_lastInputSelectSFF.selectionEnd))};var s;(s=this.getFrameSelectionSFF(window)).foundSel&&(e=s.theWindow,a=s.foundSel)}if(null==a)return null;if(a.anchorNode&&(this.isIgnored(a.anchorNode)||this.isAriaHidden(a.anchorNode)&&!a.anchorNode.parentNode.isMathJax))return null;if(a.focusNode&&a.focusNode.id&&"flashcontent"==a.focusNode.id)return null;if(null!=a.anchorNode&&a.anchorNode==a.focusNode&&a.anchorOffset==a.focusOffset)return null;var o,l=null;if(a.getRangeAt)l=a.getRangeAt(0);else null!=(o=this.getRangeObject())&&(a.anchorNode==a.focusNode&&a.anchorOffset==a.focusOffset?o=this.getRangeFromSelectionPoint(a):(o.setStart(a.anchorNode,a.anchorOffset),o.setEnd(a.focusNode,a.focusOffset),0==o.toString().length&&(o.setStart(a.focusNode,a.focusOffset),o.setEnd(a.anchorNode,a.anchorOffset))),l=o);if(null==l)return null;var h=l.startContainer,d=l.startOffset,g=l.endContainer,c=l.endOffset;if(3!=h.nodeType){if(1!=h.nodeType)return null;if(d>0&&h.hasChildNodes()&&h.childNodes.length>d)if(3==(h=h.childNodes[d]).nodeType)d=0;else if(d=0,"[object HTMLEmbedElement]"==h.toString())return null}if(3!=g.nodeType){if(1!=g.nodeType)return null;if(g.hasChildNodes()&&(g.childNodes.length>c?g=g.childNodes[c]:3!=(g=g.childNodes[c-1]).nodeType&&null!=(m=this.getLastChildTextNode(g,!0))&&(g=m)),3!=g.nodeType){var m,p=this.getPreviousNode(h,!0,null);null!=(m=this.getPreviousTextNode(g,!1,p))&&(g=m)}c=3==g.nodeType?g.nodeValue.length:0}t=new R(h,d,g,c)}return null!=e&&null!=t?{frame:e,range:t}:null}rw_replaceAll(e,t,n){if("string"==typeof e)for(var r=e.indexOf(t);r>-1;)r=(e=e.substring(0,r)+n+e.substring(r+t.length)).indexOf(t,r+n.length);return e}rw_checkIfCanHaveStickys(e){let t=new h;if(null!=(i=e.previousSibling)&&1==i.nodeType&&("img"==i.tagName.toLowerCase()||"thstickynote"==i.tagName.toLowerCase())&&null!=t.rw_getAttribute(i,"texthelpnoteid"))return!1;var n=e;if(3==n.nodeType&&(n=n.parentNode),null!=t.rw_getAttribute(n,"rwthgen")||null!=t.rw_getAttribute(n,"rwstate"))for(var r=!0;r;){var i;if(null!=(i=n.previousSibling)&&1==i.nodeType&&"img"==i.tagName.toLowerCase()&&null!=t.rw_getAttribute(i,"texthelpnoteid"))return!1;n=n.parentNode,r=null!=t.rw_getAttribute(n,"rwthgen")||null!=t.rw_getAttribute(n,"rwstate")}if(1==e.nodeType){if(null!=t.rw_getAttribute(e,"texthelpnoteid"))return!1;var a=e.tagName.toLowerCase();if("input"==a||"textarea"==a||"img"==a||"label"==a||"button"==a||"nobr"==a);else if("span"==a||"thspan"==a){if(null==(o=t.rw_getAttribute(e,"pron")))return!1}else{if("acronym"!=a&&"abbr"!=a)return!1;if(null==(o=e.getAttribute("title")))return!1}}if(this.isInvalidNode(e)||this.isIgnored(e)||this.isAriaHidden(e))return!1;for(var s=document.body;null!=e&&e!=s;){if(1==e.nodeType){var o;if(null!=(o=t.rw_getAttribute(e,"rwTHcomp"))&&"1"==o)return!1;if(null!=t.rw_getAttribute(e,"ignorenote"))return!1}e=e.parentNode}return!0}addEvent(e,t,n){return e.addEventListener?(u.g_bChromeExtension?e.addEventListener(t,n,!0):e.addEventListener(t,n,!1),!0):!!e.attachEvent&&e.attachEvent("on"+t,n)}createPlainSpan(){return this.createObject("span",null,null,u.g_bOverrideSpan?"thspan":null)}splitText(e,t){let n=new h;if(null==e||3!=e.nodeType||null==e.parentNode)return e;var r=0,i=e.parentNode,a=i.parentNode;if(null==a||"thspan"!=i.tagName.toLowerCase()||"thspan"!=a.tagName.toLowerCase()||null==n.rw_getAttribute(i,"rwTHgen")||null==n.rw_getAttribute(a,"rwTHgen")&&null==n.rw_getAttribute(a,"rwTHpgen")?"thspan"!=i.tagName.toLowerCase()||null==n.rw_getAttribute(i,"rwTHgen")&&null==n.rw_getAttribute(i,"rwTHpgen")||(r=1):(r=2,null==e.nextSibling&&null==e.previousSibling||(r=1)),0==e.nodeValue.length||t<=0||t>=e.nodeValue.length){if(0==r){var s=this.createWrapperElement();n.rw_setAttribute(s,"rwTHgen","1");var o=this.createWrapperElement();n.rw_setAttribute(o,"rwTHgen","1"),i.insertBefore(s,e),s.appendChild(o),o.appendChild(e)}else if(1==r){s=this.createWrapperElement();n.rw_setAttribute(s,"rwTHgen","1"),i.insertBefore(s,e),s.appendChild(e)}return e}var l=e.nodeValue,u=l.substring(0,t),d=l.substring(t),g=(o=this.createWrapperElement(),this.createWrapperElement()),c=document.createTextNode(u),m=document.createTextNode(d);if(o.appendChild(c),g.appendChild(m),n.rw_setAttribute(o,"rwTHgen","1"),n.rw_setAttribute(g,"rwTHgen","1"),2==r)a.insertBefore(g,i),a.insertBefore(o,g),a.removeChild(i);else if(1==r)i.insertBefore(o,e),i.insertBefore(g,e),i.removeChild(e);else{s=this.createWrapperElement();n.rw_setAttribute(s,"rwTHgen","1"),s.appendChild(o),s.appendChild(g),i.insertBefore(s,e),i.removeChild(e)}return m}rw_isSpan(e){return"span"==e||"thspan"==e}moveCaret(e,t,n){var r,i=e.node,a=e.offset,o=e.forwardBias,l=new _;if(3!=i.nodeType)return null;for(;i;){var h=i.nodeValue.length;if(0==h)if(t>0||0==t&&o){if(null==(r=l.getNextTextNodeNoImg(i,n,null,!0)))return 0==t?new s(i,i.nodeValue.length,o):null;i=r,a=0}else{if(null==(r=l.getPreviousTextNodeNoImg(i,n,null,!0)))return 0==t?new s(i,0,o):null;a=(i=r).nodeValue.length}else if((a+=t)<0||0==a&&!o){if(t=a,null==(r=l.getPreviousTextNodeNoImg(i,n,null,!0)))return 0==t?new s(i,0,o):null;a=(i=r).nodeValue.length}else{if(!(a>h||a==h&&o))return new s(i,a,o);if(t=a-h,null==(r=l.getNextTextNodeNoImg(i,n,null,!0)))return 0==t?new s(i,i.nodeValue.length,o):null;i=r,a=0}}return null}getPhoneNumbersFromString(e){var t=[];return this.containsDigitAndSpace(e)&&(t=this.extractProbablePhoneNumbers(e)),t}getPostcodesFromString(e){var t=[];return this.containsDigitAndSpace(e)&&(t=this.extractProbablePostcode(e)),t}extractProbablePhoneNumbers(e){var t=new RegExp("[a-zA-Z]+","g"),n=new Array;if(!t.test(e)){var r,i,a,s,o,h,u,d,g=[],c=[],m=!1,p=!1,f=e.length;let t=new l;for(a=0;a<f;a++)o=(s=e[a]).charCodeAt(0),m=t.rw_isWhiteSpace(s),a>0&&a<e.length-1&&(r=e[a-1],i=e[a+1]),!p&&this.isStartTelSymbol(o)?(c.push(a),p=!0):(p&&!this.containsTelSymbol(o)&&!m||this.isSpacePaddingTelChar(s,r,i))&&(h=this.getLastValidTelChar(e.substring(0,a)),c.push(h>-1?h:a),p=!1);for(c.push(e.length),a=1;a<c.length;a++)u=c[a-1],d=c[a],g.push(e.substring(u,d));var S;for(a=0;a<g.length;a++)S=this.cleanTelFormat(g[a].trim()),this.isTelFormat(S)&&n.push(S)}return n.length>0?n:null}getLastValidTelChar(e){var t,n=-1;for(t=e.length-1;t>-1;t--)if(!isNaN(e[t])){n=t+1;break}return n}cleanTelFormat(e){var t=e.indexOf("("),n=e.indexOf(")");return t>-1&&-1===n?e=e.substring(0,t).trim():-1===t&&n>-1?e=e.substring(n+1).trim():t>n&&(e=e.substring(n+1,t).trim()),e}isTelFormat(e){var t,n=!1;return(n=(t=e.replace(/[^0-9]/g,"").length)>=7&&t<=25&&/\d+/.test(e))&&e.lastIndexOf("+")>-1&&(n=e.lastIndexOf("+")<=1),n}isSpacePaddingTelChar(e,t,n){var r=!1;if(t&&n){r=/\s+(\-|\(|\)|\.|\+|\/)\s+/.test(t+e+n)}return r}isStartTelSymbol(e){return(new l).isNumber(e)||40===e||43===e}containsTelSymbol(e){return(new l).isNumber(e)||e>39&&e<42||43===e||e>44&&e<48}containsTempSymbol(e){return e.match(/\u00B0\s?[CF]/gi)}checkForFirstInstance(e,t){let n=new Array;t.forEach(t=>{if(null!=t&&t.length>0){let r={index:e.indexOf(t[0]),length:t[0].length};n.push(r)}});return n.reduce((e,t)=>e.index<t.index?e:t)}extractProbablePostcode(e){return e.match(/(GIR 0AA)|((([ABCDEFGHIJKLMNOPRSTUWYZ][0-9][0-9]?)|(([ABCDEFGHIJKLMNOPRSTUWYZ][ABCDEFGHKLMNOPQRSTUVWXY][0-9][0-9]?)|(([ABCDEFGHIJKLMNOPRSTUWYZ][0-9][ABCDEFGHJKSTUW])|([ABCDEFGHIJKLMNOPRSTUWYZ][ABCDEFGHKLMNOPQRSTUVWXY][0-9][ABEHMNPRVWXY])))) [0-9][ABDEFGHJLNPQRSTUWXYZ]{2})/gi)}containsDigitAndSpace(e){return!(!(new l).rw_isWhiteSpace(e)||!/\d/g.test(e))}wrapText(e,t,n,r){let i=e.parentNode;if(3!=e.nodeType&&null!=i)return null;let a,s,o,l=i.ownerDocument,u=this.createWrapperElementForDoc(l),d=e.nodeValue,g=new h;if("span"!=i.tagName.toLowerCase()&&"thspan"!=i.tagName.toLowerCase()||null==g.rw_getAttribute(i,"pron"))a=d.substring(0,t),s=d.substring(t,n),o=d.substring(n);else{if(null!=r&&"pron"==r[0])return null;a="",s=d,o=""}if(null!=r)for(var c=0;c<r.length;c+=2)g.rw_setAttribute(u,r[c],r[c+1]);let m,p=null,f=null;if(a.length>0&&(p=l.createTextNode(a)),m=l.createTextNode(s),o.length>0&&(f=l.createTextNode(o)),u.appendChild(m),i.replaceChild(u,e),null!=p){let e=this.createWrapperElementForDoc(l);e.appendChild(p),i.insertBefore(e,u)}if(null!=f){let e=this.createWrapperElementForDoc(l);e.appendChild(f),null==u.nextSibling?i.insertBefore(e,null):i.insertBefore(e,u.nextSibling)}return u}createWrapperElementForDoc(e){return this.createObjectForDoc("thspan",null,null,null,e)}createObjectForDoc(e,t,n,r,i){var a=i.createElement(e);if(null!=n&&(a.id=n),null!=r&&(a.className=r),null!=t)for(var s=t.length,o=0;o<s;o+=2)a.setAttribute(t[o],t[o+1]);return a}}class I{constructor(e,t,n,r,i){this.leftCaret=null,this.rightCaret=null,null!=e&&null!=t&&null!=n&&null!=r&&null!=i&&this.getCaretPairFromDomPosition(e,t,n,r,i)}setCaretRange(e,t){this.leftCaret=e,this.rightCaret=t}equals(e){return null!=e&&(this.leftCaret.equals(e.leftCaret)&&this.rightCaret.equals(e.rightCaret))}toString(){return this.getTextOverCaretRange()}checkIfImage(){return null!=this.leftCaret&&null!=this.rightCaret&&(!(!this.leftCaret.specialCase||1!=this.leftCaret.node.nodeType||"img"!=this.leftCaret.node.tagName.toLowerCase())||!(!this.rightCaret.specialCase||1!=this.rightCaret.node.nodeType||"img"!=this.rightCaret.node.tagName.toLowerCase()))}getTextOverCaretRange(){var e=new M,t=new h;try{if(null==this.leftCaret||null==this.rightCaret)return"";var n,r=this.leftCaret,i=this.rightCaret,a=r.node,s=i.node,o="",l=e.getNodesOverRange(a,s);if(null!=l&&l.length>0)for(var u=0;u<l.length;u++){var d=l[u];if(3==d.nodeType&&"textarea"!=d.parentNode.tagName.toLowerCase())n=d.nodeValue,s==a?o+=n.substring(r.offset,i.offset):d==a&&r.offset>0?o+=n.substr(r.offset):d==s&&i.offset>-1?o+=n.substring(0,i.offset):o+=n;else if(1==d.nodeType){if("img"==d.tagName.toLowerCase()&&t.rw_getAttribute(d,"msg")){o=t.rw_getAttribute(d,"msg");continue}if("img"==d.tagName.toLowerCase()&&t.rw_getAttribute(d,"alt")){o=t.rw_getAttribute(d,"alt");continue}if(d.isMathJax){o=(new g).getRawTextFromMathJax(a);break}}}return o.trimTH()}catch(e){return""}}rw_getTHRangeFromTHCaretRange(){return null==this||null==this.leftCaret||null==this.rightCaret?null:new THRange(this.leftCaret.node.ownerDocument.body,this.rw_getRefPt(this.leftCaret.node,this.leftCaret.offset),this.rw_getRefPt(this.rightCaret.node,this.rightCaret.offset))}getCaretPairFromDomPosition(e,t,n,r,i){var a=new M;this.leftCaret=a.getCaretFromDomPosition(e,t,n,!0),this.rightCaret=t==r&&n>=i?this.leftCaret:a.getCaretFromDomPosition(e,r,i,!1)}getTextSpokenOverCaretRange(e){let t=new _,n=new M;try{if(null==e||null==e.leftCaret||null==e.rightCaret)return"";var r=e.leftCaret,i=e.rightCaret,a=r.node,o=i.node,l=n.isSpecialCaseNested(a);l&&(a=n.checkForSpecialParent(a),r=new s(a,0,!0));for(var h=a,u="";null!=h;){if((l=n.isSpecialCase(h))||3==h.nodeType){var d=t.getTextFromNode(h);null!=d&&""!=d&&(l||(h==o&&i.offset>-1&&(d=d.substring(0,i.offset)),h==a&&r.offset>-1&&(d=d.substring(r.offset))),u+=d)}h=l?t.getNextNodeIgnoreChildren(h,!1,o):t.getNextNode(h,!1,o)}return u.trimTH()}catch(e){return""}}}class F{constructor(){}clearSelection_(){this.clearBrowserSelection()}clearBrowserSelection(){if(window.getSelection){for(let e=0;e<window.frames.length;e++)try{window.getSelection().empty?window.frames[e].getSelection().empty():window.getSelection().removeAllRanges&&window.frames[e].getSelection().removeAllRanges()}catch(e){}window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges()}else document.selection&&document.selection.empty()}getSelectionRange(){}hasSelection(){}}class L extends F{constructor(){super(),this.g_ipadSelectionRange=null,this.lastInputSelect=null;for(var e=document.getElementsByTagName("input"),t=0;t<e.length;t++){null!=(r=(n=e.item(t)).type)&&"text"==r&&n.addEventListener("mouseup",e=>{this.inputHandler(e)},!0)}for(e=document.getElementsByTagName("textarea"),t=0;t<e.length;t++){var n,r;null!=(r=(n=e.item(t)).type)&&"textarea"==r&&n.addEventListener("mouseup",e=>{this.inputHandler(e)},!0)}}inputHandler(e){this.lastInputSelect=e.currentTarget}getSelectionRange(){var e=this.getSelection_();return e?e.range:null}getElementRangeById(e){let t=this.getSelectionById(e);return t?t.range:null}getSelectionObject(){var e=this.getSelection_();return this.clearBrowserSelection(),e}isMathJax(e){if(void 0!==e.startCaret.node.ownerDocument.defaultView.MathJax){if(e.startCaret.node.isMathJax)return!0;if(e.startCaret.node.parentNode.isMathJax)return!0}return!1}hasSelection(){var e=this.getSelection_();return null!=e&&null!=e}getSelectionString(){return this.getSelection_().range.toString()}getSelectionTextById(e){return this.getSelectionById(e).range.toString()}getSelection_(){var e=new M,t=new _,n=null,r=null;null!=this.g_ipadSelectionRange&&g_ipadSelectionWindow.getSelection().addRange(this.g_ipadSelectionRange);var i=window.getSelection(),a=null,s=new l;if(!i.isCollapsed&&s.trim(i.toString()).length>0)n=window,a=i;else{if(this.lastInputSelect&&this.lastInputSelect.selectionStart!=this.lastInputSelect.selectionEnd)return r=new R(this.lastInputSelect,0,this.lastInputSelect,0),{frame:window,range:r};var o=e.getFrameSelectionSFF(window);o.foundSel&&(n=o.theWindow,a=o.foundSel);var h=e.getFrameSelectionInTextAreas(window);if(null!=h)return r=new R(h.textArea,0,h.textArea,0),{frame:h.frame,range:r}}if(i.anchorNode&&i.anchorNode.children&&i.anchorNode.children[0]&&i.anchorNode.children[0].shadowRoot)try{n=(i=i.anchorNode.children[0].shadowRoot.getSelection()).anchorNode.getRootNode(),a=i}catch(e){}if(null==a)return null;if(a.anchorNode&&(e.isIgnored(a.anchorNode)||e.isAriaHidden(a.anchorNode)&&!a.anchorNode.parentNode.isMathJax))return null;if(a.focusNode&&a.focusNode.id&&"flashcontent"==a.focusNode.id)return null;if(null!=a.anchorNode&&a.anchorNode==a.focusNode&&a.anchorOffset==a.focusOffset)return null;var u=null;if(a.getRangeAt)u=a.getRangeAt(0);else{var d=e.getRangeObject();null!=d&&(a.anchorNode==a.focusNode&&a.anchorOffset==a.focusOffset?d=e.getRangeFromSelectionPoint(a):(d.setStart(a.anchorNode,a.anchorOffset),d.setEnd(a.focusNode,a.focusOffset),0==d.toString().length&&(d.setStart(a.focusNode,a.focusOffset),d.setEnd(a.anchorNode,a.anchorOffset))),u=d)}if(null==u)return null;var g=u.startContainer,c=u.startOffset,m=u.endContainer,p=u.endOffset;if(3!=g.nodeType){if(1!=g.nodeType)return null;if(c>0&&g.hasChildNodes()&&g.childNodes.length>c)if(3==(g=g.childNodes[c]).nodeType)c=0;else if(c=0,"[object HTMLEmbedElement]"==g.toString())return null}if(3!=m.nodeType){if(1!=m.nodeType)return null;if(m.hasChildNodes()&&(m.childNodes.length>p?m=m.childNodes[p]:3!=(m=m.childNodes[p-1]).nodeType&&null!=(f=t.getLastChildTextNode(m,!0))&&(m=f)),3!=m.nodeType){var f,S=t.getPreviousNode(g,!0,null);null!=(f=t.getPreviousTextNode(m,!1,S))&&(m=f)}p=3==m.nodeType?m.nodeValue.length:0}return r=new R(g,c,m,p),null!=n&&null!=r?{frame:n,range:r}:null}getSelectionById(e){let t,n=new M,r=new _;t="string"==typeof e?document.getElementById(e):e;let i=t.getRootNode(),a=window;if(i.mode&&"open"==i.mode&&(a=i),null!=t){if(1==t.nodeType&&"img"==t.tagName&&null==t.getAttribute("alt")&&null==t.getAttribute("msg"))return{frame:a,range:s};let e=t.innerHTML;if(e.length>0){let i=r.getFirstChildTextNode(t,!0);if(null==i||3!=i.nodeType&&!i.isMathJax){if(null==i||1!=i.nodeType||"img"!=i.tagName)return null;{let e=i.getAttribute("msg");if(null==e&&(e=i.getAttribute("alt")),!(null!=e&&e.length>0))return null}}let o=r.getLastChildTextNode(t,!0);if(null==o||3!=o.nodeType&&!o.isMathJax){if(null==o||1!=o.nodeType||"img"!=o.tagName)return null;{let e=o.getAttribute("msg");if(null==e&&(e=o.getAttribute("alt")),!(null!=e&&e.length>0))return null}}n.rw_getRefPt(i,0),3==o.nodeType?n.rw_getRefPt(o,o.nodeValue.length):n.rw_getRefPt(o,0);var s=new R(i,0,o,e.length);return null!=a&&null!=s?{frame:a,range:s}:null}}return null}}class H{constructor(e){this.no_scroll=e}rw_scrollToObject(e){var t=new M,n=!1;if(!this.no_scroll)try{var r=t.getWindow(e);if(null==r||null==e||null==e.parentNode)return;var i=0,a=0,s=e;3==s.nodeType&&(s=s.parentNode);for(var o,l,h,u,d=null,g=s,c=s.ownerDocument.body,m=null;null!=g&&g!=c;)"div"!=g.tagName.toLowerCase()&&"form"!=g.tagName.toLowerCase()||this.rw_isDivScrollable(g)&&(!0,d=this.rw_scrollToObjectDivCheck(s,g,d),m=g,s=g),g=g.parentNode;for(null!=m&&(s=m);null!=s;)i+=s.offsetLeft,a+=s.offsetTop,s=s.offsetParent;null!=d&&(a+=d.y,i+=d.x);var p,f,S=30;if(3==e.nodeType&&(S=10+5*e.nodeValue.length)>60&&(S=60),o=this.rw_getScreenOffsetLeft(r),l=this.rw_getScreenOffsetTop(r),"number"==typeof r.innerWidth?(h=r.innerWidth,u=r.innerHeight):r.document.documentElement.clientHeight>0&&r.document.documentElement.clientWidth>0?(h=r.document.documentElement.clientWidth,u=r.document.documentElement.clientHeight):(h=r.document.body.clientWidth,u=r.document.body.clientHeight),h-=S,u-=20,f=a<l||a>l+u,(p=i<o||i>o+h)||f&&(0!=i||0!=a)){i>o+h&&(i=(i+o)/2),a>l+u&&(a=(a+l)/2);n&&(n=!1),r.scrollTo(p?i:o,f?a:l);!1}}catch(e){}}rw_getScreenOffsetLeft(e){return void 0===e&&(e=window),e.pageXOffset&&e.pageXOffset>0?e.pageXOffset:e.document.body.scrollLeft&&e.document.body.scrollLeft>0?e.document.body.scrollLeft:e.document.documentElement.scrollLeft&&e.document.documentElement.scrollLeft>0?e.document.documentElement.scrollLeft:0}rw_getScreenOffsetTop(e){return void 0===e&&(e=window),e.pageYOffset&&e.pageYOffset>0?e.pageYOffset:e.document.body.scrollTop&&e.document.body.scrollTop>0?e.document.body.scrollTop:e.document.documentElement.scrollTop&&e.document.documentElement.scrollTop>0?e.document.documentElement.scrollTop:0}rw_getScreenOffsetLeftAlt(e){return void 0===e&&(e=window),"CSS1Compat"==e.document.compatMode&&e.document.body.parentNode&&e.document.body.parentNode.scrollLeft?e.document.body.parentNode.scrollLeft:e.pageXOffset?e.pageXOffset:e.scrollX?e.scrollX:e.document.body.scrollLeft?e.document.body.scrollLeft:e.document.documentElement.scrollLeft?e.document.documentElement.scrollLeft:0}rw_scrollToObjectDivCheck(e,t,n){for(var r=t.clientHeight,i=t.clientWidth,a=e.getBoundingClientRect().right-e.getBoundingClientRect().left,s=0,o=0,l=e;l!=t&&null!=l;)s+=l.offsetTop,o+=l.offsetLeft,l=this.rw_safeOffsetParent(l,t);return null==l&&(o-=t.offsetLeft,s-=t.offsetTop),null!=n&&(s+=n.y,o+=n.x),(t.scrollTop>s||t.scrollTop+r<s)&&(r>6*e.offsetHeight?t.scrollTop=s-e.offsetHeight:t.scrollTop=s),a<200&&(t.scrollLeft>o||t.scrollLeft+i<o+e.offsetWidth)&&(t.scrollLeft=o),{x:o-t.scrollLeft,y:s-t.scrollTop}}rw_safeOffsetParent(e,t){var n=e,r=n.offsetParent;if(null==r)return null;if(null==t)return r;for(;null!=n&&n!=r;){if(n==t)return null;n=n.parentNode}return r}rw_isDivScrollable(e){var t=new M,n=e.clientHeight,r=e.clientWidth,i=t.getComputedStyle(e),a=!1;return null!=i&&"visible"!=i.overflow&&"inline"!=i.display&&(e.scrollHeight>n&&"visible"!=i.overflowY&&(a=!0),e.scrollWidth>r&&"visible"!=i.overflowX&&(a=!0)),a}}class O{constructor(){this.node=null,this.offset=0}}class D{constructor(){this.style=null,this.fg=null,this.bg=null,this.lastSpanId=0}}class B{constructor(){this.count=1,this.list=[]}pushToList(e){this.list.push(e)}getList(){return this.list}}class V{constructor(){}isTokenType(e){return"entity"==e||"char"==e||"entities"==e||"chars"==e}looper(e,t,n){if(null!=e){var r=e.spanID?e.spanID:e.CHTMLnodeID;if(null!=(r=null!=r&&null!=r?r:e.PHTMLspanID)&&r==t)return n.pushToList(e),++n.count,!0;if(null!=e.data)for(var i=0;i<e.data.length;i++){var a=this.looper(e.data[i],t,n);if(a)return a}}return!1}getList(e,t){var n=new B;return this.looper(e,t,n),n.getList()}}class W{constructor(e){this.highlightDataStore={},this.highlightJaxRoot=e.root,this.highlightClearLast=!0,this.elementHelper=new V}setClearLastHighlight(e){this.highlightClearLast=e}setHighlightStyle(e,t,n){if("string"!=typeof e)return!1;if(this.highlightDataStore[e]&&this.highlightDataStore.hasOwnProperty(e)){var r=this.highlightDataStore[e];r&&r.lastSpanId>0&&this.clearHighlightNodesImpl(e,r.style,r.lastSpanId)}return null===t?(delete this.highlightDataStore[e],!0):"string"==typeof t&&(""===(t=t.toLowerCase())||"none"===t?(delete this.highlightDataStore[e],!0):(this.highlightDataStore[e]&&this.highlightDataStore.hasOwnProperty(e)?"highlight"!==(i=this.highlightDataStore[e]).style&&(i.fg=null,i.bg=null):i=new D,"fg"===t?(i.style="highlight",i.fg=n):"bg"===t?(i.style="highlight",i.bg=n):("outline"===t||"underline"===t)&&(i.style=t,i.fg=n,i.bg=null),this.highlightDataStore[e]=i,!0));var i}highlightNodes(e,t){var n;if(this.highlightDataStore[e]&&this.highlightDataStore.hasOwnProperty(e)&&null!==(n=this.highlightDataStore[e]).style){n.lastSpanId>0&&this.highlightClearLast&&this.clearHighlightNodesImpl(e,n.style,n.lastSpanId),n.lastSpanId=t;var r=this.elementHelper.getList(this.highlightJaxRoot,t);this.highlightImpl(r,e,n.style,n.fg,n.bg)}}clearHighlights(){for(var e in this.highlightDataStore)if(this.highlightDataStore.hasOwnProperty(e)){var t=this.highlightDataStore[e];this.clearHighlightNodesImpl(e,"",t.lastSpanId),t.lastSpanId=0}}clearHighlightNodes(e,t){this.clearHighlightNodesImpl(e,"",t)}parseColor(e){var t;if("string"==typeof e)t=parseInt(e,10);else{if("number"!=typeof e)throw"invalid";t=e}if(t<0||t>255)throw"invalid";return t}clearHighlightNodesImpl(e,t,n){for(var r=this.elementHelper.getList(this.highlightJaxRoot,n),i=0,a=r.length;i<a;i++){var s=r[i];if(""!==t&&"outline"!==t||delete s.mathoutline,""===t||"underline"===t)if(s.previousline){this.removeFromPrevious(s.previousline,e);var o=s.previousline.length;s.mathunderline=o>0?s.previousline[o-1].val:""}else s.mathunderline="";if(""===t||"highlight"===t){if(s.previouscolor){this.removeFromPrevious(s.previouscolor,e);o=s.previouscolor.length;s.mathcolor=o>0?s.previouscolor[o-1].val:""}else s.mathcolor=" ";delete s.mathbackground}var l=null;try{l=s.HTMLspanElement()}catch(e){}if(null==l)try{l=s.CHTMLnodeElement()}catch(e){}if(null==l)return;var h=!0;if(null!=s.HTMLremoveColor&&(h=this.setupPostFix(l,e,!0)),h)try{s.HTMLhandleColor(l)}catch(e){s.PHTMLhandleColor(l)}this.setdownPostFix(l);h=!0;if(null!=s.HTMLremoveColor&&(h=this.setupPostFix(l,e,!1)),h)if(null!=s.HTMLremoveColor)s.HTMLremoveColor();else{try{u=s.HTMLspanElement()}catch(e){u=s.CHTMLnodeElement()}null!=u&&(u.style.background="",u.style.color="")}if(this.setdownPostFix(l),null!=s.HTMLremoveColor){var u;try{u=s.HTMLspanElement()}catch(e){u=s.CHTMLnodeElement()}null!=u&&(u.style.background="",u.style.color="")}}}highlightImpl(e,t,n,r,i){for(var a=0,s=e.length;a<s;a++){var o=e[a];if("function"==typeof(o.HTMLhandleColor?o.HTMLhandleColor:o.CHTMLhandleColor)){var l=null;try{l=o.CHTMLnodeElement()}catch(e){}if(null==l)try{l=o.HTMLspanElement()}catch(e){}if(null==l)return;if("highlight"===n){if(null!=i&&(o.mathbackground=i),null!=r){if(o.previouscolor)this.removeFromPrevious(o.previouscolor,t);else if(o.previouscolor=[],o.mathcolor)o.previouscolor.push({key:"",val:o.mathcolor});else(new M).getComputedStyle(l).color;o.previouscolor.push({key:t,val:r}),o.mathcolor=r}}else"outline"===n?o.mathoutline=r+"thin solid":"underline"===n&&(o.previousline?this.removeFromPrevious(o.previousline,t):(o.previousline=[],o.textDecoration&&o.previousline.push({key:"",val:o.textDecoration})),o.previousline.push({key:t,val:"underline"}),o.mathunderline="underline");if(this.setupPostFix(l,t,!0))try{o.HTMLhandleColor(l)}catch(e){o.PHTMLhandleColor(l)}this.setdownPostFix(l)}}}removeFromPrevious(e,t){for(var n=0;n<e.length;n++)if(e[n].key===t)return void e.splice(n,1)}setupPostFix(e,t,n){try{var r=e.ownerDocument.defaultView.MathJax.OutputJax["HTML-CSS"]?e.ownerDocument.defaultView.MathJax.OutputJax["HTML-CSS"]:e.ownerDocument.defaultView.MathJax.OutputJax.CommonHTML,i="-"+t;if(n){var a=e.id+r.idPostfix+i;if(null!=document.getElementById(a))return!1}"string"==typeof r.idPostfix?(this.m_strTmpPostFix=r.idPostfix,r.idPostfix+=i):(this.m_strTmpPostFix="",r.idPostfix=i)}catch(e){return!1}return!0}setdownPostFix(e){try{var t=e.ownerDocument.defaultView.MathJax.OutputJax["HTML-CSS"]?e.ownerDocument.defaultView.MathJax.OutputJax["HTML-CSS"]:e.ownerDocument.defaultView.MathJax.OutputJax.CommonHTML;""==this.m_strTmpPostFix&&(t.idPostfix=null,delete t.idPostfix),null!=this.m_strTmpPostFix&&(t.idPostfix=this.m_strTmpPostFix,this.m_strTmpPostFix=null)}catch(e){}}}class j{constructor(e,t){this.highlightSettings=t,this.m_setupHash={},this.m_defaultContextBg={r:255,g:255,b:0},this.m_defaultContextFg={r:0,g:0,b:0},this.m_defaultWordBg={r:0,g:0,b:255},this.m_defaultWordFg={r:255,g:255,b:255},this.m_contextBg={r:255,g:255,b:0},this.m_contextFg={r:0,g:0,b:0},this.m_wordBg={r:0,g:0,b:255},this.m_wordFg={r:255,g:255,b:255},this.m_strContextStyle="highlight",this.m_strWordStyle="highlight",this.sentence=e,this.lastMathId=null}cssToObj(e){for(var t={},n=e.toLowerCase().replace(/-(.)/g,(function(e,t){return t.toUpperCase()})).replace(/;\s?$/g,"").split(/:|;/g),r=0;r<n.length;r+=2)t[n[r].replace(/\s/g,"")]=n[r+1].replace(/^\s+|\s+$/g,"");return t}setupHighlighter(e){try{e=e;this.h=new W(e);var t=this.cssToObj(this.highlightSettings.speechRangeColour),n=this.cssToObj(this.highlightSettings.speechWordColour);"highlight"===this.m_strContextStyle?(this.h.setHighlightStyle("context","bg",t.background),this.h.setHighlightStyle("context","fg",t.color)):"outline"===this.m_strContextStyle?this.h.setHighlightStyle("context","outline",t.color):"underline"===this.m_strContextStyle&&this.h.setHighlightStyle("context","underline",t.color),"highlight"===this.m_strWordStyle?(this.h.setHighlightStyle("word","bg",n.background),this.h.setHighlightStyle("word","fg",n.color)):"outline"===this.m_strWordStyle?this.h.setHighlightStyle("word","outline",n.color):"underline"===this.m_strWordStyle&&this.h.setHighlightStyle("word","underline",n.color)}catch(e){console.log(e)}}highlightRange(e,t){var n,r="context";null!=t&&(r=t),n=null!=e?e:this.sentence.getSpanId();try{this.lastMathId&&this.clearHighlights(),this.lastMathId=n;var i=this.sentence.m_range.body.ownerDocument.getElementById(n),a=this.getJaxFor(i),s=a.root.spanID?a.root.spanID:a.root.CHTMLnodeID;s=null!=s&&null!=s?s:a.root.PHTMLspanID,this.m_setupHash[n]||(this.setupHighlighter(a),this.m_setupHash[n]=!0),this.h.highlightNodes(r,s,a)}catch(e){}}unHighlightRange(e){null!=e||this.sentence.getSpanId();try{if(7==this.sentence.getWord(0).m_type){let e=this.sentence.getContents()[0];6==e.m_type&&null!=e.m_strPronunciation&&e.unhighlight("highlight")}}catch(e){console.logE(e)}}highlightWord(e){var t=e.getMathParentElementId(),n=e.getSpanId(),r=e.getJaxId();try{var i=e.m_range.body.ownerDocument.getElementById(n),a=this.getJaxFor(i);this.m_setupHash[t]||(this.setupHighlighter(a),this.m_setupHash[t]=!0),this.h.highlightNodes("word",r,a)}catch(e){console.log(e)}}setHighlightStyle(e,t,n,r){if(this.m_setupHash=[],"string"==typeof e){void 0===t&&(t="word");var i="undefined"==typeof p_rgb;"context"===t?(this.m_strContextStyle=e,"highlight"===e?(this.m_contextBg=i?this.m_defaultContextBg:r,this.m_contextFg=i?this.m_defaultContextFg:n):"outline"!==e&&"underline"!==e||(this.m_contextFg=i?this.m_defaultContextBg:n)):"word"===t&&(this.m_strWordStyle=e,"highlight"===this.m_strWordStyle?(this.m_wordBg=i?this.m_defaultWordBg:r,this.m_wordFg=i?this.m_defaultWordFg:n):"outline"!==e&&"underline"!==e||(this.m_wordFg=i?this.m_defaultWordBg:n))}}getJaxFor(e){return e.ownerDocument.defaultView.MathJax.Hub.getJaxFor(e)}checkText(e){for(var t=e.indexOf("<mtext>");t>-1&&(n=e.indexOf("</mtext>",t))>t;)t=0==e.substring(t+7,n).trimTH().length?(e=e.substr(0,t)+e.substr(n+8)).indexOf("<mtext>",t):e.indexOf("<mtext>",n+8);for(t=e.indexOf("<mn>");t>-1&&(n=e.indexOf("</mn>",t))>t;)t=0==e.substring(t+4,n).trimTH().length?(e=e.substr(0,t)+e.substr(n+5)).indexOf("<mn>",t):e.indexOf("<mn>",n+5);var n;for(t=e.indexOf("<mover>");t>-1&&(n=e.indexOf("</mover>",t))>t;)t=0==e.substring(t+7,n).trimTH().length?(e=e.substr(0,t)+e.substr(n+8)).indexOf("<mover>",t):e.indexOf("<mover>",n+8);return e}}class G{constructor(e,t){this.highlightSettings=t,this.sentence=e,this.mathJaxHighlighter=new j(e,t)}highlightRange(){}unHighlightRange(){}rw_setNodeBackground(e,t,n,r,i){var a=new M,s=new h,o=new _,u=new O;if(u.node=e,u.offset=t,3!=e.nodeType){if(1==e.nodeType&&a.isSpecialCaseHighlightable(e)){if(null!=e.tagName&&"math"==e.tagName.toLowerCase()){var d=e.parentNode;u=this.rw_setNodeBackgroundImpl(d,e,t,n,r,"")}else if(e.isMathJax){d=e.parentNode;u=this.rw_setNodeBackgroundImpl(d,e,t,n,r,"")}else{var g=o.getFirstChildTextNode(e,!1),m=o.getLastChildTextNode(e,!1);null!=g&&3==g.nodeType&&null!=m&&3==m.nodeType&&(this.rw_setSpeechRangeImpl(g,0,m,m.nodeValue.length,r),u.node=g,u.offset=0)}return u}return u}if(3==e.nodeType){var p=e.nodeValue,f=new l;if(0==(p=f.trim(p)).length){var S=e.parentNode;if(null!=S){var v=f.trim(S.tagName).toLowerCase();if("tr"==v||"table"==v)return u}}}var w=null;if((d=e.parentNode).tagName.toLowerCase()==c&&(w=s.rw_getAttribute(d,"rwstate")),"spell"==r){if(null!=w&&""!=w)return u;u=this.rw_setNodeBackgroundImpl(d,e,t,n,r,i)}else if("hom"==r){if(null!=w&&""!=w)return u;u=this.rw_setNodeBackgroundImpl(d,e,t,n,r,i)}else if("grammar"==r){if(null!=w&&""!=w)return u;u=this.rw_setNodeBackgroundImpl(d,e,t,n,r,i)}else if("ss"==r){if(null!=w&&""!=w)return u;u=this.rw_setNodeBackgroundImpl(d,e,t,n,r,i)}else if("sp"==r){if("csp"==w)return u;if("sp"==w)return u;u=this.rw_setNodeBackgroundImpl(d,e,t,n,r,"")}else if("csp"==r){if("csp"==w)return u;"sp"==w&&(u=this.rw_setNodeBackgroundImpl(d,e,t,n,r,""))}return u}rw_setNodeBackgroundImpl(e,t,n,r,i,a){new M;var s,o=new h,l="sp"===i||"csp"===i,u="";if(1==t.nodeType&&(u=t.tagName.toLowerCase()),3==t.nodeType&&(-1==r||r>n)||"math"==u||t.isMathJax)if(s="ss"==i?"strikethrough"==a?"text-decoration:line-through":"background:"+a:"sp"==i?this.highlightSettings.speechRangeColour:"csp"==i?this.highlightSettings.speechWordColour:"spell"==i||"hom"==i||"grammar"==i?"":"color:#ff000; background:#00ff00","math"==u||t.isMathJax){if(l){new j(this.sentence,this.highlightSettings).highlightRange(t.id)}}else{var d,g=t.nodeValue.length;if(1==g&&("\n"==t.nodeValue||"\r"==t.nodeValue)||2==g&&"\r\n"==t.nodeValue)return(d=new O).node=t,d.offset=n<0?0:n,d;var m=e.ownerDocument,p=!1;-1==n&&-1==r?p=!0:-1==r&&(r=g),0==n&&r>=g&&(p=!0);var f=m.createElement(c);if("spell"==i&&(o.rw_setAttribute(f,"spellnum",a),f.className="thspell"),"grammar"==i){o.rw_setAttribute(f,"grammarnum",a),f.className="thgrammar"}if(p)f.setAttribute("style",s),o.rw_setAttribute(f,"rwstate",i),l&&o.rw_setAttribute(f,"started","1"),e.replaceChild(f,t),f.appendChild(t);else{var S,v,w,b=t.nodeValue;"span"!=e.tagName.toLowerCase()&&"thspan"!=e.tagName.toLowerCase()||null==o.rw_getAttribute(e,"pron")?(S=b.substring(0,n),v=b.substring(n,r),w=b.substring(r)):(S="",v=b,w=""),f.setAttribute("style",s),o.rw_setAttribute(f,"rwstate",i),l&&o.rw_setAttribute(f,"started","1");var y,C=null,T=null;S.length>0&&(C=m.createTextNode(S)),y=m.createTextNode(v),w.length>0&&(T=m.createTextNode(w)),f.appendChild(y),e.replaceChild(f,t),null!=C&&e.insertBefore(C,f),null!=T&&(null==f.nextSibling?e.insertBefore(T,null):e.insertBefore(T,f.nextSibling)),t=y}}return(d=new O).node=t,d.offset=n<0?0:n,d}rw_highlightMathJaxElement(e,t){new j(this.sentence,this.highlightSettings).highlightRange(e.m_strSpanId,t)}rw_unHHighlightMathJaxElement(e){new j(this.sentence,this.highlightSettings).unHighlightRange(e.id)}rw_highlightMathElement(e,t,n,r){new M;var i=new h;if(null!=e)for(var a=e.firstChild;null!=a;)1==a.nodeType&&(r?null!=i.rw_getAttribute(a,"started")?(a.setAttribute("style",n),i.rw_setAttribute(a,"rwstate",t)):null==i.rw_getAttribute(a,"style")&&(a.setAttribute("style",n),i.rw_setAttribute(a,"rwstate",t),i.rw_setAttribute(a,"started","1")):null!=i.rw_getAttribute(a,"started")&&(a.removeAttribute("style"),i.rw_removeAttribute(a,"started"),i.rw_removeAttribute(a,"rwstate"))),a=a.nextSibling}getListOfHighlightableNodes(e,t){new M;var n=new _,r=new Array;try{var i=e.node,a=t.node;if(3!=i.nodeType)if(1==i.nodeType&&null!=i.tagName&&"math"==i.tagName.toLowerCase()){if(r.push(i),i==a)return r;i=n.getNextTextNode(i,!1,a)}else if(1==i.nodeType&&i.isMathJax){if(r.push(i),i==a)return r;i=n.getNextTextNode(i,!1,a)}else if(null==(i=n.getFirstChildTextNode(i,!1)))return r;if(i==a){if(3==i.nodeType)(o=i.nodeValue).length>0&&e.offset<o.length&&t.offset>0&&t.offset>e.offset&&r.push(i)}else{if(3==i.nodeType)(o=i.nodeValue).length>0&&e.offset<o.length&&r.push(i);else(1==i.nodeType&&null!=i.tagName&&"math"==i.tagName.toLowerCase()||1==i.nodeType&&i.isMathJax)&&r.push(i);for(var s=n.getNextTextNodeNoImg(i,!1,a,!0);null!=s;){if(s==a){var o;if(3==a.nodeType)(o=a.nodeValue).length>0&&t.offset>0&&r.push(a);else(1==s.nodeType&&null!=s.tagName&&"math"==s.tagName.toLowerCase()||1==s.nodeType&&s.isMathJax)&&r.push(s);break}r.push(s),s=n.getNextTextNodeNoImg(s,!1,a,!0)}}}catch(e){console.log("getListOfHighlightableNodes error:"+e.message)}return r}}class J extends G{constructor(e,t){super(e,t),this.sentence=e,this.highlightSettings=t,this.contextStyleObject=this.cssToObj(this.highlightSettings.speechRangeColour),this.wordStyleObject=this.cssToObj(this.highlightSettings.speechWordColour)}cssToObj(e){for(var t={},n=e.toLowerCase().replace(/-(.)/g,(function(e,t){return t.toUpperCase()})).replace(/;\s?$/g,"").split(/:|;/g),r=0;r<n.length;r+=2)t[n[r].replace(/\s/g,"")]=n[r+1].replace(/^\s+|\s+$/g,"");return t}highlightRange(){if(this.sentence.isMathML()){let e=this.sentence.getContents()[0];6==e.m_type&&(e.highlight(this.contextStyleObject.background,this.contextStyleObject.color,"context",!0),i.publish("analytics",{event:"SpeechUtils",action:"mathml"}))}else{var e=this.sentence.getRange();new M;try{if(null!=e){var t=new I(e.body,e.startRef.path,e.startRef.offset,e.endRef.path,e.endRef.offset),n=t.leftCaret,r=t.rightCaret;null!=n&&null!=r&&this.rw_setSpeechRangeImpl(n.node,n.offset,r.node,r.offset,"sp")}}catch(e){}}}unHighlightRange(){if(this.sentence.isMathML()){let e=this.sentence.getContents()[0];6==e.m_type&&(e.unhighlight("context"),e.unhighlight("word"))}else{var e=this.sentence.getRange();new M;try{if(null!=e){var t=new I(e.body,e.startRef.path,e.startRef.offset,e.endRef.path,e.endRef.offset),n=t.leftCaret,r=t.rightCaret;null!=n&&null!=r&&this.rw_removeSpeechHighlight(this.getListOfHighlightableNodes(n,r),!1)}}catch(e){}}}highlightWord(e){if(e<this.sentence.getAllWords().length){var t=this.sentence.getWord(e);if(7==t.m_type){let n=this.sentence.getContents()[0];if(6==n.m_type&&null!=n.m_strPronunciation)n.highlight(this.wordStyleObject.background,this.wordStyleObject.color,"word",!1),i.publish("analytics",{event:"SpeechUtils",action:"Aria math role label"});else{if(e-1>-1){this.sentence.getWord(e-1).unhighlight("word")}t.highlight(this.wordStyleObject.background,this.wordStyleObject.color,"word")}}else{new M;if(e>0){var n=this.sentence.getWordRange(e-1);if(null!=n){var r=(o=new I(n.body,n.startRef.path,n.startRef.offset,n.endRef.path,n.endRef.offset)).leftCaret,a=o.rightCaret;null!=r&&null!=a&&this.rw_removeSpeechHighlight(this.getListOfHighlightableNodes(r,a),!0)}}var s=this.sentence.getWordRange(e);if(null!=s){var o;r=(o=new I(s.body,s.startRef.path,s.startRef.offset,s.endRef.path,s.endRef.offset)).leftCaret,a=o.rightCaret;if(null!=r&&null!=a){var l=new H(u.no_scroll),h=this.rw_setSpeechRangeImpl(r.node,r.offset,a.node,a.offset,"csp");null!=h&&null!=h.node?l.rw_scrollToObject(h.node):l.rw_scrollToObject(r.node)}}}}}rw_removeSpeechHighlight(e,t){var n=new M;try{if(void 0===t&&(t=!1),null==e||!(e instanceof Array)||0==e.length)return;for(var r=0;r<e.length;r++){var i=e[r];if(this.rw_checkNodeIsSpeechText(i,t)){var a=i.parentNode;if(null!=i.nextSibling||null!=i.previousSibling){var s=n.allTextFromNodeTH(a);i=a.ownerDocument.createTextNode(s)}a.parentNode.replaceChild(i,a),i=n.mergeTextNodes(i),e[r]=i,this.rw_checkNodeIsSpeechText(i,t)&&--r}else{var o="";1==i.nodeType&&(o=i.tagName.toLowerCase()),"math"==o&&this.rw_highlightMathElement(i,null,null,!1),i.isMathJax&&this.rw_unHHighlightMathJaxElement(i)}}}catch(e){}}rw_checkNodeIsSpeechText(e,t){new M;var n=new h;if(3!=e.nodeType||null==e.parentNode||null==e.parentNode.parentNode)return!1;var r=e.parentNode,i=n.rw_getAttribute(r,"rwstate");return r.tagName.toLowerCase()==c&&null!=i&&(!t&&"sp"==i||"csp"==i)}rw_setSpeechRangeImpl(e,t,n,r,i){new M;var a=new _,s=null;try{if(n==e)return s=this.rw_setNodeBackground(e,t,r,i,"");s=t>0?this.rw_setNodeBackground(e,t,e.nodeValue.length,i,""):this.rw_setNodeBackground(e,-1,-1,i,"");for(var o=a.getNextTextNodeNoImg(s.node,!1,n,!0);null!=o;){if(o==n){o=(s=this.rw_setNodeBackground(o,0,r,i,"")).node;break}o=(s=this.rw_setNodeBackground(o,-1,-1,i,"")).node,o=a.getNextTextNodeNoImg(o,!1,n,!0)}}catch(e){console.log("rw_setSpeechRangeImpl error:"+e.message)}return s}}class U{constructor(e,t){this.highlightController=new J(e,t)}highlightRange(){this.highlightController.highlightRange()}unHighlightRange(){this.highlightController.unHighlightRange()}highlightWord(e){this.highlightController.highlightWord(e)}}class q{constructor(e){this.m_range=null,this.m_type=e,this.m_bValid=!0,this.m_contents=null,this.Types={WORD:1,SENTENCE:2,SSML:3,DOCUMENT:4,SILENCE:5,MATHML:6,MATHWORD:7}}getRange(){return this.m_range}setRange(e){e instanceof N&&(this.m_range=e)}getType(){return this.m_type}isValid(){return this.m_bValid}setValid(e){this.m_bValid=e}getContents(){return null==this.m_contents&&(this.m_contents=[]),this.m_contents}setContents(e){this.m_contents=e instanceof Array?e:[e]}addContent(e){null==this.m_contents&&(this.m_contents=[]),this.m_contents.push(e)}isOverridingText(){return!1}getWordCount(){if(this.m_type==this.Types.WORD||this.isOverridingText())return 1;var e=0;if(null==this.m_contents&&(this.m_contents=[]),this.m_contents.length>0){var t,n=this.m_contents.length;for(t=0;t<n;t++)e+=this.m_contents[t].getWordCount()}return e}getWords(){if(this.m_type==this.Types.WORD||this.isOverridingText())return[this];var e=[];if(null==this.m_contents&&(this.m_contents=[]),this.m_contents.length>0){var t,n=this.m_contents.length;for(t=0;t<n;t++)e=e.concat(this.m_contents[t].getWords())}return e}getFirstNode(){var e=new M,t=this.getRange();if(null!=t){var n=e.rw_getCaretFromRefPt(t.body,t.startRef);if(null!=n&&null!=n.node)return n.node}return null}getSpokenText(){return""}}class z{constructor(e){var t=e.getCaretRange(),n=new M;this.sentenceObject=e,this.leftNode=t.leftCaret.node,this.rightNode=t.rightCaret.node,this.body=n.getBody(this.leftNode),this.leftOffset=t.leftCaret.offset,this.rightOffset=t.rightCaret.offset,this.currentNode=this.leftNode,this.storedText="",this.startRefPt=null,this.endRefPt=null}}class $ extends q{constructor(e,t){super(1),this.setRange(e),this.m_strWord=t,this.m_strPronunciation=null}getWord(){return this.getSpokenText()}setPronunciation(e){this.m_strPronunciation=e}getPronunciation(){return this.m_strPronunciation}isOverridingText(){return null!=this.m_strPronunciation}getSpokenText(){return null!=this.m_strPronunciation?this.m_strPronunciation:this.m_strWord}}class X extends q{constructor(e,t,n,r,i,a,s,o){super(7),this.setRange(s),this.mathParentElementId=e,this.htmlElem=t,this.spanID=n,this.jaxID=r,this.m_strWord=a,this.mathML=i,this.m_strPronunciation=null,this.jaxItems=o}getMathParentElementId(){return this.mathParentElementId}setMathParentElementId(e){this.mathParentElementId=e}getSpanId(){return this.spanID}setSpanId(e){this.spanID=e}getJaxId(){return this.jaxID}setJaxId(e){this.jaxID=e}getWord(){return this.m_strWord}setPronunciation(e){this.m_strPronunciation=e}getPronunciation(){return this.m_strPronunciation}isOverridingText(){return null!=this.m_strPronunciation}getSpokenText(){return null!=this.m_strPronunciation?this.m_strPronunciation:this.m_strWord}unhighlight(e){if(this.jaxItems.previouscolor){this.removeFromPrevious(this.jaxItems.previouscolor,e);var t=this.jaxItems.previouscolor.length;this.jaxItems.mathcolor=t>0?this.jaxItems.previouscolor[t-1].val:""}else this.jaxItems.mathcolor=" ";delete this.jaxItems.mathbackground;var n=!0;if(null!=this.jaxItems.HTMLremoveColor&&(n=this.setupPostFix(this.htmlElem,e,!0)),n)try{this.jaxItems.HTMLhandleColor(this.htmlElem)}catch(e){this.jaxItems.PHTMLhandleColor(this.htmlElem)}this.setdownPostFix(this.htmlElem);var r;n=!0;(null!=this.jaxItems.HTMLremoveColor&&(n=this.setupPostFix(this.htmlElem,e,!1)),n)&&(null!=this.jaxItems.HTMLremoveColor?this.jaxItems.HTMLremoveColor():null!=(r=this.htmlElem)&&(r.style.background="",r.style.color=""));(this.setdownPostFix(this.htmlElem),null!=this.jaxItems.HTMLremoveColor)&&(null!=(r=this.htmlElem)&&(r.style.background="",r.style.color=""))}highlight(e,t,n){if("function"==typeof(this.jaxItems.HTMLhandleColor?this.jaxItems.HTMLhandleColor:this.jaxItems.CHTMLhandleColor)){if(null==this.htmlElem)return;if(null!=e&&(this.jaxItems.mathbackground=e),null!=t){if(this.jaxItems.previouscolor)this.removeFromPrevious(this.jaxItems.previouscolor,n);else if(this.jaxItems.previouscolor=[],this.jaxItems.mathcolor)this.jaxItems.previouscolor.push({key:"",val:this.jaxItems.mathcolor});else{(new M).getComputedStyle(this.htmlElem).color}this.jaxItems.previouscolor.push({key:n,val:t}),this.jaxItems.mathcolor=t}if(this.setupPostFix(this.htmlElem,n,!0))try{this.jaxItems.HTMLhandleColor(this.htmlElem)}catch(e){this.jaxItems.PHTMLhandleColor(this.htmlElem)}this.setdownPostFix(this.htmlElem)}}setupPostFix(e,t,n){try{var r=e.ownerDocument.defaultView.MathJax.OutputJax["HTML-CSS"]?e.ownerDocument.defaultView.MathJax.OutputJax["HTML-CSS"]:e.ownerDocument.defaultView.MathJax.OutputJax.CommonHTML,i="-"+t;if(n){var a=e.id+r.idPostfix+i;if(null!=e.ownerDocument.getElementById(a))return!1}"string"==typeof r.idPostfix?(this.m_strTmpPostFix=r.idPostfix,r.idPostfix+=i):(this.m_strTmpPostFix="",r.idPostfix=i)}catch(e){return!1}return!0}setdownPostFix(e){try{var t=e.ownerDocument.defaultView.MathJax.OutputJax["HTML-CSS"]?e.ownerDocument.defaultView.MathJax.OutputJax["HTML-CSS"]:e.ownerDocument.defaultView.MathJax.OutputJax.CommonHTML;""==this.m_strTmpPostFix&&(t.idPostfix=null,delete t.idPostfix),null!=this.m_strTmpPostFix&&(t.idPostfix=this.m_strTmpPostFix,this.m_strTmpPostFix=null)}catch(e){}}removeFromPrevious(e,t){for(let n=0;n<e.length;n++)if(e[n].key===t)return void e.splice(n,1)}}class Y extends q{constructor(e,t,n,r,i,a,s,o,l){super(6),this.setRange(e),this.m_strSpanId=i,this.m_strRawText=t,this.m_strMarkedText=n,this.m_strMathML=r,this.m_strPronunciation=s,this.mathArrayObjects=a,this.jaxElem=o,this.htmlElem=l,this.jaxSpanid=this.jaxElem.spanID?this.jaxElem.spanID:this.jaxElem.CHTMLnodeID,this.elementHelper=new V,this.list=this.elementHelper.getList(this.jaxElem,this.jaxSpanid),this.splitMathIntoWords()}getSpokenText(){let e;return e=null!=this.m_strPronunciation?this.m_strPronunciation:this.m_strMarkedText,e}getMathML(){return this.m_strMathML}setPronunciation(e){this.m_strPronunciation=e}getPronunciation(){return this.m_strPronunciation}isOverridingText(){return null!=this.m_strPronunciation}getMarkedText(){let e;return e=null!=this.m_strPronunciation?this.m_strPronunciation:this.m_strMarkedText,e}getWord(){return this.getSpokenText()}splitMathIntoWords(){if(null!=this.mathArrayObjects){let e=this.mathArrayObjects;for(let t=0;t<e.length;t++)if(this.m_strMarkedText.toLowerCase().search('<mark name="'+e[t].jaxSpanid,"g")>-1){let n=this.m_strMarkedText.toLowerCase().search('<mark name="'+e[t].jaxSpanid,"g")+12,r=this.m_strMarkedText.toLowerCase().indexOf("<mark name=",n),i=this.m_strMarkedText.substring(n,r);i=i.replace(e[t].jaxSpanid+'"/>',""),i=i.replace('<say-as interpret-as="spell">',""),i=i.replace("</say-as>","");let a=e[t].htmlElem,s=new M,o=s.rw_getRefPt(a,0),l=s.rw_getRefPt(a,0),h=new X(this.m_strSpanId,a,"MathJax-Span-"+e[t].jaxSpanid,e[t].jaxSpanid,e[t].span,i,new N(a.ownerDocument.body,o,l),e[t].data);this.addContent(h)}}}unhighlight(e){for(let a=0,s=this.list.length;a<s;a++){let s=this.list[a];if(s.previouscolor){this.removeFromPrevious(s.previouscolor,e);var t=s.previouscolor.length;s.mathcolor=t>0?s.previouscolor[t-1].val:""}else s.mathcolor=" ";delete s.mathbackground;var n=null;try{n=s.HTMLspanElement()}catch(e){}if(null==n)try{n=s.CHTMLnodeElement()}catch(e){}if(null==n)return;var r=!0;if(null!=s.HTMLremoveColor&&(r=this.setupPostFix(n,e,!0)),r)try{s.HTMLhandleColor(n)}catch(e){s.PHTMLhandleColor(n)}this.setdownPostFix(n);r=!0;if(null!=s.HTMLremoveColor&&(r=this.setupPostFix(n,e,!1)),r)if(null!=s.HTMLremoveColor)s.HTMLremoveColor();else{try{i=s.HTMLspanElement()}catch(e){i=s.CHTMLnodeElement()}null!=i&&(i.style.background="",i.style.color="")}if(this.setdownPostFix(n),null!=s.HTMLremoveColor){var i;try{i=s.HTMLspanElement()}catch(e){i=s.CHTMLnodeElement()}null!=i&&(i.style.background="",i.style.color="")}}for(let t=0,n=this.getContents().length;t<n;t++)this.getContents()[t].unhighlight(e);var a=this.htmlElem.ownerDocument.getElementById("currently-highlighting-speech-"+e);null!=a&&this.htmlElem.ownerDocument.head.removeChild(a)}highlight(e,t,n,r){for(let s=0,o=this.list.length;s<o;s++){let o=this.list[s];if("function"==typeof(o.HTMLhandleColor?o.HTMLhandleColor:o.CHTMLhandleColor)){var i=null;try{i=o.CHTMLnodeElement()}catch(e){}if(null==i)try{i=o.HTMLspanElement()}catch(e){}if(null==i)return;if(null!=e&&(o.mathbackground=e),null!=t){if(o.previouscolor)this.removeFromPrevious(o.previouscolor,n);else if(o.previouscolor=[],o.mathcolor)o.previouscolor.push({key:"",val:o.mathcolor});else{(new M).getComputedStyle(i).color}o.previouscolor.push({key:n,val:t}),o.mathcolor=t}if(this.setupPostFix(i,n,!0))try{o.HTMLhandleColor(i)}catch(e){o.PHTMLhandleColor(i)}if(!r){var a=this.htmlElem.ownerDocument.createElement("style");a.type="text/css",a.id="currently-highlighting-speech-"+n,a.innerHTML="#"+this.htmlElem.id+" * {color: "+t+";}",this.htmlElem.ownerDocument.head.appendChild(a)}this.setdownPostFix(i)}}}setupPostFix(e,t,n){try{var r=e.ownerDocument.defaultView.MathJax.OutputJax["HTML-CSS"]?e.ownerDocument.defaultView.MathJax.OutputJax["HTML-CSS"]:e.ownerDocument.defaultView.MathJax.OutputJax.CommonHTML,i="-"+t;if(n){var a=e.id+r.idPostfix+i;if(null!=e.ownerDocument.getElementById(a))return!1}"string"==typeof r.idPostfix?(this.m_strTmpPostFix=r.idPostfix,r.idPostfix+=i):(this.m_strTmpPostFix="",r.idPostfix=i)}catch(e){return console.logE(e),!1}return!0}setdownPostFix(e){try{var t=e.ownerDocument.defaultView.MathJax.OutputJax["HTML-CSS"]?e.ownerDocument.defaultView.MathJax.OutputJax["HTML-CSS"]:e.ownerDocument.defaultView.MathJax.OutputJax.CommonHTML;""==this.m_strTmpPostFix&&(t.idPostfix=null,delete t.idPostfix),null!=this.m_strTmpPostFix&&(t.idPostfix=this.m_strTmpPostFix,this.m_strTmpPostFix=null)}catch(e){}}removeFromPrevious(e,t){for(let n=0;n<e.length;n++)if(e[n].key===t)return void e.splice(n,1)}}class K extends q{constructor(){super(3),this.m_strSsmlType=null,this.m_strAttrText=null,this.m_node=null}getSsmlType(){return this.m_strSsmlType}setSsmlType(e){this.m_strSsmlType=e}getAttr(){return this.m_strAttrText}setAttr(e){this.m_strAttrText=e}getSSMLOpeningTag(e){return'<?xml version="1.0"?>\n            <speak version="1.1" xmlns="http://www.w3.org/2001/10/synthesis"\n                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n                   xsi:schemaLocation="http://www.w3.org/2001/10/synthesis\n                             http://www.w3.org/TR/speech-synthesis11/synthesis.xsd"\n                   xml:lang="'+e+'">'}getSSMLClosingTag(){return"</speak>"}getOpeningTag(){return"<"+this.getSsmlType()+" "+this.getAttr()+">"}getClosingTag(){return"</"+this.getSsmlType()+">"}getTextFromContents(){if(null==this.m_contents)return"";let e,t="",n=this.m_contents.length;for(e=0;e<n;e++)t+=this.m_contents[e].getSpokenText();return t}getTextFromContentsNoTags(){if(null==this.m_contents)return"";let e,t="",n=this.m_contents.length;for(e=0;e<n;e++)this.m_contents[e].getType()==this.Types.WORD?t+=this.m_contents[e].getSpokenText():t+=this.m_contents[e].getTextFromContentsNoTags();return t}setNode(e){this.m_node=e;let t=new N;this.setRange(t.rw_getTHRangeFromElement(e))}getFirstNode(){return this.m_node}getWord(){return this.getSpokenText()}}class Q extends K{constructor(e,t){super(),this.m_strAlias=t,this.setNode(e),this.setSsmlType("sub"),this.setAttr('alias="'+t+'" ')}isOverridingText(){return!0}getSpokenText(){return" "+this.m_strAlias+" "}canContainContent(){return!1}}class Z extends K{constructor(e,t,n){super(),this.setNode(e),this.setSsmlType("phoneme"),this.setAttr('alphabet="'+t+'" ph="'+n+'"')}isOverridingText(){return!0}getSpokenText(){return this.getOpeningTag()+" "+this.getTextFromContentsNoTags()+" "+this.getClosingTag()}canContainContent(){return!0}}class ee extends K{constructor(e,t,n){super(),this.setNode(e),this.setSsmlType("say-as"),"string"==typeof n?this.setAttr('interpret-as="'+t+'" format="'+n+'" '):this.setAttr('interpret-as="'+t+'" ')}isOverridingText(){return!0}getSpokenText(){return this.getOpeningTag()+this.getTextFromContents()+this.getClosingTag()}canContainContent(){return!0}}class te extends K{constructor(e,t){super(),this.setNode(e),this.setSsmlType("emphasis"),"string"==typeof t?this.setAttr('level="'+t+'" '):this.setAttr('level="moderate" ')}isOverridingText(){return!1}getSpokenText(){return this.getOpeningTag()+this.getTextFromContents()+" "+this.getClosingTag()}canContainContent(){return!0}}class ne extends K{constructor(e,t,n){let r;super(),o(this,"isOverridingText",(function(){return!0})),o(this,"getSpokenText",(function(){return"<break "+this.getAttr()+"/>"})),o(this,"canContainContent",(function(){return!1})),this.setNode(e),this.setSsmlType("break"),"string"==typeof t?(r=t.indexOf("ms")>-1?t.substr(0,t.indexOf("ms")):t.indexOf("s")>-1?t.substr(0,t.indexOf("s")):t,this.setAttr('time="'+t+'" ')):"string"==typeof n?(n=n.toLowerCase(),this.setAttr('strength="'+n+'" ')):this.setAttr('strength="medium" ')}}class re extends K{constructor(e,t,n,r){super(),this.setNode(e),this.setSsmlType("prosody"),"string"==typeof t?this.setAttr('pitch="'+t+'" '):"string"==typeof n?this.setAttr('rate="'+n+'" '):"string"==typeof r&&this.setAttr('volume="'+r+'" ')}isOverridingText(){return!1}getSpokenText(){return this.getOpeningTag()+this.getTextFromContents()+this.getClosingTag()}canContainContent(){return!0}}class ie extends q{constructor(e){super(2);new M;this.lang=null,this.SSML_NAMESPACE="ssml",this.SSMS_TYPES={SUB:"sub",PHONEME:"phoneme",SAYAS:"say-as",EMPHASIS:"emphasis",BREAK:"break",PROSODY:"prosody"},this.SSMS_ATTRIBUTES={ALPHABET:"alphabet",PH:"ph",ALIAS:"alias",INTERPRETAS:"interpret-as",FORMAT:"format",LEVEL:"level",STRENGTH:"strength",TIME:"time",PITCH:"pitch",RATE:"rate",VOLUME:"volume"},this.m_range=new R(e.leftCaret.node,e.leftCaret.offset,e.rightCaret.node,e.rightCaret.offset),this.m_caretRange=e,this.m_strRawText=e.getTextOverCaretRange(),this.setLangTagWithRange(e),this.math=!1,this.image=e.checkIfImage(),this.m_strMarkedText,this.jumpId,this.allowContinuous=!0}setVoice(e){this.m_strVoice=e}setLangTagWithRange(e){let t=e.rightCaret.node;for(;null!=t;){if(1==t.nodeType){let e=t.lang;if(null!=e&&e.length>0){this.lang=t.lang;break}}t=t.parentNode}}setLangTag(e){this.lang=e}getLangTag(){return this.lang}getVoice(){return this.m_strVoice}getSpanId(){return this.sentenceSpanId}setMathSymbolControl(e,t){this.mathSymbolControl=e,this.mathWithContext=t}setCaretRange(e){this.m_caretRange=e,this.m_range=new R(e.leftCaret.node,e.leftCaret.offset,e.rightCaret.node,e.rightCaret.offset)}getCaretRange(){return this.m_caretRange}getWords(){for(var e=new Array,t=this.getContents(),n=0;n<t.length;n++)e.push(t[n].getWord());return e}getAllWords(){var e=new Array,t=this.getContents();for(let n=0;n<t.length;n++)switch(t[n].m_type){case 6:let r=t[n].getContents();for(let t=0;t<r.length;t++)e.push(r[t]);break;case 1:e.push(t[n]);break;default:e.push(t[n])}return e}getWordRange(e){let t=this.getContents(),n=new Array;for(let e=0;e<t.length;e++)switch(t[e].m_type){case 6:let r=t[e].getContents();for(let e=0;e<r.length;e++)n.push(r[e]);break;case 1:n.push(t[e]);break;default:n.push(t[e])}return e<n.length?n[e].getRange():null}getWord(e){let t=this.getContents(),n=new Array;for(let e=0;e<t.length;e++)switch(t[e].m_type){case 6:let r=t[e].getContents();for(let e=0;e<r.length;e++)n.push(r[e]);break;case 1:n.push(t[e]);break;default:n.push(t[e])}return e<n.length?n[e]:null}isMathML(){return this.math}isImage(){return this.image}getRawText(){return this.m_strRawText}setRawText(e){this.m_strRawText=e}getMarkedText(){return this.m_strMarkedText}setMarkedText(e){this.m_strMarkedText=e}clone(){var e=new ie(this.m_caretRange);return e.setContents(this.getContents()),e.setValid(this.isValid()),e.setLangTag(this.lang),e.setRawText(this.m_strRawText),e.setMarkedText(this.m_strMarkedText),e}processTextToSpeakInSentenceObject(e){this.processTextToSpeakInSentenceObjectImpl(e),u.strAnnounceLinksAsWords&&this.handleLinkToAnnounceAsWord(e);for(var t=this.getContents(),n=0;n<t.length;n++){var r=t[n];if(this.mathSymbolControl&&this.mathWithContext&&r.m_strWord){let e,i;null!=t[n-1]&&null!=t[n-1].m_strWord&&(e=t[n-1].m_strWord),null!=t[n+1]&&null!=t[n+1].m_strWord&&(i=t[n+1].m_strWord);let a=this.mathSymbolControl.mathsSymbolReplacementWithContext(r.m_strWord,e,i,this);a!=r.m_strWord&&r.setPronunciation(a)}var i=r.getFirstNode();null!=i&&this.isNestedSsml(i)&&this.insertInWrappingSsml(t,n,i)}}isNestedSsml(e){for(var t=e.ownerDocument.body,n=e;n!=t&&null!=n;){if(null!=this.checkForSsmlAttribute(n))return!0;n=n.parentNode}return!1}insertInWrappingSsml(e,t,n){let r=n.ownerDocument.body,i=n,a=new M;for(;i!=r&&null!=i;)if(i=i.parentNode,null!=this.checkForSsmlAttribute(i)){let n=this.checkForSsmlAttribute(i);if(n.canContainContent()){let r=e[t];e[t]=n,n.setContents([r]);for(let s=t+1;s<e.length;s++){let t=e[s].getFirstNode();if(!a.checkIfElementInsideElement(t,i))break;r=e[s],n.addContent(r),e.splice(s,1),s--}}else{e[t]=n;for(let n=t+1;n<e.length;n++){let t=e[n].getFirstNode();if(!a.checkIfElementInsideElement(t,i))break;e.splice(n,1),n--}}}return!1}processTextToSpeakInSentenceObjectImpl(e){var t=new M;try{var n=new z(e);for(this.setupCheck(n),n.startRefPt=t.rw_getRefPt(n.leftNode,n.leftOffset),n.endRefPt=null;null!=n.currentNode;){if(this.checkIfTooLong(n))return;var r=n.currentNode;r.isMathJax?this.handleMathJax(n):t.isSpecialCase(r)?this.handleSpecialCase(n):1==r.nodeType?this.handleElement(n):3==r.nodeType?this.handleTextNode(n):this.moveToNextNode(n)}}catch(e){this.setValid(!1)}}handleTextNode(e){var t=new M,n=new _,r=e.currentNode,i=n.getTextFromNode(r);null==i&&(i="");var a=0;if(e.rightNode==r&&e.rightOffset>-1&&(i=i.substring(0,e.rightOffset)),e.leftNode==r&&e.leftOffset>0&&(i=i.substring(e.leftOffset),a=e.leftOffset),0==i.length&&0==e.storedText.length)e.startRefPt=null;else{null!=e.startRefPt&&0!=e.storedText.length||(e.startRefPt=t.rw_getRefPt(r,a));for(var s=t.rw_getBreakInCurrentWord(i);s>-1;){var o=e.storedText+i.substring(0,s+1);if(e.storedText=this.filterWordToSpeak(o),null!=e.endRefPt&&0==s||(e.endRefPt=t.rw_getRefPt(r,s+a)),t.extractProbablePostcode(o)?this.moveStoredTextToSSMLPostCodeObject(e):t.extractProbablePhoneNumbers(o)?this.moveStoredTextToSSMLPhoneNumberObject(e):this.moveStoredTextToWordObject(e),this.checkIfTooLong(e))return void(e.currentNode=null);a+=s+1,i=i.substring(s+1),e.startRefPt=t.rw_getRefPt(r,a),e.endRefPt=null,s=t.rw_getBreakInCurrentWord(i)}if(i.length>0&&(e.storedText+=i,e.endRefPt=t.rw_getRefPt(r,i.length+a),null==e.endRefPt&&(e.storedText="")),r==e.rightNode)return this.moveStoredTextToWordObject(e),void(e.currentNode=null)}this.moveToNextNode(e)}filterWordToSpeak(e){new M;return"*"==(new l).trim(e)&&(u.bMathsSymbols&&this.mathSymbolControl.mathsSymbolCheck("*")||(e="")),e}handleElement(e){let t=e.currentNode,n=this.checkForSsmlAttribute(t);if(null!=n){this.moveStoredTextToWordObject(e);let o=new _;if(t.childNodes.length>0){var r=new s(t.firstChild,0,!0),i=new s(t.lastChild,3==t.lastChild.nodeType?t.lastChild.nodeValue.length:-1,!1);let o=new I;o.setCaretRange(r,i);var a=new ie(o);this.processTextToSpeakInSentenceObjectImpl(a),a.isValid()&&(n.setContents(a.getContents()),e.sentenceObject.addContent(n))}else n instanceof ne&&e.sentenceObject.addContent(n);e.currentNode=o.getNextNodeIgnoreChildren(t,!1,e.rightNode)}else this.moveToNextNode(e)}moveToNextNode(e){new M;var t=new _,n=e.currentNode,r=t.getNextNode(n,!0,e.rightNode);null==r?(e.storedText=this.getTextOverRangeToSpeakAddFullStop(e.storedText),this.moveStoredTextToWordObject(e),e.currentNode=t.getNextNode(n,!1,e.rightNode)):e.currentNode=r}getTextOverRangeToSpeakAddFullStop(e){var t=new M,n=e.length;if(n>1&&". "==e.substr(n-2,2))return e;if(n>0&&"."==e.substr(n-1,1))return e+" ";var r=(new l).trimEndTH(e),i=r.charCodeAt(r.length-1);return t.rw_isLetter(i)||i>127?e+". ":e}handleMathJax(e){var t=new M,n=new _,r=new g;let i=e.currentNode;e.rawText=r.getRawTextFromMathJax(i),e.markedText=r.getSpeechWithBookmarksFromElement(i),e.mathML=r.getMathMLText(i),e.mathArrayObjects=r.mathObjectArray,e.jaxElem=r.getMathMLObject(i);var a=n.getFirstChildTextNode(i,!1),s=n.getLastChildTextNode(i,!1);e.startRefPt=t.rw_getRefPt(a,-1),e.endRefPt=t.rw_getRefPt(s,-1),e.ariaLabel=null;var o=t.getAriaRoleMathWithLabel(i);null!=o&&(e.ariaLabel=o),this.moveStoredTextToMathMLObject(e),this.setRawText(e.rawText),e.currentNode=n.getNextNodeIgnoreChildren(i,!1,e.rightNode)}handleSpecialCase(e){var t=new M,n=new _;this.moveStoredTextToWordObject(e);var r=e.currentNode;if(e.storedText=n.getTextFromNode(r),t.isSpecialCaseHighlightable(r)){var i=n.getFirstChildTextNode(r,!1),a=n.getLastChildTextNode(r,!1);null!=i&&null!=a?3==i.nodeType&&3==a.nodeType?(e.startRefPt=t.rw_getRefPt(i,0),e.endRefPt=t.rw_getRefPt(a,a.nodeValue.length)):(e.startRefPt=t.rw_getRefPt(i,-1),e.endRefPt=t.rw_getRefPt(a,-1)):(e.startRefPt=t.rw_getRefPt(r,-1),e.endRefPt=e.startRefPt)}else e.startRefPt=t.rw_getRefPt(r,-1),e.endRefPt=e.startRefPt;this.moveStoredTextToWordObject(e),e.currentNode=n.getNextNodeIgnoreChildren(r,!1,e.rightNode)}checkForQuestionMark(e){if(e.indexOf("?")>-1)for(var t=e.indexOf("?");t>-1;){var n,r;n=(n=t-1)<0?0:n,r=(r=t+2)>e.length?e.length:r;var i=e.substring(n,r);"?"==(i=i.trim())&&(e=e.substr(0,t)+" "+e.substr(t+1)),t=e.indexOf("?",t+1)}return e}checkForEllipsis(e){var t=e.isOverridingText()?e.getPronunciation():e.getWord();if(1==(t=t.trim()).length&&"8230"==t.charCodeAt()){var n=new ne(e.currentNode,616);n.setRange(e.m_range),e=n}return e}moveStoredTextToMathMLObject(e){if((new M).rw_isWordSpeakable(e.markedText,this.mathSymbolControl)&&null!=e.startRefPt&&null!=e.endRefPt){var t=new Y(new N(e.body,e.startRefPt,e.endRefPt),e.rawText,e.markedText,e.mathML,e.currentNode.id,e.mathArrayObjects,e.ariaLabel,e.jaxElem,e.currentNode);e.sentenceObject.addContent(t)}this.math=!0,this.clearState(e)}moveStoredTextToWordObject(e){if((new M).rw_isWordSpeakable(e.storedText,this.mathSymbolControl)&&null!=e.startRefPt&&null!=e.endRefPt){var t;if(1==e.sentenceObject.m_strRawText.length&&(e.storedText.charCodeAt()>=65&&e.storedText.charCodeAt()<=90||e.storedText.charCodeAt()>=97&&e.storedText.charCodeAt()<=122)){t=new ee(e.currentNode,"spell");var n=new $(new N(e.body,e.startRefPt,e.endRefPt),e.storedText);n.setPronunciation(e.storedText.toLowerCase()),t.addContent(n)}else t=new $(new N(e.body,e.startRefPt,e.endRefPt),e.storedText);this.mathSymbolControl&&this.mathSymbolControl.mathsSymbolCheck(e.storedText)&&t.setPronunciation(this.mathSymbolControl.mathsSymbolReplacement(e.storedText));var r=this.checkForQuestionMark(e.storedText);if(r!=e.storedText&&t.setPronunciation(r),t.m_type==t.Types.WORD){var i=this.checkForEllipsis(t);t!=i&&(t=i)}e.sentenceObject.addContent(t)}this.clearState(e)}moveStoredTextToSSMLPostCodeObject(e){if((new M).rw_isWordSpeakable(e.storedText,this.mathSymbolControl)&&null!=e.startRefPt&&null!=e.endRefPt){var t=new $(new N(e.body,e.startRefPt,e.endRefPt),e.storedText),n=new ee(e.currentNode,"zip");n.setRange(new N(e.body,e.startRefPt,e.endRefPt)),n.addContent(t),e.sentenceObject.addContent(n)}this.clearState(e)}moveStoredTextToSSMLPhoneNumberObject(e){if((new M).rw_isWordSpeakable(e.storedText,this.mathSymbolControl)&&null!=e.startRefPt&&null!=e.endRefPt){var t=new $(new N(e.body,e.startRefPt,e.endRefPt),e.storedText),n=new ee(e.currentNode,"phone");n.setRange(new N(e.body,e.startRefPt,e.endRefPt)),n.addContent(t),e.sentenceObject.addContent(n)}this.clearState(e)}clearState(e){e.startRefPt=null,e.endRefPt=null,e.storedText=""}checkIfTooLong(e){return e.sentenceObject.getWordCount()>500}setupCheck(e){var t=new M,n=new _;1==e.leftNode.nodeType&&(t.isSpecialCase(e.leftNode)||null!=this.checkForSsmlAttribute(e.leftNode)||(e.leftNode=n.getNextNodeAllowMoveToChild(e.currentNode,!1,e.rightNode),e.leftOffset=0))}checkForSsmlAttribute(e){if(1==e.nodeType){let t=this.checkForSsmlNoNamespace(e);if(null!=t)return t;if(t=this.checkForSsmlNamespace(e),null!=t)return t}return null}checkForSsmlNamespace(e){let t=e.ownerDocument.body.parentNode,n=new h;if(n.rw_getAttribute(t,"xmlns:ssml")){let r=n.rw_getAttribute(t,this.SSML_NAMESPACE+":"+this.SSMS_ATTRIBUTES.ALPHABET);if(n.rw_getAttribute(e,this.SSML_NAMESPACE+":"+this.SSMS_ATTRIBUTES.PH)){let t=n.rw_getAttribute(e,this.SSML_NAMESPACE+":"+this.SSMS_ATTRIBUTES.ALPHABET),i=n.rw_getAttribute(e,this.SSML_NAMESPACE+":"+this.SSMS_ATTRIBUTES.PH);if(null==t&&(t=r),null!=t&&null!=i)return new Z(e,t,i)}if(n.rw_getAttribute(e,this.SSML_NAMESPACE+":"+this.SSMS_ATTRIBUTES.ALIAS)){let t=n.rw_getAttribute(e,this.SSML_NAMESPACE+":"+this.SSMS_ATTRIBUTES.ALIAS);if(null!=t)return new Q(e,t)}if(n.rw_getAttribute(e,this.SSML_NAMESPACE+":"+this.SSMS_ATTRIBUTES.INTERPRETAS)){let t=n.rw_getAttribute(e,this.SSML_NAMESPACE+":"+this.SSMS_ATTRIBUTES.INTERPRETAS),r=n.rw_getAttribute(e,this.SSML_NAMESPACE+":"+this.SSMS_ATTRIBUTES.FORMAT);if(null!=t)return new ee(e,t,r)}if(n.rw_getAttribute(e,this.SSML_NAMESPACE+":"+this.SSMS_TYPES.EMPHASIS)){let t=n.rw_getAttribute(e,this.SSML_NAMESPACE+":"+this.SSMS_ATTRIBUTES.LEVEL);if(null!=t)return new te(e,t)}if(n.rw_getAttribute(e,this.SSML_NAMESPACE+":"+this.SSMS_TYPES.BREAK)){let t=n.rw_getAttribute(e,this.SSML_NAMESPACE+":"+this.SSMS_ATTRIBUTES.TIME),r=n.rw_getAttribute(e,this.SSML_NAMESPACE+":"+this.SSMS_ATTRIBUTES.STRENGTH);if(null!=t)return new ne(e,t,r)}if(n.rw_getAttribute(e,this.SSML_NAMESPACE+":"+this.SSMS_TYPES.PROSODY)){let t=n.rw_getAttribute(e,this.SSML_NAMESPACE+":"+this.SSMS_ATTRIBUTES.PITCH),r=n.rw_getAttribute(e,this.SSML_NAMESPACE+":"+this.SSMS_ATTRIBUTES.RATE),i=n.rw_getAttribute(e,this.SSML_NAMESPACE+":"+this.SSMS_ATTRIBUTES.VOLUME);if(null!=strTime)return new re(e,t,r,i)}}return null}checkForSsmlNoNamespace(e){let t=new h;if(t.rw_getAttribute(e,this.SSML_NAMESPACE)){let n=t.rw_getAttribute(e,this.SSML_NAMESPACE);if(null!=n&&"sub"!=n.toLowerCase()){if(n.indexOf('ph":"')>0){let e=n.substring(n.indexOf('ph":"')+5);e=e.substring(0,e.indexOf('",')),n=n.replace(e,encodeURIComponent(e))}n=JSON.parse(n);let t=new Array;for(let e in n)t.push(e);for(let r=t.length-1;r>=0;r--){let i=t[r];if(i==this.SSMS_TYPES.PHONEME){let t="ipa";null!==n[i][this.SSMS_ATTRIBUTES.ALPHABET]&&(t=n[i][this.SSMS_ATTRIBUTES.ALPHABET]);let r=new l;return new Z(e,t,r.encodeForXML(decodeURIComponent(n[i][this.SSMS_ATTRIBUTES.PH])))}if(i==this.SSMS_TYPES.SUB&&n[i][this.SSMS_ATTRIBUTES.ALIAS])return new Q(e,n[i][this.SSMS_ATTRIBUTES.ALIAS]);if(i==this.SSMS_TYPES.SAYAS&&n[i][this.SSMS_ATTRIBUTES.INTERPRETAS])return new ee(e,n[i][this.SSMS_ATTRIBUTES.INTERPRETAS],n[i][this.SSMS_ATTRIBUTES.FORMAT]);if(i==this.SSMS_TYPES.EMPHASIS)return new te(e,n[i][this.SSMS_ATTRIBUTES.LEVEL]);if(i==this.SSMS_TYPES.BREAK)return new ne(e,n[i][this.SSMS_ATTRIBUTES.TIME],n[i][this.SSMS_ATTRIBUTES.STRENGTH]);if(i==this.SSMS_TYPES.PROSODY)return new re(e,n[i][this.SSMS_ATTRIBUTES.PITCH],n[i][this.SSMS_ATTRIBUTES.RATE],n[i][this.SSMS_ATTRIBUTES.VOLUME])}}else if("sub"==n.toLowerCase()&&t.rw_getAttribute(e,this.SSMS_ATTRIBUTES.ALIAS))return new Q(e,t.rw_getAttribute(e,this.SSMS_ATTRIBUTES.ALIAS));return null}}handleLinkToAnnounceAsWord(e){let t=e.getContents(),n=t.length,r=!1;for(let e=0;e<n;e++){let n=t[e];if(n.getType()==n.Types.WORD){let e=n.isOverridingText()?n.getPronunciation():n.getWord();"a"!=n.m_range.getAsRange().startContainer.parentNode.tagName.toLowerCase()||r||(n.setPronunciation(u.strAnnounceLinksAsWords+": "+e),r=!0)}}}}class ae extends q{constructor(){super(3),this.m_bBatch=!1,this.inlineImages=u.inlineImages,this.sentenceNo=0}setSentences(e){this.setContents(e)}setInlineImages(e){this.inlineImages=e}getSentences(){return this.getContents()}setBatch(e){this.m_bBatch=e}isBatch(){return this.m_bBatch}setMathSymbolControl(e,t){this.mathSymbolControl=e,this.mathWithContext=t}getNextSentence(e){this.sentenceNo++;var t=this.getSentences();if(this.sentenceNo<t.length)return 0==t[this.sentenceNo].getWords().length||t[this.sentenceNo].isImage()&&!this.inlineImages?this.getNextSentence(e):t[this.sentenceNo];if(e&&null!=t[t.length-1]){var n=t[t.length-1];let o;if(n.allowContinuous){if(n.jumpId){let e=new L;this.processRange(e.getElementRangeById(n.jumpId),!1),o=this.getSentences()}else{var r,i=n.getCaretRange();n.m_range.refresh(),r=n.math?n.m_caretRange:new I(n.m_range.body,n.m_range.startRef.path,n.m_range.startRef.offset,n.m_range.endRef.path,n.m_range.endRef.offset);var a=new A;i=a.getSentenceFromPoint(r.leftCaret);if(this.checkRange(i)){var s=a.getNextSentence(i,null,this.mathSymbolControl);o=this.processSentence(s)}}return null==o||void 0===o||0==o.length?null:(this.setSentences(...o),this.sentenceNo=0,0==o[this.sentenceNo].getWords().length||o[this.sentenceNo].isImage()&&!this.inlineImages?this.getNextSentence(e):o[0])}}return null}getPreviousSentence(){let e=this.sentenceNo;this.sentenceNo--;var t=this.getSentences();if(this.sentenceNo>-1&&this.sentenceNo<t.length)return 0==t[this.sentenceNo].getWords().length||t[this.sentenceNo].isImage()&&!this.inlineImages?this.getPreviousSentence():t[this.sentenceNo];if(null!=t[e]){var n=t[e];let o;var r,i=n.getCaretRange();n.m_range.refresh(),r=n.math?n.m_caretRange:new I(n.m_range.body,n.m_range.startRef.path,n.m_range.startRef.offset,n.m_range.endRef.path,n.m_range.endRef.offset);var a=new A;i=a.getSentenceFromPoint(r.leftCaret);if(this.checkRange(i)){var s=a.getPreviousSentence(i,null,this.mathSymbolControl);o=this.processSentence(s)}return null==o||void 0===o||0==o.length?null:(this.setSentences(...o),this.sentenceNo=0,0==o[this.sentenceNo].getWords().length||o[this.sentenceNo].isImage()&&!this.inlineImages?this.getPreviousSentence():o[0])}return null}getCurrentSentence(){var e=this.getSentences();return this.sentenceNo<e.length?e[this.sentenceNo]:e[e.length-1]}getFirstSentence(){return this.sentenceNo=0,this.getSentences().length>0?this.getSentences()[0]:null}processRange(e,t){this.setSentences([]),this.sentenceNo=0;var n=new I(e.body,e.startRef.path,e.startRef.offset,e.endRef.path,e.endRef.offset);if(!e.startCaret.node.tagName||"textarea"!=e.startCaret.node.tagName.toLowerCase()&&"input"!=e.startCaret.node.tagName.toLowerCase()){var r=new A;this.mathSymbolControl&&r.setMathSymbolControl(this.mathSymbolControl,this.mathWithContext);var i=r.getSentenceFromPoint(n.leftCaret),a=new Array,s=this.processSentence(i);if(a.push(...s),!t){var o=!0;do{var l=r.getNextSentence(i,n.rightCaret.node,this.mathSymbolControl);null!=l&&(l.leftCaret.node!=n.rightCaret.node||l.leftCaret.offset<n.rightCaret.offset)?(null!=(s=this.processSentence(l))&&a.push(...s),i=l):o=!1}while(o);1==a.length&&i.rightCaret.offset>n.rightCaret.offset&&n.rightCaret.offset!=n.leftCaret.offset&&(a=this.processSentence(n))}this.setSentences(a)}else{let t=new ie(n);this.mathSymbolControl&&t.setMathSymbolControl(this.mathSymbolControl,this.mathWithContext);let r="";r=e.startCaret.node.selectionStart!=e.startCaret.node.selectionEnd?e.startCaret.node.value.substring(e.startCaret.node.selectionStart,e.startCaret.node.selectionEnd):e.startCaret.node.value;var h=new $(new N(e.body,e.startRef.offset,e.endRef.offset),r);t.setContents(h),t.m_strRawText=r,t.allowContinuous=!1,this.setSentences(t)}this.checkForCommands()}processSentence(e){try{this.checkRange(e)||this.setValid(!1),this.setSentences([]);var t=new ie(e);this.mathSymbolControl&&t.setMathSymbolControl(this.mathSymbolControl,this.mathWithContext);var n=this.splitSentenceByLanguage(t);0==n.length&&this.setValid(!1),this.setSentences(n);for(var r=n.length,i=0;i<r;i++){let e=this.getSentences()[i];e.isMathML()||e.processTextToSpeakInSentenceObject(e)}return n}catch(e){this.setValid(!1)}return null}splitSentenceByLanguage(e){var t=e.getCaretRange(),n=t.leftCaret,r=t.rightCaret,i=!1;if(!u.voiceFromLangFlag)for(var a,s,o=n.node;null!=o;){if(1==o.nodeType){if(a=o.getAttribute("id"),null!=(s=o.getAttribute("class"))&&s.indexOf("contentTranslate")>-1){i=!0;break}if(null!=a&&a.length>0){if("rwpopuptrans"==a){i=!0;break}if(0!=a.indexOf("rwMeaning")&&0!=a.indexOf("rwHeadWord"))break}}o=o.parentNode}if(u.voiceFromLangFlag||i){var l=new _,h=l.getLangAttr(n.node);null!=h&&e.setLangTag(h);var d=l.checkForVoiceChange(n.node,r.node,h);if(null!=d){var g=d.clone();g.forwardBias=!0;var c=new M;g=c.moveCaret(g,0,!1);var m=new I;m.setCaretRange(n,d);var p=new I;p.setCaretRange(g,r);var f=new ie(p);e.setCaretRange(m);var S=m.toString();if(0!=S.length&&c.rw_isWordSpeakable(S,this.mathSymbolControl)){var v=[];return v.push(e),v=v.concat(this.splitSentenceByLanguage(f))}return this.splitSentenceByLanguage(f)}}return[e]}checkRange(e){var t=new M;if(null==e||null==e.leftCaret||null==e.rightCaret||null==e.leftCaret.node||null==e.rightCaret.node)return!1;var n=e.leftCaret,r=e.rightCaret,i=t.checkForSpecialParent(n.node);return null!=i&&(n.node=i,n.setSpecialCase(!0),e.leftCaret=n),null!=(i=t.checkForSpecialParent(r.node))&&(r.node=i,r.setSpecialCase(!0),e.rightCaret=r),!0}checkForCommands(){if(u.useCommands){var e,t,n=this.getSentences(),r=new M,i=new _;for(t=0;t<n.length;t++){var a=(e=n[t]).getCaretRange().leftCaret,s=e.getCaretRange().rightCaret,o=i.findCommandNode(a.node),l=i.checkForCommandChange(a.node,s.node,o);if(null!=l){var h=e.clone(),d=e.clone(),g=new I(a,l),c=l.clone();c.forwardBias=!0,c=r.moveCaret(c,0,!1);var m=new I(c,s);h.setCaretRange(g),d.setCaretRange(m),n.splice(t,1,h,d)}}this.setSentences(n)}}findCommandsInRange(e){var t=new M;let n=new _;for(var r=t.getListOfNodes(e.leftCaret,e.rightCaret),i=r.length,a=null,s=0;s<i;s++)if(null!=(a=n.findCommands(r[s]))&&a.length>0){for(var o=0;o<a.length;o++){var l=a[o],h=l.command;let t=l.element;t==r[s]||h!=l.CMD_JUMP&&h!=l.CMD_EXECAFTER&&h!=l.CMD_STOPAFTER?t==r[s]||h!=l.CMD_JUMPBACK&&h!=l.CMD_EXEC||0==this.checkIsFirstSentenceInCommandElement(t,e)&&(a.splice(o,1),o--):0==this.checkIsLastSentenceInCommandElement(t,e)&&(a.splice(o,1),o--)}return a}return[]}actOnCommand(e){if(u.useCommands&&e){var t=e.getCaretRange();if(null!=t){var n=this.findCommandsInRange(t);if(n.length>0){for(var r=!1,a=0;a<n.length;a++){var s=n[a];s.command==s.CMD_STOP?(r=!0,i.publish("speechStopped",[])):s.command==s.CMD_STOPAFTER?e.allowContinuous=!1:s.command==s.CMD_JUMP?e.jumpId=s.param:s.command==s.CMD_VOICE?i.publish("setTempVoice",s.param):s.command==s.CMD_PAGEID?i.publish("setPageID",s.param):s.command==s.CMD_BOOKID&&i.publish("setBookID",s.param)}r&&(e.valid=!1)}}}}checkIsFirstSentenceInCommandElement(e,t){return null==this.getPreviousSentence(t,e,this.mathSymbolControl)}checkIsLastSentenceInCommandElement(e,t){return void 0===t&&(t=null),null==(new _).getNextNodeIgnoreChildren(t,!1,e)}}class se{constructor(){this.strCharacterHash=String.fromCharCode(45),this.strCharacterEnDash=String.fromCharCode(8211),this.strCharacterEmDash=String.fromCharCode(8212),this.strCharacterMinus=String.fromCharCode(8722),this.strCharacterDivide=String.fromCharCode(247),this.strCharacterMultiplication=String.fromCharCode(215),this.strCharacterBullet=String.fromCharCode(8226),this.mathsSymbolArray=new Array,this.mathsMapping=new Object,this.mathsData="-:minus;"+this.strCharacterEnDash+":' ';"+this.strCharacterMinus+":minus;"+this.strCharacterHash+":' ';+:plus;"+this.strCharacterDivide+":divided by;<:less than;>:greater than;=:equals;^:raised to the power of;<=:less than or equal to;>=:greater than or equal to;"+this.strCharacterMultiplication+":times;/:' ';*:' ';"+this.strCharacterEmDash+":' ';"+this.strCharacterBullet+":' ';",this.mathsMappingSetup(this.mathsData)}setUsingMath(e){u.bMathsSymbols=e}setSymbolText(e){null!=e&&"string"==typeof e&&e.length>0&&(u.bMathsSymbols=!0,this.mathsSymbolArray=new Array,this.mathsMapping=new Object,this.mathsMappingSetup(this.mathsData),this.mathsMappingSetup(e))}mathsSymbolCheck(e){return this.mathsSymbolArray.indexOf(e.replace(/[.,]\s*$/,"").trimTH())>-1}mathsMappingSetup(e){let t,n,r,i,a,s;for(n=0,r=e.indexOf(":"),i=e.indexOf(";",r);n>-1&&r>-1&&(a=e.substring(n,r),s=i>-1?e.substring(r+1,i):e.substring(r+1),0==s.length?(t=this.mathsSymbolArray.indexOf(a),t>-1&&(this.mathsSymbolArray.splice(t,1),delete this.mathsMapping[a])):(t=this.mathsSymbolArray.indexOf(a),t>-1||this.mathsSymbolArray.push(a),this.mathsMapping[a]=s),i>-1);)n=i+1,r=e.indexOf(":",n),i=e.indexOf(";",r)}mathsSymbolReplacement(e){var t,n,r,i=e.length,a=e,s=this.trimTextToMathsSymbols(e);if(null==s)return e;for(t=i-1;t>=0;t--)if(32!=(r=s.charCodeAt(t))){for(n=t;32!=r&&t>=0;)--t,r=s.charCodeAt(t);var o=s.substring(t+1,n+1);null!=this.mathsMapping[o]&&(a=a.substring(0,t+1)+" "+this.mathsMapping[o]+" "+a.substr(n+1))}return a}trimTextToMathsSymbols(e){var t,n,r=!1,i=e.length,a="";for(t=0;t<i;t++){n=e.charCodeAt(t);var s=new l;32==n||44==n||46==n||s.rw_isTextChar(n)||s.rw_isWhiteSpace(e.charAt(t))?a+=" ":(a+=e.charAt(t),r=!0)}return r?a:null}mathsSymbolReplacementSentenceCheck(e){var t,n,r=!1,i=e.split(" "),a=i.length;for(n=0;n<a;n++)(t=this.mathsSymbolReplacement(i[n]))!=i[n]&&(i[n]=t,r=!0);if(r){var s="";for(n=0;n<a-1;n++)s+=i[n],s+=" ";return s+=i[a-1]}return e}mathsSymbolReplacementWordList(e){var t=!1;if(u.bMathsSymbols&&null!=e){var n,r=e.length;for(n=0;n<r;n++){var i;(i=this.mathsSymbolReplacement(e[n]))!=e[n]&&(e[n]=i,t=!0)}}return t}mathsSymbolReplacementWithContext(e,t,n,r){let i,a,s,o=e.length,h=e,u=this.trimTextToMathsSymbols(e);if(null==u)return e;var d=new l;for(i=o-1;i>=0;i--)if(s=u.charCodeAt(i),32!=s){a=i;let r=!1;for("(){}[]".indexOf(u.charAt(i))>-1&&(r=!0),--i,s=u.charCodeAt(i);32!=s&&i>=0&&!r;)"(){}[]".indexOf(u.charAt(i))>-1?r=!0:(--i,s=u.charCodeAt(i));let o=u.substring(i+1,a+1);if(o==this.strCharacterHash||o==this.strCharacterEnDash||o==this.strCharacterEmDash){if(o==this.strCharacterEmDash)h=h.substring(0,i+1)+" "+h.substr(a+1);else{var g=e.substring(a-1,a),c=e.substring(a-2,a-1),m=(e.substring(a-3,a-2),e.substring(a+1,a+2)),p=e.substring(a+2,a+3);e.substring(a+3,a+4);if("string"==typeof t){var f=t.length+a;a<1&&f>0&&(g=t.substring(f-1,f)),a<2&&f>1&&(c=t.substring(f-2,f-1)),a<3&&f>2&&t.substring(f-3,f-2)}if("string"==typeof n){let t=e.length-(a+1),r=n.length;t<1&&r>0&&(m=n.substring(0,1)),t<2&&r>1-t&&(p=n.substring(1-t,2-t)),t<3&&r>2-t&&n.substring(2-t,3-t)}h=""!=g&&" "!=g&&"("!=g||!d.isNumber(m)?d.isNumber(g)&&d.isNumber(m)?h.substring(0,i+1)+" to "+h.substr(a+1):d.isAlpha(g)&&d.isAlpha(m)?o==this.strCharacterEnDash?h.substring(0,i+1)+" to "+h.substr(a+1):h.substring(0,i+1)+" "+h.substr(a+1):" "==g&&" "==m&&d.isNumber(c)&&d.isNumber(p)?h.substring(0,i+1)+" minus "+h.substr(a+1):(d.isNumber(g)&&" "==m&&d.isNumber(p),h.substring(0,i+1)+" "+h.substr(a+1)):h.substring(0,i+1)+" negative "+h.substr(a+1)}o=""}null!=this.mathsMapping[o]&&(h=h.substring(0,i+1)+" "+this.mathsMapping[o]+" "+h.substr(a+1)),r&&++i}return h}}class oe extends F{constructor(){super(),this.event={},this.timerEvent=null,this.callback=null,this.caretRange=null,i.subscribe("pauseHover",this.clearTimer.bind(this)),document.addEventListener("mouseout",()=>this.clearTimer()),this.sentence,this.readRange=null,this.orgElement=null,this.targetElement=null}mouseMoved(e,t){clearTimeout(this.timerEvent),this.event=e,null!=t&&"function"==typeof t&&(this.callback=t),this.timerEvent=setTimeout(()=>this.startSpeech(),1e3)}clearTimer(){clearTimeout(this.timerEvent)}clearHoverSpeak(){clearTimeout(this.timerEvent),this.sentence}startSpeech(){var e;if(this.targetElement=this.event.target,null!=this.targetElement&&("html"==this.targetElement.tagName.toLowerCase()||"body"==this.targetElement.tagName.toLowerCase()))return null;var t=new M;if(t.isIgnored(this.targetElement)||t.isAriaHidden(this.targetElement)&&!this.targetElement.parentNode.isMathJax)return null;if(null==this.targetElement||"img"!=this.targetElement.tagName.toLowerCase()&&"textarea"!=this.targetElement.tagName.toLowerCase()&&"input"!=this.targetElement.tagName.toLowerCase()){let t=this.targetElement.getRootNode();if(t.mode&&"open"==t.mode)e=new R(this.targetElement,0,this.targetElement,0);else if(void 0!==document.caretRangeFromPoint){var n=this.event.target.ownerDocument.caretRangeFromPoint(this.event.clientX,this.event.clientY);e=new R(n.startContainer,n.startOffset,n.endContainer,n.endOffset)}else if(void 0!==document.caretPositionFromPoint){n=this.event.target.ownerDocument.caretPositionFromPoint(this.event.clientX,this.event.clientY);e=new R(n.offsetNode,n.offset,n.offsetNode,n.offset)}else{if(this.orgElement=this.targetElement.cloneNode(!0),"TEXTHELP-WRAPPER-SPAN"!=this.targetElement.tagName&&"TEXTHELP-HIGHLIGHT-SPAN"!=this.targetElement.tagName)(new A).tagSentences(this.targetElement);var r=this.targetElement.ownerDocument.elementFromPoint(this.event.clientX,this.event.clientY);e=new R(r,0,r,0)}}else e=new R(this.targetElement,0,this.targetElement,0);var i=new ae;u.bMathsSymbols&&(this.mathSymbolControl=new se,this.mathWithContext=!1,u.mathSymbolMapping&&this.mathSymbolControl.mathsMappingSetup(u.mathSymbolMapping),u.mathWithContext&&(this.mathWithContext=!0),i.setMathSymbolControl(this.mathSymbolControl,this.mathWithContext)),i.processRange(e,!0);var a=i.getFirstSentence(),s="",o="";this.sentence&&this.sentence.getRawText()&&(s=this.sentence.getRawText()),a.getRawText()&&(o=a.getRawText()),null!=this.sentence&&-1!=s.indexOf(o)||(this.sentence=a,this.readRange=e,this.callback())}getSelectionRange(){return this.readRange}clearHoverTags(){this.sentence=null}setCallback(e){this.callback=e}}class le extends G{constructor(){super(),this.g_aHighlightObjects=new Array,this.g_bStoreHighlightText=!0}fetchWords(){for(var e=new Array,t=new Array,n=this.g_aHighlightObjects.length,r=0;r<n;r++){-1==this.g_aHighlightObjects[r].range.toString().trimTH().indexOf(" ")?t.push(this.g_aHighlightObjects.slice(r,r+1).pop()):this.m_bSentenceSelection=!0}t.sort(this.sortBySFF);for(var i,a=t.length,s=0;s<a;s++){i=(i=t[s].highlighttext.toString()).trim();var o=".,?!";o=o.replace(/[\[\](){}?*+\^$\\.|\-]/g,"\\$&"),i=i.replace(new RegExp("^["+o+"]+|["+o+"]+$","g"),""),e.push(i)}return e}studySkillsCollateForPosition(e){for(var t,n=new Array,r=this.g_aHighlightObjects.length,i=new l,a=0;a<r;a++){var s=this.g_aHighlightObjects[a].colour;(t=this.g_aHighlightObjects[a].highlighttext).length>0&&e.includes(s)&&(t=i.rw_filterForHtml(t),n.push({text:t,color:s}))}return n}studySkillsCollateForColour(e){for(var t=new M,n=new Array,r=this.g_aHighlightObjects.length,i=0;i<r;i++){this.g_aHighlightObjects[i].colour==e&&n.push(this.g_aHighlightObjects.slice(i,i+1).pop())}d?n.sort(this.sortBy):n.sort(this.sortBySFF);var a,s=n.length,o=new l,h=new Array;for(i=0;i<s;i++){var u,d=!1;if(d){var g=n.slice(i,i+1).pop();u=t.rw_getTextRangeAsTHRange(g.range.parentElement().ownerDocument.body,g.range).range.rw_getTHCaretRangeFromTHRange()}else u=n[i].range.rw_getTHCaretRangeFromTHDomRange();(a=u.getTextOverCaretRange()).length>0&&(a=o.rw_filterForHtml(a),h.push({color:e,text:a}))}return h}sortBy(e,t){try{return e.compareEndPoints("EndToEnd",t)}catch(e){return 0}}sortBySFF(e,t){try{if(e.equals(t))return 0;e.refresh(),t.refresh();var n=e.getEndAsRange(),r=t.getEndAsRange();return n.compareBoundaryPoints("END_TO_END",r)}catch(e){return 0}}studySkillsHTMLHighlightRange(e,t){var n=new M;try{if(null==t||null==t.range||t.range instanceof String)return!1;var r=t.range;if(null==(r=this.rw_checkTHRangeForValidHighlight(r)))return!1;n.rw_collapseSelection(),this.studySkillsHTMLHighlightRangeImpl(r,e);var i=SpeechStream.analytics;return i.report(i.categories.HIGHLIGHT,e),!0}catch(e){return!1}}rw_convertToPermCaretPosition(e){let t=new M,n=new _;var r,i=e.node.ownerDocument.body,a=e.node,s=e.offset;s+=t.rw_getNodeOffset(a);for(var o=a.parentNode,l=o.getAttribute("data-ss-id");(null==l||0==l.length)&&o!=i;)s+=t.rw_getNodeOffset(o),l=(o=o.parentNode).getAttribute("data-ss-id");if(null!=l&&l.length>0){if(r="idx"+l,null!=o&&null!=o.firstChild){var h=n.getFirstChildTextNode(o,!1);if(3==h.nodeType){for(var u=0,d=h.nodeValue;d.length>u&&32==d.charCodeAt(u);)++u;s-=u}}}else{var g=t.rw_getRefPt(e.node,e.offset);r=g.path,s=g.offset}return{pos:r,offset:s}}rw_getStudySkillsPositionDataFromRange(e,t){let n=new M;var r={};r.colour=t;var i,a,s,o=e;o.refresh(),this.g_bStoreHighlightText&&(s=o.toString());var l=o.startCaret.node,h=o.startCaret.offset,u=o.endCaret.node,d=o.endCaret.offset;if(3==l.nodeType&&0==l.nodeValue.trimTH().length){for(l=n.getNextNode(l,!1,u),h=0;null!=l&&3==l.nodeType&&0==l.nodeValue.trimTH().length;)l=n.getNextNode(l,!1,u);null==l&&(l=u)}var g=n.rw_getRefPt(l,h);if(3==u.nodeType&&0==u.nodeValue.trimTH().length){for(d=0;l!=u&&null!=u&&3==u.nodeType&&0==u.nodeValue.trimTH().length;)u=n.getPreviousNode(u,!1,l);null!=u&&3==u.nodeType&&u.nodeValue.trimTH().length>0&&(d=u.nodeValue.length)}if(a=n.rw_getRefPt(u,d),null!=(i=g)&&null!=a){var c=new I;c.getCaretPairFromDomPosition(o.body,i.path,i.offset,a.path,a.offset);var m=c.leftCaret,p=c.rightCaret,f=this.rw_convertToPermCaretPosition(m),S=this.rw_convertToPermCaretPosition(p);r.startRefId=f.pos,r.startRefOffset=f.offset,r.endRefId=S.pos,r.endRefOffest=S.offset,r.range=e,this.g_bStoreHighlightText&&(s=n.rw_replaceAll(s,"|","&#124;"),r.highlighttext=s),r.equals=function(e){return e.colour==this.colour&&e.startRefId==this.startRefId&&e.startRefOffset==this.startRefOffset&&e.endRefId==this.endRefId&&e.endRefOffest==this.endRefOffest&&e.highlighttext==this.highlighttext}}return r}studySkillsHTMLHighlightRangeImpl(e,t){try{var n=new M,r=!1,i=null,a=null,s=!0;if(null==e||e instanceof String)return;var o=0,l=!1;if(!e.toString)return;if(null==e||null==e.toString()||""==e.toString())return;for(var h=0;h<this.g_aHighlightObjects.length;h++){var u=this.g_aHighlightObjects[h].range,d=this.g_aHighlightObjects[h],g=null,c=this.g_aHighlightObjects[h].renderedInView;try{g=n.rw_getElementQuerySelector("[data-ss-id="+d.startRefId.substr(3)+"]")||null}catch(e){}if(null!=g&&c&&e.body.ownerDocument==u.body.ownerDocument){var m=e.compareRange(u);switch(m){case-1:window.status="Error occurred when trying to add a highlight.";break;case 0:case 3:u.refresh(),this.rw_removeHighlight(this.getListOfHighlightableNodes(u.startCaret,u.endCaret)),this.g_aHighlightObjects.splice(h,1),--h,e.refresh(),l=!0;break;case 4:case 7:case 8:this.g_aHighlightObjects[h].colour==t?s=!1:(this.case1SFF(h,e,m),++h,l=!0);break;case 6:this.case2SFF(h,e),l=!0;break;case 5:this.case3SFF(h,e),l=!0}}l&&++o<100&&(h=-1)}if(s){if(e.execCommand)this.studySkillsClearRangeIE(e),this.rw_ieSpecificCallToSetHighlight(e,t);else{var p=e.startCaret,f=e.endCaret;this.rw_setHighlight(p.node,p.offset,f.node,f.offset,t)}let n=this.rw_getStudySkillsPositionDataFromRange(e,t),r=!0;this.g_aHighlightObjects.forEach(e=>{e.equals(n)&&(r=!1,e.renderedInView=!0)}),r&&(n.renderedInView=!0,this.g_aHighlightObjects.push(n)),e.toString()}return n.rw_collapseSelection(),r&&(i.style.display=a),!0}catch(e){return!1}}rw_setHighlight(e,t,n,r,i){var a=e,s=n,o=(new M,new _);try{var l=null;if(n==e)a=(l=this.rw_setNodeBackground(e,t,r,"ss",i)).node,s=l.node;else{a=(l=t>0?this.rw_setNodeBackground(e,t,e.nodeValue.length,"ss",i):this.rw_setNodeBackground(e,-1,-1,"ss",i)).node;for(var h=o.getNextTextNodeNoImg(l.node,!1,n,!0);null!=h;){if(h==n){s=h=(l=this.rw_setNodeBackground(h,0,r,"ss",i)).node;break}s=h=(l=this.rw_setNodeBackground(h,-1,-1,"ss",i)).node,h=o.getNextTextNodeNoImg(h,!1,n,!0)}}}catch(e){}return{start:a,end:s}}rw_ieSpecificCallToSetHighlight(e,t){"strikethrough"==t?e.execCommand("strikethrough",!1,null):e.execCommand("backcolor",!1,t)}studySkillsClearRangeIE(e){e.execCommand("backcolor",!1,"clear"),(g_nIcons&strike_icon)==strike_icon&&e.execCommand("RemoveFormat",!1,null)}rw_removeHighlight(e){var t=new M,n=new h;try{if(null==e||!(e instanceof Array)||0==e.length)return;for(var r=0;r<e.length;r++){var i=e[r];if(this.rw_checkNodeIsHighlightedText(i)){var a=i.parentNode;if(null!=i.nextSibling||null!=i.previousSibling){var s=t.allTextFromNodeTH(a);i=a.ownerDocument.createTextNode(s)}a.parentNode.replaceChild(i,a),i=t.mergeTextNodes(i),e[r]=i}else{var o=this.rw_getNestedNodeForHighlightedText(i);null!=o&&(n.rw_removeAttribute(o,"rwstate"),o.removeAttribute("style"))}}}catch(e){}}rw_getNestedNodeForHighlightedText(e){new M;var t=new h;if(3!=e.nodeType||null==e.parentNode||null==e.parentNode.parentNode)return null;var n=c,r=e.parentNode,i=t.rw_getAttribute(r,"rwstate");if(r.tagName.toLowerCase()!=n||null==i||"ss"!=i){if(null!=t.rw_getAttribute(r,"rwthgen")){var a=r;for(i="1";null!=i;){if(a=a.parentNode,"ss"==t.rw_getAttribute(a,"rwState")&&a.tagName.toLowerCase()==n)return a;i=t.rw_getAttribute(a,"rwthgen")}}return null}return r}rw_checkNodeIsHighlightedText(e){new M;var t=new h;if(null==e.parentNode||null==e.parentNode.parentNode)return!1;var n=e.parentNode,r=t.rw_getAttribute(n,"rwstate");return n.tagName.toLowerCase()==c&&null!=r&&"csp"!=r&&"sp"!=r||("thspell"==n.className||"thhom"==n.className||"thgrammar"==n.className)}rw_checkTHRangeForValidHighlight(e){var t=new M,n=new _,r=e.startCaret,i=e.endCaret,a=!1;if(t.isInvalidNode(r.node)){if(r.node==i.node)return;if(null==(o=n.getNextTextNodeNoImg(r.node,!1,i.node,!1))||t.isInvalidNode(o))return;r.node=o,r.offset=0,a=!0}var s=3!=r.node.nodeType||3==r.node.nodeType&&0==r.node.nodeValue.trimTH().length;if(s){for(a=!0;s;){if(r.node==i.node)return null;if(r.node=n.getNextTextNodeNoBlank(r.node,!1,i.node),null==r.node)return null;s=3!=r.node.nodeType||3==r.node.nodeType&&0==r.node.nodeValue.trimTH().length}r.offset=0}if(t.isInvalidNode(i.node)){if(r.node==i.node)return;var o;if(null==(o=n.getPreviousTextNodeNoImg(i.node,!1,r.node,!1))||t.isInvalidNode(o))return;i.node=o,i.offset=o.nodeValue.length,a=!0}if(s=3!=i.node.nodeType||3==i.node.nodeType&&0==i.node.nodeValue.trimTH().length){for(a=!0;s;){if(r.node==i.node)return null;if(i.node=n.getPreviousTextNodeNoImg(i.node,!1,r.node,!1),null==i.node)return null;s=3!=i.node.nodeType||3==i.node.nodeType&&0==i.node.nodeValue.trimTH().length}3==i.node.nodeType&&(i.offset=i.node.nodeValue.length)}return null==r.node||null==i.node?null:(a&&(e=new R(r.node,r.offset,i.node,i.offset)),e)}//*!
studySkillsClearHighlights(e,t){try{var n=null;if(null!=t&&null!=t.range&&(n=t.range,t.frame),null!=n&&n instanceof String){var r=!1;if(null!=r&&(r.selectionStart=0,r.selectionEnd=0),r=null,!e)return;n=null}if(null==n||e){if(!e)if(!!1)return;var i=this.g_aHighlightObjects;this.g_aHighlightObjects=new Array;for(var a=new M,s=0;s<i.length;s++){var o;(o=i[s].range).refresh();try{null!=a.rw_getElementQuerySelector("[data-ss-id="+i[s].startRefId.substr(3)+"]")&&this.rw_removeHighlight(this.getListOfHighlightableNodes(o.startCaret,o.endCaret))}catch(e){this.rw_removeHighlight(this.getListOfHighlightableNodes(o.startCaret,o.endCaret))}}}else{n.refresh();for(var l=0;l<this.g_aHighlightObjects.length;l++){var h=this.g_aHighlightObjects[l].range;if(n.body==h.body){var u=n.compareRange(h);switch(u){case-1:window.status="Error occurred when trying to remove a highlight.";break;case 0:case 3:h.refresh();try{null!=a.rw_getElementQuerySelector("[data-ss-id="+this.g_aHighlightObjects[l].startRefId.substr(3)+"]")&&this.rw_removeHighlight(this.getListOfHighlightableNodes(h.startCaret,h.endCaret))}catch(e){this.rw_removeHighlight(this.getListOfHighlightableNodes(h.startCaret,h.endCaret))}this.g_aHighlightObjects.splice(l,1),--l,n.refresh();break;case 4:case 7:case 8:this.case1SFF(l,n,u),++l;break;case 6:this.case2SFF(l,n);break;case 5:this.case3SFF(l,n)}}}}a.rw_collapseSelection()}catch(e){}}//*!
studySkillsHTMLRefreshRanges(){try{var e=null,t=!1,n=0;for(n=0;n<this.g_aHighlightObjects.length;n++){e=this.g_aHighlightObjects[n].range;try{null!=e.text&&""!=e.text||(e=null)}catch(t){e=null}null==e&&(this.g_aHighlightObjects.splice(n,1),t=!0,n--)}return t}catch(e){return!1}}case1SFF(e,t,n){var r=new M,i=this.g_aHighlightObjects[e].colour,a=this.g_aHighlightObjects[e].range;a.refresh();var s,o,l,h,u=a.startRef,d=t.startRef,g=t.endRef,c=a.endRef;try{null!=r.rw_getElementQuerySelector("[data-ss-id="+this.g_aHighlightObjects[e].startRefId.substr(3)+"]")&&this.rw_removeHighlight(this.getListOfHighlightableNodes(a.startCaret,a.endCaret))}catch(e){this.rw_removeHighlight(this.getListOfHighlightableNodes(a.startCaret,a.endCaret))}if(this.g_aHighlightObjects.splice(e,1),7!=n){var m=new I(t.body,u.path,u.offset,d.path,d.offset);s=m.leftCaret,o=m.rightCaret,l=this.rw_setHighlight(s.node,s.offset,o.node,o.offset,i),h=new R(l.start,0,l.end,l.end.nodeValue.length);let e=this.rw_getStudySkillsPositionDataFromRange(h,i),n=!0;this.g_aHighlightObjects.forEach(t=>{t.equals(e)&&(n=!1)}),n&&this.g_aHighlightObjects.push(e)}if(8!=n){s=(m=new I(t.body,g.path,g.offset,c.path,c.offset)).leftCaret,o=m.rightCaret,l=this.rw_setHighlight(s.node,s.offset,o.node,o.offset,i),h=new R(l.start,0,l.end,l.end.nodeValue.length);let e=this.rw_getStudySkillsPositionDataFromRange(h,i),n=!0;this.g_aHighlightObjects.forEach(t=>{t.equals(e)&&(n=!1)}),n&&this.g_aHighlightObjects.push(e)}t.refresh()}case2SFF(e,t){var n=new M,r=this.g_aHighlightObjects[e].colour,i=this.g_aHighlightObjects[e].range;i.refresh();var a=t.endRef,s=i.endRef;try{null!=n.rw_getElementQuerySelector("[data-ss-id="+this.g_aHighlightObjects[e].startRefId.substr(3)+"]")&&this.rw_removeHighlight(this.getListOfHighlightableNodes(i.startCaret,i.endCaret))}catch(e){this.rw_removeHighlight(this.getListOfHighlightableNodes(i.startCaret,i.endCaret))}this.g_aHighlightObjects.splice(e,1);var o=new I(t.body,a.path,a.offset,s.path,s.offset),l=o.leftCaret,h=o.rightCaret,u=this.rw_setHighlight(l.node,l.offset,h.node,h.offset,r),d=new R(u.start,0,u.end,u.end.nodeValue.length);let g=this.rw_getStudySkillsPositionDataFromRange(d,r),c=!0;this.g_aHighlightObjects.forEach(e=>{e.equals(g)&&(c=!1)}),c&&this.g_aHighlightObjects.push(g),t.refresh()}case3SFF(e,t){var n=new M,r=this.g_aHighlightObjects[e].colour,i=this.g_aHighlightObjects[e].range;i.refresh();var a=i.startRef,s=t.startRef;try{null!=n.rw_getElementQuerySelector("[data-ss-id="+this.g_aHighlightObjects[e].startRefId.substr(3)+"]")&&this.rw_removeHighlight(this.getListOfHighlightableNodes(i.startCaret,i.endCaret))}catch(e){this.rw_removeHighlight(this.getListOfHighlightableNodes(i.startCaret,i.endCaret))}this.g_aHighlightObjects.splice(e,1);var o=new I(t.body,a.path,a.offset,s.path,s.offset),l=o.leftCaret,h=o.rightCaret,u=this.rw_setHighlight(l.node,l.offset,h.node,h.offset,r),d=new R(u.start,0,u.end,u.end.nodeValue.length);let g=this.rw_getStudySkillsPositionDataFromRange(d,r),c=!0;this.g_aHighlightObjects.forEach(e=>{e.equals(g)&&(c=!1)}),c&&this.g_aHighlightObjects.push(g),t.refresh()}}class he{constructor(){this.curser=0,this.controlEdit=null,this.curser=0,this.currentChar=null,this.properties=["boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing"]}setEditControl(e){this.controlEdit=e}isEditable(){return!1}getPositionOfPopup(){return{top:-100,left:-100}}}class ue{constructor(){this.properties=["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","borderStyle","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing","tabSize","MozTabSize"],this.isBrowser="undefined"!=typeof window,this.isFirefox=this.isBrowser&&null!=window.mozInnerScreenX}getCaretCoordinates(e,t,n){if(!this.isBrowser)throw new Error("textarea-caret-position#getCaretCoordinates should only be called in a browser");var r=n&&n.debug||!1;if(r){var i=document.querySelector("#input-textarea-caret-position-mirror-div");i&&i.parentNode.removeChild(i)}var a=document.createElement("div");a.id="input-textarea-caret-position-mirror-div",document.body.appendChild(a);var s=a.style,o=window.getComputedStyle?getComputedStyle(e):e.currentStyle;s.whiteSpace="pre-wrap","INPUT"!==e.nodeName&&(s.wordWrap="break-word"),s.position="absolute",r||(s.visibility="hidden"),this.properties.forEach((function(e){s[e]=o[e]})),this.isFirefox?e.scrollHeight>parseInt(o.height)&&(s.overflowY="scroll"):s.overflowY="auto",a.textContent=e.value.substring(0,t),"INPUT"===e.nodeName&&(a.textContent=a.textContent.replace(/\s/g," "));var l=document.createElement("span");l.textContent=e.value.substring(t)||".",a.appendChild(l);var h={top:l.offsetTop+parseInt(o.borderTopWidth),left:l.offsetLeft+parseInt(o.borderLeftWidth)};return r?l.style.backgroundColor="#aaa":document.body.removeChild(a),h}}class de extends he{constructor(){super()}setEditControl(e){("TEXTAREA"==e.nodeName||"INPUT"==e.nodeName&&"text"==e.type.toLowerCase())&&(this.controlEdit=e,this.curser=e.selectionEnd,this.startSelection=e.selectionStart,this.currentChar=this.getCurrentCharacter(),e.setSelectionRange(this.startSelection,this.curser))}isEditable(){return void 0!==this.controlEdit&&(("TEXTAREA"==this.controlEdit.nodeName||"INPUT"==this.controlEdit.nodeName&&"text"==this.controlEdit.type.toLowerCase())&&this.curser==this.startSelection)}getSentence(){try{this.curser=this.controlEdit.selectionEnd,this.startSelection=this.controlEdit.selectionStart}catch(e){}var e,t="";if(window.getSelection&&(e=window.getSelection()).modify){this.controlEdit.focus(),this.controlEdit.setSelectionRange(this.startSelection,this.startSelection);var n=e.getRangeAt(0);32==this.currentChar.charCodeAt(0)||this.currentChar.charCodeAt(0),e.modify("extend","backward","sentenceboundary"),t=e.toString(),new RegExp("[.?!]").test(t.slice(-1))&&(t=t.slice(0,t.length-1)),e.removeAllRanges(),e.addRange(n)}else if((e=document.selection)&&"Control"!=e.type){var r=e.createRange();r.collapse(!0),r.expand("sentence"),t=r.text}return this.controlEdit.setSelectionRange(this.startSelection,this.curser),t}getPositionOfPopup(){var e=this.controlEdit;if(void 0===e)return{top:-100,left:-100};var t=getComputedStyle(e).getPropertyValue("font-size");if("TEXTAREA"==this.controlEdit.nodeName||"INPUT"==this.controlEdit.nodeName&&"text"==this.controlEdit.type.toLowerCase()){let r=(new ue).getCaretCoordinates(e,e.selectionEnd);this.curser=e.selectionEnd;var n={x:0,y:0};return this.GetOffset(e,n),{top:n.y-e.scrollTop+r.top+parseInt(t)+4+"px",left:n.x-e.scrollLeft+r.left+10+"px"}}return{top:-100,left:-100}}GetOffset(e,t){e&&(t.x+=e.offsetLeft,t.y+=e.offsetTop,this.GetOffset(e.offsetParent,t))}setSelectionRange(e,t,n){if(e.setSelectionRange)e.focus(),e.setSelectionRange(t,n);else if(e.createTextRange){var r=e.createTextRange();r.collapse(!0),r.moveEnd("character",n),r.moveStart("character",t),r.select()}else e.focus()}setCaretPosition(e,t){if(null!=e)if(e.createTextRange){var n=e.createTextRange();n.move("character",t),n.select()}else e.selectionStart?(e.focus(),e.setSelectionRange(t,t)):e.focus()}insertText(e){var t=this.controlEdit;if("DIV"==t.tagName){t.focus();var n=document.getElementById("rwPredictionPosition");this.setCaretPositionDiv(currentContextControlID),this.setSelectionRange(t,n.value,n.value),this.currentChar=this.getCurrentCharacter(),this.replaceSelectedText(e)}else this.CurrentPosition=t.selectionStart,this.setSelectionRange(t,this.CurrentPosition,this.CurrentPosition),this.currentChar=this.getCurrentCharacter(),this.setSelectionRange(t,this.CurrentPosition,this.CurrentPosition),this.replaceSelectedText(e),this.setSelectionRange(t,this.CurrentPosition,this.CurrentPosition),this.setCaretPosition(t,this.CurrentPosition);return!1}getCurrentCharacter(){var e,t="";if(window.getSelection&&(e=window.getSelection()).modify){var n=e.getRangeAt(0);e.modify("move","backward","character"),e.modify("extend","forward","character"),t=e.toString(),e.removeAllRanges(),e.addRange(n)}else if((e=document.selection)&&"Control"!=e.type){var r=e.createRange();r.collapse(!0),r.expand("word"),t=r.text}return t}replaceSelectedText(e){var t;e+=" ";var n=0;if(window.getSelection){l=window.getSelection();var r=document.activeElement;if("TEXTAREA"==r.nodeName||"INPUT"==r.nodeName&&"text"==r.type.toLowerCase()){if(this.curser>0)switch(this.currentChar.charCodeAt(0)){case 32:case 160:e=e;break;case 46:case 33:case 63:e=e.trim()+this.currentChar+" ",l.modify("move","backward","character"),l.modify("move","backward","character"),l.modify("extend","forward","character")," "==(i=l.toString())?(l.modify("move","forward","character"),l.modify("extend","forward","character")):(l.modify("move","backward","word"),l.modify("extend","forward","word"),l.modify("extend","forward","character"));break;case 10:e=e.trim()+" ";var i=l.toString();break;case 38:l.modify("move","backward","character"),l.modify("move","backward","character"),l.modify("extend","forward","character")," "==(i=l.toString())?(l.modify("move","forward","character"),l.modify("extend","forward","character")):(l.modify("move","backward","word"),l.modify("extend","forward","word"));break;case 45:l.modify("move","backward","word"),l.modify("extend","forward","word"),l.modify("extend","forward","word");break;default:if(l.modify("move","backward","word"),l.modify("move","backward","character"),l.modify("extend","forward","character"),"-"==(i=l.toString())?(l.modify("extend","backward","character"),l.modify("move","forward","character"),l.modify("move","backward","word"),l.modify("extend","forward","word"),l.modify("extend","forward","word")):32==i.charCodeAt(0)&&l.modify("move","forward","character"),l.modify("extend","forward","word"),"-"==(i=l.toString()).substr(i.length-1,1)&&l.modify("extend","forward","word"),i=l.toString(),-1!=navigator.appVersion.indexOf("Win")){" "==i.substr(i.length-1,1)&&(l.modify("extend","backward","character"),e=e.trim(),n++);(i=l.toString()).substr(i.length-1,1).match(/^[0-9a-zA-Z]+$/)||(l.modify("extend","backward","character"),e=e.trim(),n++)}}var a=r.value,s=r.selectionStart,o=r.selectionEnd;if(-1!=navigator.appVersion.indexOf("Win"));else switch(a.slice(o).substr(0,1)){case" ":e=e.trim(),n++;break;case";":case":":case"!":case".":e=e.trim(),n++,n++}r.value=a.slice(0,s)+e+a.slice(o),this.CurrentPosition=s+e.length+n}else{var l=window.getSelection();if(this.setCaretPositionDiv(r),32==this.currentChar.charCodeAt(0)||160==this.currentChar.charCodeAt(0));else l.modify("move","backward","word"),l.modify("move","backward","character"),l.modify("extend","forward","character"),"-"==(i=l.toString())?(l.modify("extend","backward","character"),l.modify("move","forward","character"),l.modify("move","backward","word"),l.modify("extend","forward","word"),l.modify("extend","forward","word")):32==i.charCodeAt(0)&&l.modify("move","forward","character"),l.modify("extend","forward","word");l.rangeCount?((t=l.getRangeAt(0)).deleteContents(),t.insertNode(document.createTextNode(e))):l.deleteFromDocument();a=r.value,s=r.selectionStart,o=r.selectionEnd;r.value=a.slice(0,s)+e+a.slice(o),setCaretPositionDiv(r,s+e.length)}}else document.selection&&document.selection.createRange&&((t=document.selection.createRange()).text=e)}getSelection(){var e,t=this.controlEdit;if(null!=document.selection)t.focus(),e=document.selection.createRange().text;else if(null!=t.selectionStart){var n=t.selectionStart,r=t.selectionEnd;e=t.value.substring(n,r)}return e}}class ge extends he{constructor(){super()}setEditControl(e){this.controlEdit=e,this.sel=window.getSelection(),this.curser=this.getCaretPosition(e),this.currentChar=this.getCurrentCharacter()}getCaretPosition(e){var t,n,r=0;if(window.getSelection)(t=window.getSelection()).rangeCount&&(n=t.getRangeAt(0)).commonAncestorContainer.parentNode==e&&(r=n.endOffset);else if(document.selection&&document.selection.createRange&&(n=document.selection.createRange()).parentElement()==e){var i=document.createElement("span");e.insertBefore(i,e.firstChild);var a=n.duplicate();a.moveToElementText(i),a.setEndPoint("EndToEnd",n),r=a.text.length}return r}isEditable(){return void 0!==this.controlEdit&&(void 0!==this.controlEdit.contentEditable&&("true"==this.controlEdit.contentEditable||1==this.controlEdit.contentEditable))}getSentence(){return this._getSentence().textBeforeSelection}_getSentence(){if(null==this.controlEdit)return{selectedText:"",textBeforeSelection:"",textAfterSelection:""};var e="",t="",n="",r=window.getSelection();e=r.getRangeAt(0).toString();var i=r.getRangeAt(0),a=this._getTextNodesInRange(i);if(1==a.length)e=a[0].textContent.substring(i.startOffset,i.endOffset);else if(a.length<1)e="";else if(2==a.length)e=a[0].textContent.substring(i.startOffset)+" ",e+=a[1].textContent.substring(0,i.endOffset);else{e=a[0].textContent.substring(i.startOffset)+" ";for(var s=1;s<a.length-1;s++)e+=a[s].textContent+" ";e+=a[a.length-1].textContent.substring(0,i.endOffset)}var o=null,l=0,h=r.anchorNode.compareDocumentPosition(r.focusNode);h&Node.DOCUMENT_POSITION_PRECEDING?(o=r.focusNode,l=r.focusOffset):0==h?(o=r.anchorNode,l=r.focusOffset,r.anchorOffset<r.focusOffset&&(l=r.anchorOffset)):(o=r.anchorNode,l=r.anchorOffset),t=o.textContent.substring(0,l),n=o.textContent.substring(l+e.length);for(var u=this._getPrevTextNode(o);null!==u;)t=u.textContent+t,u=this._getPrevTextNode(u);for(var d=this._getNextTextNode(o);null!==d;)n+=d.textContent,d=this._getNextTextNode(d);return{selectedText:e,textBeforeSelection:t,textAfterSelection:n}}_getNextTextNode(e){var t=e.nextSibling;return null!==t?t:null===e.parentNode||null===e.parentNode.nextSibling||3!==e.parentNode.nextSibling.nodeType?null:e.parentNode.nextSibling}_getPrevTextNode(e){var t=e.previousSibling;return null!==t?t:null===e.parentNode||null===e.parentNode.previousSibling||3!==e.parentNode.previousSibling.nodeType?null:e.parentNode.previousSibling}_getTextNodesInRange(e){var t,n=e.startContainer,r=e.endContainer,i=e.commonAncestorContainer,a=[];function s(e){if(e.firstChild)return e.firstChild;for(;e;){if(e.nextSibling)return e.nextSibling;e=e.parentNode}}for(t=n.parentNode;t&&(3===t.nodeType&&a.push(t),t!=i);t=t.parentNode);for(a.reverse(),t=n;t&&(3===t.nodeType&&a.push(t),t!=r);t=s(t));return a}getPositionOfPopup(){var e=this.controlEdit;return void 0===e?{top:-100,left:-100}:this.getCaretCoordinates(e,this.curser)}getCaretCoordinates(e,t){var n,r,i,a=!(null==window.mozInnerScreenX);(n=document.getElementById(e.nodeName+"--texthelp-mirror-div"))||((n=document.createElement("div")).id=e.nodeName+"--texthelp-mirror-div",document.body.appendChild(n)),i=n.style,r=getComputedStyle(e),i.whiteSpace="pre-wrap","INPUT"!==e.nodeName&&(i.wordWrap="break-word"),i.position="absolute",i.top=e.offsetTop+parseInt(r.borderTopWidth)+"px",i.left="400px",i.visibility="hidden",["boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing"].forEach((function(e){i[e]=r[e]})),a?(i.width=parseInt(r.width)-2+"px",e.scrollHeight>parseInt(r.height)&&(i.overflowY="scroll")):i.overflow="hidden",n.textContent=e.value.substring(0,t),"INPUT"===e.nodeName&&(n.textContent=n.textContent.replace(/\s/g," "));var s=document.createElement("span");return s.textContent=e.value.substring(t)||".",s.style.backgroundColor="lightgrey",n.appendChild(s),{top:s.offsetTop+parseInt(r.borderTopWidth),left:s.offsetLeft+parseInt(r.borderLeftWidth),height:parseInt(r.fontSize.substr(r.fontSize,r.fontSize.length-2))}}setSelectionRange(e,t,n){"#text"!=e.nodeName&&(e=e.childNodes[0]);var r=document.createRange();r.setStart(e,t),r.setEnd(e,n);var i=window.getSelection();i.removeAllRanges(),i.addRange(r)}setCaretPosition(e,t){if(null!=e)if(e.createTextRange){var n=e.createTextRange();n.move("character",t),n.select()}else e.selectionStart?(e.focus(),e.setSelectionRange(t,t)):e.focus()}insertText(e){var t=this._getSentence();if(null!=t){if(null==this.controlEdit)return null;var n=t.textBeforeSelection.split(/\W+/);n=n[n.length-1].trim();var r=t.textAfterSelection.split(/\W+/)[0].trim(),i=window.getSelection().getRangeAt(0);n.length>0?(i.setStart(i.startContainer,i.startOffset-n.length),i.setEnd(i.endContainer,i.endOffset+r.length)):e+=" ",document.execCommand("insertText",!1,e)}}getCurrentCharacter(){return this.controlEdit.innerHTML.charAt(this.curser-1)}getSelection(){var e,t=this.controlEdit;if(null!=document.selection)t.focus(),e=document.selection.createRange().text;else if(null!=t.selectionStart){var n=t.selectionStart,r=t.selectionEnd;e=t.value.substring(n,r)}return e}}class ce{constructor(){this.predictionManager=null}getPredictionCoordinates(){return null!=this.predictionManager?this.predictionManager.getPositionOfPopup():{top:-1e3,left:-1e3}}getPredictionSentence(){return null!=this.predictionManager?this.predictionManager.getSentence():null}predictionInsertText(e){null!=this.predictionManager&&this.predictionManager.insertText(e)}setSelectionRange(e,t,n){this.onMouseDown({target:e}),null!=this.predictionManager&&this.predictionManager.setSelectionRange(e,t,n)}isEditable(){return null!=this.predictionManager&&this.predictionManager.isEditable()}onMouseDown(e){this.predictionFactory(e),null!=this.predictionManager&&this.predictionManager.setEditControl(e.target)}onKeyDown(e){this.predictionFactory(e),null!=this.predictionManager&&this.predictionManager.setEditControl(e.target)}predictionFactory(e){let t=e.target;"TEXTAREA"==t.nodeName||"INPUT"==t.nodeName&&"text"==t.type.toLowerCase()?this.predictionManager=new de:void 0===t.contentEditable||"true"!=t.contentEditable&&1!=t.contentEditable||(this.predictionManager=new ge)}}class me{constructor(){this.speechRangeColour="color:#000000; background:#FFFF00",this.speechWordColour="color:#FFFFFF; background:#0000FF; padding: 2px; margin: -2px; border-radius: 4px; text-shadow: 0 3px 8px #2A2A2A;position:relative"}get speechRangeColour(){return this._speechRangeColour}set speechRangeColour(e){this._speechRangeColour=e}get speechWordColour(){return this._speechWordColour}set speechWordColour(e){this._speechWordColour=e}}class pe extends F{constructor(){super(),this.timerEvent=null,this.callback=null,this.caretRange=null,this.sentence,this.readRange=null,this.orgElement=null,this.targetElement=null,this.callback}clearTimer(){clearTimeout(this.timerEvent)}clearHoverSpeak(){clearTimeout(this.timerEvent),this.sentence}mouseClick(e,t){var n;if(this.targetElement=e.target,null!=t&&"function"==typeof t&&(this.callback=t),null!=this.targetElement&&("html"==this.targetElement.tagName.toLowerCase()||"body"==this.targetElement.tagName.toLowerCase()))return null;var r=new M;if(r.isIgnored(this.targetElement)||r.isAriaHidden(this.targetElement)&&!this.targetElement.parentNode.isMathJax)return null;if(null==this.targetElement||"img"!=this.targetElement.tagName.toLowerCase()&&"textarea"!=this.targetElement.tagName.toLowerCase()&&"input"!=this.targetElement.tagName.toLowerCase()){let t=e.target.getRootNode();if(t.mode&&"open"==t.mode)n=new R(this.targetElement,0,this.targetElement,0);else if(void 0!==document.caretRangeFromPoint){var i=e.target.ownerDocument.caretRangeFromPoint(e.clientX,e.clientY);n=new R(i.startContainer,i.startOffset,i.endContainer,i.endOffset)}else if(void 0!==document.caretPositionFromPoint){i=e.target.ownerDocument.caretPositionFromPoint(e.clientX,e.clientY);n=new R(i.offsetNode,i.offset,i.offsetNode,i.offset)}else{if(this.orgElement=this.targetElement.cloneNode(!0),"TEXTHELP-WRAPPER-SPAN"!=this.targetElement.tagName&&"TEXTHELP-HIGHLIGHT-SPAN"!=this.targetElement.tagName)(new A).tagSentences(this.targetElement);var a=this.targetElement.ownerDocument.elementFromPoint(e.clientX,e.clientY);n=new R(a,0,a,0)}}else n=new R(this.targetElement,0,this.targetElement,0);n=r.checkRangeForMathElement(n);var s=new ae;u.bMathsSymbols&&(this.mathSymbolControl=new se,this.mathWithContext=!1,u.mathSymbolMapping&&this.mathSymbolControl.mathsMappingSetup(u.mathSymbolMapping),u.mathWithContext&&(this.mathWithContext=!0),s.setMathSymbolControl(this.mathSymbolControl,this.mathWithContext)),s.processRange(n,!0);var o=s.getFirstSentence();this.sentence=o,this.readRange=n,this.callback()}getSelectionRange(){return this.readRange}clearHoverTags(){this.sentence=null}setCallback(e){this.callback=e}}class fe{constructor(e){this.ignoreFrames=u.ignoreFrames,this.api=e,u.styleHacks=!1,u.g_bPersistAnnotations=!0,this.g_bInlineImg=!1,this.g_bIgnoreButtons=!0}async tagSentencesWithFramesImpl(e,t){void 0===e&&(e=window);try{if(e.document&&e.document.body?this.tagSentencesImpl(e.document.body,t):this.tagSentencesImpl(e,t),!this.ignoreFrames){let a;if(e.frames)a=e.frames;else{a=e.querySelectorAll("iframe");for(let e of a)e.onload=async e=>{await this.tagSentencesImpl(e.target.contentDocument.body),this.api.studySkills.rw_restoreHighlights()}}if(a.length>0){var n,r=a.length;for(n=0;n<r;n++)try{var i=a[n];i.frames.length>0?this.tagSentencesWithFramesImpl(i.frames,t):i.document&&i.document.body&&this.tagSentencesImpl(i.document.body,t)}catch(e){}}}}catch(e){}}async tagSentencesImpl(e,t){let n=new M,r=new h,i=new _,a=t;"undefinded"!=typeof e&&null!=e||(e=document.body);try{for(var s=!1,o=e;null!=o;)if(3==o.nodeType){var l=o.parentNode.tagName.toLowerCase();if("textarea"==l){o=i.getNextNode(o,!1,null);continue}var d=o.nodeValue,g=d.trimSpaceTH(),c=g.length>0;try{(o.nodeValue.includes("\n")||o.nodeValue.includes("\r"))&&(s=!0)}catch(e){}if(u.styleHacks&&"a"==l&&(c=!1),c){if(!u.styleHacks&&(u.g_bPersistAnnotations||u.g_bSpeechCacheFlag&&u.g_bAlterBrowserForConsistency)){if(g.length<d.length){var m=!1;g=d.trimSpaceStartTH(),d.length-g.length>0&&(d=s?" "+g:g,m=!0),g=d.trimSpaceEndTH(),d.length-g.length>1&&(d=g+" ",s=!1,m=!0),m&&(o.nodeValue=d)}(g=d.replace(T," ")).length<d.length&&(d=g,m=!0)}//*!
var p;p=d.search("[\\x21\\x2E\\x3F\\x3A]");var f=null!=r.rw_getAttribute(o.parentNode,"texthelpSkip"),S=o;if(p>-1&&p<d.length-1){for(var v=!0;;){if(n.rw_isFullStop(d,p,o))break;var w=d.substring(p+1).search("[\\x21\\x2E\\x3F\\x3A]");if(!(w>-1)){v=!1;break}p=p+1+w}if(v){var b=d.substring(0,p+1),y=d.substring(p+1),C=n.createWrapperElement();r.rw_setAttribute(C,"rwTHpgen","1");var x=document.createTextNode(b),N=document.createTextNode(y);(E=o.parentNode).insertBefore(N,o),E.insertBefore(C,N),C.appendChild(x),E.removeChild(o),o=N,S=x}else{if(null!=o.previousSibling||null!=o.nextSibling||f){C=n.createWrapperElement();r.rw_setAttribute(C,"rwTHpgen","1");x=document.createTextNode(d);(E=o.parentNode).insertBefore(C,o),C.appendChild(x),E.removeChild(o),o=x}S=o,o=i.getNextNode(o,!1,null)}}else{if(null!=o.previousSibling||null!=o.nextSibling||f){C=n.createWrapperElement();r.rw_setAttribute(C,"rwTHpgen","1");var E;x=document.createTextNode(d);(E=o.parentNode).insertBefore(C,o),C.appendChild(x),E.removeChild(o),o=x}S=o,o=i.getNextNode(o,!1,null)}//!*
if(u.g_bPersistAnnotations||u.g_bSpeechCacheFlag&&u.g_bAlterBrowserForConsistency){var A=S.nodeValue,k=S.nodeValue.length;s=!(k>0&&32==A.charCodeAt(k-1))}//*!
}else if(u.g_bPersistAnnotations||u.g_bSpeechCacheFlag&&u.g_bAlterBrowserForConsistency)if(s)u.styleHacks||(o.nodeValue=" "),s=!1,o=i.getNextNode(o,!1,null);else{var P=o;o=i.getNextNode(o,!1,null),u.styleHacks||P.parentNode.removeChild(P)}else o=i.getNextNode(o,!1,null)}else if(1==o.nodeType){if(u.g_bPersistAnnotations&&n.isStyleNode(o)&&"img"==o.tagName.toLowerCase()&&(s=!0),this.g_bInlineImg&&"img"==o.tagName.toLowerCase()){var R=r.rw_getAttribute(o,"msg");null!=R&&R.length>0||(null!=(R=o.getAttribute("title"))&&R.length>0||null!=(R=o.getAttribute("alt"))&&R.length>0)&&r.rw_setAttribute(o,"msg",R)}var I=r.rw_getAttribute(o,"rwTHcomp"),F=r.rw_getAttribute(o,"rwDontAlter");o="pre"==o.tagName.toLowerCase()||"button"==o.tagName.toLowerCase()&&this.g_bIgnoreButtons||null!=I&&I.length>0||null!=F&&F.length>0?i.getNextNodeIgnoreChildren(o,!1,null):i.getNextNode(o,!1,null)}else o=i.getNextNode(o,!1,null);//!*
if(u.g_bPersistAnnotations)for(o=e;null!=o;)if(3==o.nodeType){if(c=o.nodeValue.trimTH().length>0){var L,H=o.parentNode,O=H.getAttribute("id");if(null==O||0==O.length)null!=a&&(O=a+O),null!=(L=n.rw_getUniqueIdForTextNode(o,O))&&r.rw_setAttribute(H,"data-ss-id",L)}o=i.getNextNode(o,!1,null)}else if(1==o.nodeType){if(n.rw_checkIfCanHaveStickys(o)){var D=o.getAttribute("id");null!=a&&(D=a+D),null!=D&&0!=D.length||r.rw_setAttribute(o,"data-ss-id",n.rw_getUniqueIdForTextNode(o,D))}I=r.rw_getAttribute(o,"rwTHcomp"),F=r.rw_getAttribute(o,"rwDontAlter");o="pre"==o.tagName.toLowerCase()||"button"==o.tagName.toLowerCase()&&this.g_bIgnoreButtons||null!=I&&I.length>0||null!=F&&F.length>0?i.getNextNodeIgnoreChildren(o,!1,null):i.getNextNode(o,!1,null)}else o=i.getNextNode(o,!1,null);//*!
}catch(e){console.error("Error in $rw_tagSentences: "+e)}u.IELoadedFlag=!0}}class Se extends le{constructor(){super()}rw_retrieveHighlightDataForPKTReplyImpl(e,t){var n=u.ignoreHidden;try{var r;u.g_bAnnotationGlobalCheck&&u.g_bAnnotationGlobalUnknown&&rw_setUsingAnnotations(),2==u.g_nHighlightNotSyncedState&&(r=u.g_strStoredHighlightUnprocessedData),u.g_strStoredHighlightUnprocessedData=null,u.g_elemStoredHighlightLimitArea=t,Object.keys(e).forEach((t,n)=>{e[t].equals=function(e){return e.colour==this.colour&&e.startRefId==this.startRefId&&e.startRefOffset==this.startRefOffset&&e.endRefId==this.endRefId&&e.endRefOffest==this.endRefOffest},e[t].range=null,e[t].renderedInView=!1;let r=!0;this.g_aHighlightObjects.forEach(n=>{n.equals(e[t])&&(r=!1)}),r&&this.g_aHighlightObjects.push(e[t])}),this.rw_restoreHighlights(),u.g_strStoredHighlightData=e,2==u.g_nHighlightNotSyncedState&&(r!=u.g_strStoredHighlightUnprocessedData&&rw_storeHighlightData(),null==u.g_strStoredHighlightUnprocessedData?u.g_nHighlightNotSyncedState=0:u.g_nHighlightNotSyncedState=1)}catch(e){console.log(e.message)}"boolean"!=typeof eba_ignore_hidden||eba_ignore_hidden||(u.ignoreHidden=n)}rw_restoreHighlights(e){let t=new M;var n,r,i,a,s,o,l,h;let d=new Array;d=null!=e?e:this.g_aHighlightObjects,d.forEach(e=>{h=!0,n=e.colour,r=e.startRefId,i=e.startRefOffset,s=e.endRefId,o=e.endRefOffest,a=parseInt(i,10),l=parseInt(o,10);var d,g,c=document.body,m=!1;r.length>3&&"idx"==r.substring(0,3)&&(null==(d=t.rw_getElementQuerySelector("[data-ss-id="+r.substr(3)+"]"))?(h=!1,e.renderedInView=!1):null==u.g_elemStoredHighlightLimitArea||t.checkIfElementInsideElement(d,u.g_elemStoredHighlightLimitArea)?(c=d.ownerDocument.body,null==(g=this.rw_convertFromPermCaretPosition(d,a,!0))?h=!1:(r=g.path,a=g.offset)):m=!0);s.length>3&&"idx"==s.substring(0,3)&&(null==(d=t.rw_getElementQuerySelector("[data-ss-id="+s.substr(3)+"]"))?(h=!1,e.renderedInView=!1):null==u.g_elemStoredHighlightLimitArea||t.checkIfElementInsideElement(d,u.g_elemStoredHighlightLimitArea)?(c=d.ownerDocument.body,null==(g=this.rw_convertFromPermCaretPosition(d,l,!0))?h=!1:(s=g.path,l=g.offset)):m=!0);if(h&&!m){var p=null;if(u.g_bIEOld)p=rw_getAsTextRange(c,r,a,s,l);else{var f=new I;f.getCaretPairFromDomPosition(c,r,a,s,l);var S=f.leftCaret,v=f.rightCaret;null!=S&&null!=v&&(p=new R(S.node,S.offset,v.node,v.offset))}null!=p?(e.range=p,this.studySkillsHTMLHighlightRangeImpl(p,n)):h=!1}h||(null==u.g_strStoredHighlightUnprocessedData&&(u.g_strStoredHighlightUnprocessedData=""),u.g_strStoredHighlightUnprocessedData+=this.g_aHighlightObjects)})}rw_convertFromPermCaretPosition(e,t,n){let r=new M,i=new _;var a=r.getPositionInDom(e),s=0;if(n&&null!=e.firstChild){var o=i.getFirstChildTextNode(e,!1);if(null==o)return null;if(3==o.nodeType)for(var l=o.nodeValue;l.length>s&&32==l.charCodeAt(s);)++s}return new E(a,t+s)}studySkillsHTMLHighlightRange(e){let t=new M;try{var n=t.rw_getSelection();if(null==n||null==n.range||n.range instanceof String)return!1;var r=n.range;if(u.g_bIEOld){var i=r.parentElement().ownerDocument.body,a=rw_getTextRangeAsTHRange(i,r);if(null==a)return!1;var s=new I;s.getCaretPairFromDomPosition(i,a.startRef.path,a.startRef.offset,a.endRef.path,a.endRef.offset);var o=s.leftCaret,l=s.rightCaret;if(null==o||null==l)return!1;var h=new R(o.node,o.offset,l.node,l.offset);if(null==h)return null;if(null==(h=this.rw_checkTHRangeForValidHighlight(h)))return null;r=t.rw_getAsTextRange(i,h.startRef.path,h.startRef.offset,h.endRef.path,h.endRef.offset)}else r=this.rw_checkTHRangeForValidHighlight(r);return null==r?(rw_alert("Failed to do the highlight, possibly due to selection going into a non textual part of the page."),!1):(t.rw_collapseSelection(),this.studySkillsHTMLHighlightRangeImpl(r,e),u.g_bPersistAnnotations&&u.g_bPersistHighlights&&"undefined"!=typeof rw_storeHighlightData&&this.rw_storeHighlightData(),this.rw_getStudySkillsPositionData())}catch(e){return!1}}rw_storeHighlightData(){u.g_bAnnotationGlobalCheck&&rw_forceUseAnnotations();var e=this.rw_getStudySkillsPositionData();null!=u.g_strStoredHighlightUnprocessedData?(e[0]=u.g_strStoredHighlightUnprocessedData+e[0],u.g_bStoreHighlightText&&(u.g_nHighlightNotSyncedState=1)):u.g_nHighlightNotSyncedState=0,u.g_strStoredHighlightData=null,u.g_bIE&&!u.g_controllerFactory.doesSupportHtml5()?rw_submitViaFlash(e):u.g_bStoreHighlightText?rw_submitSSDataWithPost(e):rw_submitSSDataWithGet(e)}rw_getStudySkillsPositionData(){var e=this.g_aHighlightObjects.length,t={};try{for(var n=0;n<e;n++)t["highlight"+n]=this.g_aHighlightObjects[n]}catch(e){console.log(e)}return t}studySkillsClearHighlights(e,t="Remove all highlights?"){let n=new M;try{var r=n.rw_getSelection(),i=null;if(null!=r&&null!=r.range&&(i=r.range,r.frame),null!=i&&i instanceof String){if(null!=g_lastInputSelectSFF&&(g_lastInputSelectSFF.selectionStart=0,g_lastInputSelectSFF.selectionEnd=0),g_lastInputSelectSFF=null,!e)return;i=null}if(u.bOverrideIgnore=!0,u.bOverrideAriaHidden=!0,u.g_bIEOld){if(null==i||0==i.length||0==i.text.length||e){if(!e){if(!(!u.g_bAllowPopupAlertsFlag||confirm(t)))return u.bOverrideIgnore=!1,void(u.OverrideAriaHidden=!1)}u.g_bPersistAnnotations&&(u.g_strStoredHighlightData=null,u.g_strStoredHighlightUnprocessedData=null);for(var a=this.g_aHighlightObjects.length,s=0;s<a;s++){var o=this.g_aHighlightObjects[s].range;studySkillsClearRangeIE(o),this.g_aHighlightObjects[s]=null}if(this.g_aHighlightObjects=new Array,!document.compatMode.equalsTH("CSS1Compat"))if(!u.ignoreFrames&&top.frames.length>0){var l=0,h=top.frames.length;for(l=0;l<h;l++)try{(i=top.frames[l].document.selection.createRange()).expand("textedit"),studySkillsClearRangeIE(i)}catch(e){}}else(i=document.selection.createRange()).expand("textedit"),studySkillsClearRangeIE(i);return u.g_bPersistAnnotations&&u.g_bPersistHighlights&&"undefined"!=typeof rw_storeHighlightData&&rw_storeHighlightData(),u.bOverrideIgnore=!1,void(u.bOverrideAriaHidden=!1)}studySkillsClearRangeIE(i),studySkillsHTMLRefreshRanges();a=this.g_aHighlightObjects.length,s=0;var d=null,g=null;for(s=0;s<a;s++)if(null!=(d=this.g_aHighlightObjects[s].range)){if(i.inRange(d)){d=null,this.g_aHighlightObjects.splice(s,1),s--;continue}if((g=d.duplicate()).collapse(!0),i.inRange(g)){for((m=d.duplicate()).collapse(!1);m.compareEndPoints("StartToEnd",i)>0;)m.moveStart("character",-1);studySkillsClearRangeIE(g_aHighlightObjects[s].range),g_aHighlightObjects[s].range=m,rw_ieSpecificCallToSetHighlight(g_aHighlightObjects[s].range,g_aHighlightObjects[s].colour)}else if((g=d.duplicate()).collapse(!1),i.inRange(g)){for((c=d.duplicate()).collapse(!0);c.compareEndPoints("EndToStart",i)<0;)c.moveEnd("character",1);studySkillsClearRangeIE(g_aTextRange[s]),g_aTextRange[s]=c,rw_ieSpecificCallToSetHighlight(g_aTextRange[s],g_aHighlightColour[s])}if(d.inRange(i)){studySkillsClearRangeIE(d);var c=d.duplicate(),m=d.duplicate();for(c.collapse(!0),m.collapse(!1);c.compareEndPoints("EndToStart",i)<0;)c.moveEnd("character",1);for(;m.compareEndPoints("StartToEnd",i)>0;)m.moveStart("character",-1);studySkillsClearRangeIE(this.g_aHighlightObjects[s].range),this.g_aHighlightObjects[s].range=c;let e=this.rw_getStudySkillsPositionDataFromRange(m,this.g_aHighlightColour[s]),t=!0;this.g_aHighlightObjects.forEach(n=>{n.equals(e)&&(t=!1)}),t&&this.g_aHighlightObjects.push(e),rw_ieSpecificCallToSetHighlight(c,this.g_aHighlightObjects[s].colour),rw_ieSpecificCallToSetHighlight(m,this.g_aHighlightObjects[s].colour)}}i.execCommand("UnSelect",!1,null)}else{if(null==i||e){if(!e){if(!(!u.g_bAllowPopupAlertsFlag||confirm(t)))return u.bOverrideIgnore=!1,void(u.bOverrideAriaHidden=!1)}u.g_bPersistAnnotations&&(u.g_strStoredHighlightData=null,u.g_strStoredHighlightUnprocessedData=null);var p=this.g_aHighlightObjects;this.g_aHighlightObjects=new Array;for(l=0;l<p.length;l++){(d=p[l].range).refresh();try{null!=n.rw_getElementQuerySelector("[data-ss-id="+p[l].startRefId.substr(3)+"]")&&this.rw_removeHighlight(this.getListOfHighlightableNodes(d.startCaret,d.endCaret))}catch(e){this.rw_removeHighlight(this.getListOfHighlightableNodes(d.startCaret,d.endCaret))}}}else{i.refresh();for(s=0;s<this.g_aHighlightObjects.length;s++){var f=this.g_aHighlightObjects[s].range;if(null==f||null==i||i.body==f.body){var S=i.compareRange(f);switch(S){case-1:window.status="Error occurred when trying to remove a highlight.";break;case 0:case 3:f.refresh();try{null!=n.rw_getElementQuerySelector("[data-ss-id="+this.g_aHighlightObjects[s].startRefId.substr(3)+"]")&&this.rw_removeHighlight(this.getListOfHighlightableNodes(f.startCaret,f.endCaret))}catch(e){this.rw_removeHighlight(this.getListOfHighlightableNodes(f.startCaret,f.endCaret))}this.g_aHighlightObjects.splice(s,1),--s,i.refresh();break;case 4:case 7:case 8:this.case1SFF(s,i,S),++s;break;case 6:this.case2SFF(s,i);break;case 5:this.case3SFF(s,i)}}}}n.rw_collapseSelection()}u.g_bPersistAnnotations&&u.g_bPersistHighlights&&"undefined"!=typeof rw_storeHighlightData&&rw_storeHighlightData()}catch(e){console.log("Error in method: "+e.name+" "+e.message+" "+e.description+" "+e.toString())}return u.bOverrideIgnore=!1,u.bOverrideAriaHidden=!1,this.rw_getStudySkillsPositionData()}}class ve{constructor(){this.g_nStickyNoteCount=0,this.g_nStickyNoteOpened=-1,this.g_strStickyNoteOrigText,this.openNoteCallback=null,this.closeNoteCallback=null}rw_createStickyNote(e){const t=e.target;if(null!=t.firstChild&&3==t.firstChild.nodeType&&"textarea"!=t.tagName.toLowerCase()){var n=(new M).getClickPoint(e);this.rw_createStickyNoteImpl(n,-1,null,!0)}}notesCallbacks(e,t){this.openNoteCallback=e,this.closeNoteCallback=t}loadNotes(e){this.rw_unserialiseStickyNotesInternalImpl(e,null)}rw_unserialiseStickyNotesInternalImpl(e,t){let n=new M;if(null!=e.notes&&e.notes.length>0)for(var r="",i="",a="",s=0;s<e.notes.length;s++){r=e.notes[s].id,i=e.notes[s].position,a=e.notes[s].text;var o=i.lastIndexOf("-");if(o>-1&&o<i.length-1){var l=i.substr(o+1),h=parseInt(l,10),u=null;if((o=(i=i.substring(0,o)).indexOf("^^"))>-1)for(;o>-1;)o=(i=i.substr(0,o)+i.substr(o+1)).indexOf("^^",o+1);if("idx"==i.substr(0,3)){var d=i.substr(3),g=document.getElementById(d);null!=g&&(-1==h&&rw_isSpan(g.tagName.toLowerCase())&&null!=g.firstChild&&1==g.firstChild.nodeType&&"img"==g.firstChild.tagName.toLowerCase()&&null==g.firstChild.nextSibling&&(g=g.firstChild),u=n.getCaretFromDomPosition(document.body,n.getPositionInDom(g),h,!0))}else u=n.getCaretFromDomPosition(document.body,i,h,!1);if(null!=u){if((o=a.indexOf("^^"))>-1)for(;o>-1;)o=(a=a.substr(0,o)+a.substr(o+1)).indexOf("^^",o+1);a=this.rw_custUnescape(a),(null==t||n.isElementContainedByElement(u.node,t))&&this.rw_createStickyNoteImpl(u,parseInt(r,10),a,!1)}}}}checkIfInsideHighlight(e){let t=new h;if(null==e||null==e.node)return e;var n=e.node;3==n.nodeType&&(n=n.parentNode);var r=t.rw_getAttribute(n,"rwstate"),i=t.rw_getAttribute(n,"rwTHgen");if(null!=r){for(;null!=r||null!=i;){if(null==(n=n.parentNode))return e;if(n==document.body)break;r=t.rw_getAttribute(n,"rwstate"),i=t.rw_getAttribute(n,"rwTHgen")}e=new s(n,0,!0)}return e}rw_createNoteImg(e,t){var n=null;if(u.g_bIEOld)try{n=document.createElement("<thStickyNote name='texthelpnote'>")}catch(e){n=null}null==n&&((n=document.createElement("thStickyNote")).name="texthelpnote"),n.setAttribute("alt",""),u.g_bIE&&null==e&&n.setAttribute("data-rwths","0"),null!=e&&n.setAttribute("title",e);let r=new h;return r.rw_setAttribute(n,"rwTHcomp","1"),(new M).addEvent(n,"click",this.$rw_clickOnStickyNote.bind(this)),r.rw_setAttribute(n,"texthelpnoteid",""+t),n.id="texthelpnote"+t,n.className="sticky_icon_unselected stickNotesIcon",n}$rw_clickOnStickyNote(e){var t=(new M).getTargetElement(e);this.openNoteCallback(t)}rw_removeNote(e){let t=new h,n=new M;var r="texthelpnote"+e;try{var i=document.getElementById(r);if(null!=i&&null!=i.parentNode){var a=i.parentNode;if(a.removeChild(i),!0,t.rw_getAttribute(a,"rwTHgen")&&n.rw_isSpan(a.tagName.toLowerCase())){var s=a.firstChild;if(null!=s&&null==s.nextSibling&&(3==s.nodeType||null==t.rw_getAttribute(s,"rwTHgen")&&null==t.rw_getAttribute(s,"rwTHcomp"))){var o=a.parentNode;o.insertBefore(s,a),o.removeChild(a)}}}}catch(e){}}rw_createStickyNoteImpl(e,t,n,r){let i=new M,a=new h;if(null!=e&&null!=e.node&&null!=e.node.parentNode){var o=this.checkIfInsideHighlight(e),l=e!=o;if(l){var u=i.getNextNodeIgnoreChildren(o.node,!1,o.node.parentNode),d=i.getNextTextNodeNoImg(o.node,!1,u,!1);null!=d&&3==d.nodeType&&(o=new s(d,0,!0))}if(i.rw_checkIfCanHaveStickys(e.node)&&(!l||i.rw_checkIfCanHaveStickys(o.node))){var g;if(document.getElementsByName("texthelpnote").length>20)return;-1==t?(++this.g_nStickyNoteCount,g=this.g_nStickyNoteCount):(g=t,this.g_nStickyNoteCount<g&&(this.g_nStickyNoteCount=g+1));var c=this.rw_createNoteImg(n,g);if(l&&(e=o),1==e.node.nodeType){var m=i.createPlainSpan();a.rw_setAttribute(m,"rwTHgen","1"),(p=e.node).parentNode.insertBefore(m,p),m.appendChild(c),m.appendChild(p)}else if(3==e.node.nodeType){var p,f=e.offset,S=(p=e.node).nodeValue;if("boolean"==typeof eba_old_firefox_sticky_handling&&1==eba_old_firefox_sticky_handling||(f=0),0!=f){for(f>0&&f==S.length&&--f;f>0&&32==S.charCodeAt(f);)--f;for(var v;f>0&&((v=S.charCodeAt(f-1))>63&&v<91||v>94&&v<123||v>44&&v<58||34==v||39==v);)--f}if(0==f&&32==S.charCodeAt(0)){for(var w=1;w<S.length&&32==S.charCodeAt(w);)++w;if(w<S.length)f=w;else{var b=p.parentNode.previousSibling;if(null!=b&&1==b.nodeType&&"img"==b.tagName.toLowerCase()&&null!=a.rw_getAttribute(b,"texthelpnoteid"))return;var y=p.parentNode.nextSibling;if(null!=y&&1==y.nodeType&&"img"==y.tagName.toLowerCase()&&null!=a.rw_getAttribute(y,"texthelpnoteid"))return}}var C=i.splitText(p,f),T=C.parentNode.previousSibling;if(null!=T&&1==T.nodeType&&("img"==T.tagName.toLowerCase()||"thstickynote"==T.tagName.toLowerCase())&&null!=a.rw_getAttribute(T,"texthelpnoteid"))return;C.parentNode.parentNode.insertBefore(c,C.parentNode)}r&&this.openNoteCallback(c,!0)}}}rw_custUnescape(e){var t,n,r,i,a=e.length;for(t=0;t<a;t++)if(91==(r=e.charCodeAt(t))){for(n=t+1,i="",r=e.charCodeAt(n);n<a&&93!=r;)i+=e.charAt(n),++n<a&&(r=e.charCodeAt(n));try{r=h2d(i),a=(e=n<a?e.substr(0,t)+String.fromCharCode(r)+e.substr(n+1):e.substr(0,t)+String.fromCharCode(r)).length}catch(e){}}return e}rw_serialiseStickyNotesImpl(e){let t=new h,n=new M;u.g_bAnnotationGlobalCheck&&rw_forceUseAnnotations();var r="texthelpnote"+e,i=document.getElementById(r);if(null!=i.parentNode&&i.parentNode.nodeType&&1==i.parentNode.nodeType||(i=null),null!=i&&"thstickynote"==i.tagName.toLowerCase()&&null!=t.rw_getAttribute(i,"rwTHcomp")){t.rw_getAttribute(i,"texthelpnoteid");if(null!=r){var a,s;i.title;if(null!=i.nextSibling){var o=i.nextSibling;if(1!=o.nodeType||n.rw_isSpan(o.tagName.toLowerCase())){s=0,s+=n.rw_getNodeOffset(i);for(d=(l=i.parentNode).getAttribute("id");(null==d||0==d.length)&&l!=document.body;)s+=n.rw_getNodeOffset(l),d=(l=l.parentNode).getAttribute("id");null!=d&&d.length>0?a="idx"+d:(a=n.getPositionInDom(i.parentNode),s=n.rw_getNodeOffset(i))}else{a=null==(d=o.getAttribute("id"))||0==d.length?n.getPositionInDom(i.parentNode):"idx"+d,s=-1}}else{s=0,s+=n.rw_getNodeOffset(i);for(var l,d=(l=i.parentNode).getAttribute("id");(null==d||0==d.length)&&l!=document.body;)s+=n.rw_getNodeOffset(l),d=(l=l.parentNode).getAttribute("id");null!=d&&d.length>0?a="idx"+d:(a=n.getPositionInDom(i.parentNode),s=n.rw_getNodeOffset(i))}return{position:a+"-"+s}}}}}class we{constructor(e){o(this,"setIgnorePageDefault",(function(e){this.m_bIgnoreDefault=e})),o(this,"isIgnorePageDefault",(function(){return this.m_bIgnoreDefault})),o(this,"setDocument",(function(e){this.m_doc=e})),o(this,"setIgnoreAll",(function(e){let t=new h,n=t.getIgnoreAttr();e?t.rw_setAttribute(this.m_doc.body,n,"1"):t.rw_removeAttribute(this.m_doc.body,n)})),o(this,"isIgnoreAll",(function(){let e=new h,t=e.getIgnoreAttr();return null!=e.rw_getAttribute(this.m_doc.body,t)})),o(this,"addIgnore",(function(e){let t=(new h).getIgnoreAttr();this.addAttribute(e,t,"1")})),o(this,"addAllow",(function(e){let t=(new h).getAllowAttr();this.addAttribute(e,t,"1")})),o(this,"removeIgnore",(function(e){let t,n=new h,r=n.getIgnoreAttr();t=e instanceof Element?e:this.m_doc.getElementById(e),n.rw_removeAttribute(t,r)})),o(this,"removeAllow",(function(e){let t,n=new h,r=n.getAllowAttr();t=e instanceof Element?e:this.m_doc.getElementById(e),n.rw_removeAttribute(t,r)})),o(this,"addIgnoreList",(function(e){if(null!=e)for(var t=0;t<e.length;t++)this.addIgnore(e[t])})),o(this,"addIgnoreListQuerySelector",(function(e){let t=document.querySelectorAll(e);if(null!=t)for(let e=0;e<t.length;e++)this.addIgnore(t[e])})),o(this,"addAllowList",(function(e){if(e instanceof Array)for(let t=0;t<e.length;t++)this.addAllow(e[t])})),o(this,"addAllowListQuerySelector",(function(e){let t=document.querySelectorAll(e);if(null!=t)for(let e=0;e<t.length;e++)this.addAllow(t[e])})),o(this,"removeIgnoreList",(function(e){if(e instanceof Array)for(let t=0;t<e.length;t++)this.removeIgnore(e[t])})),o(this,"removeIgnoreListQuerySelector",(function(e){var t=document.querySelectorAll(e);if(null!=t)for(let e=0;e<t.length;e++)this.removeIgnore(t[e])})),o(this,"removeAllowList",(function(e){if(e instanceof Array)for(let t=0;t<e.length;t++)this.removeAllow(e[t])})),o(this,"removeAllowListQuerySelector",(function(e){let t=document.querySelectorAll(e);if(null!=t)for(let e=0;e<t.length;e++)this.removeAllow(t[e])})),o(this,"addPronunciation",(function(e,t){this.addPronunciationImpl(this.m_doc.body,e,t)})),o(this,"removePronunciation",(function(e){this.removePronunciationImpl(this.m_doc.body,e)})),o(this,"addPronunciationById",(function(e,t,n){let r=this.m_doc.getElementById(e);null!=r&&this.addPronunciationImpl(r,t,n)})),o(this,"removePronunciationById",(function(e,t){let n=this.m_doc.getElementById(e);null!=n&&this.removePronunciationImpl(n,t)})),o(this,"replaceTextInElement",(function(e,t){let n=(new h).getPronunceAttr();this.addAttribute(e,n,t)})),o(this,"restoreTextInElement",(function(e){let t=new h,n=t.getPronunceAttr();t.rw_removeAttribute(this.m_doc.getElementById(e),n)})),o(this,"addCommand",(function(e,t){if("string"==typeof t){let n=(new h).getCommandAttr();this.addAttribute(e,n,t)}})),o(this,"removeCommand",(function(e){var t=this.m_doc.getElementById(e);null!=t&&this.removeCommands(t)})),o(this,"addCommandQueue",(function(e,t){if(t instanceof Array){let n=(new h).getCommandAttr();this.addAttribute(e,n,"list");for(let r=0;r<t.length;r++)this.addAttribute(e,n+(r+1),t[r])}})),o(this,"checkCommandsForPageID",(function(){let e=new Array,t=document.querySelectorAll('[texthelpcmd^="pageid"]');if(null!=t&&t.length>0)for(let n=0;n<t.length;n++){let r=t[n].attributes.texthelpcmd.value;if(null!=r){let t=r.indexOf(":");t>-1&&e.push(r.substr(t+1))}}return e})),o(this,"setReadingOrder",(function(e){try{if(this.addAllowList(e),e instanceof Array&&e.length>0){for(let t=0;t<e.length-1;t++)this.addCommand(e[t],"jump:"+e[t+1]);this.addCommand(e[e.length-1],"stopafter")}}catch(e){}})),o(this,"setStrictReadingOrder",(function(e){this.clearAllReadingOrders(),this.setIgnoreAll(!0),this.setReadingOrder(e)})),o(this,"clearReadingOrder",(function(e){try{if(this.removeAllowList(e),e instanceof Array&&e.length>0)for(let t=0;t<e.length;t++)this.removeCommand(e[t])}catch(e){}})),o(this,"clearAllReadingOrders",(function(){try{this.clearAllReadingOrderImpl(this.m_doc.body)}catch(e){}})),o(this,"clearAllCommands",(function(){try{this.clearAllCommandsImpl(m_doc.body)}catch(e){}})),this.m_bIgnoreDefault=!1,this.m_doc=e||document}clearAllReadingOrderImpl(e){let t=e;for(;null!=t;)t.hasChildNodes()&&this.clearAllReadingOrderImpl(t.firstChild),this.removeAllowIgnore(t),this.removeCommands(t),t=t.nextSibling}clearAllCommandsImpl(e){let t=e;for(;null!=t;)t.hasChildNodes()&&this.clearAllCommandsImpl(t.firstChild),this.removeCommands(t),t=t.nextSibling}addAttribute(e,t,n){let r;if(r=e instanceof Element?e:this.m_doc.getElementById(e),null!=r){(new h).rw_setAttribute(r,t,n)}}addPronunciationImpl(e,t,n){let r=e,i=new _,a=i.getFirstChildTextNode(e,!1);for(;a;){let e=this.checkNodeForPronunciation(a,t,n);null!=e?(a=i.getNextNodeIgnoreChildren(e,!1,r),3!=a.nodeType&&(a=i.getNextTextNodeNoBlank(a,!1,r))):a=i.getNextTextNodeNoBlank(a,!1,r)}}removePronunciationImpl(e,t){let n=e,r=new _,i=r.getFirstChildTextNode(e,!1);for(;i;){let e=r.getNextTextNodeNoBlank(i,!1,n);this.checkNodeForRemovingPronunciation(i,t),i=e}}checkNodeForPronunciation(e,t,n){if(3==e.nodeType){let r=e.nodeValue;if(r.indexOf(t)>-1){let i=(new h).getPronunceAttr(),a=r.indexOf(t);return(new M).wrapText(e,a,a+t.length,[i,n])}}return e}checkNodeForRemovingPronunciation(e,t){if(3==e.nodeType&&e.nodeValue==t){let t=new h,n=t.getPronunceAttr();if(null!=e.parentNode&&null!=t.rw_getAttribute(e.parentElement,n)){let t=e.parentNode,n=t.parentNode;null!=n&&n.replaceChild(e,t)}}}removeAllowIgnore(e){if(null!=e){let t=new h,n=t.getAllowAttr();t.rw_removeAttribute(e,n);let r=t.getIgnoreAttr();t.rw_removeAttribute(e,r)}}removeCommands(e){if(null!=e){let t=new h,n=t.getCommandAttr();t.rw_removeAttribute(e,n);let r=1,i=t.rw_getAttribute(e,"texthelpCmd"+r);for(;null!=i;)t.rw_removeAttribute(e,"texthelpCmd"+r),++r,i=t.rw_getAttribute(e,"texthelpCmd"+r)}}async tagSentences(e,t,n){if(null!=e){let r=new fe(n);await r.tagSentencesWithFramesImpl(e,t)}}}class be{constructor(...e){if(1===e.length){u.init(e[0]);const{sre:t,tagPage:n,tagClass:r,wrapperTag:i,highlightTag:a,url:s}=e[0];if(this.initialise({url:s,sre:t}),u.tagPage){void 0!==r&&v(r),void 0!==i&&w(i),void 0!==a&&b(wraphighlightTagperTag),new fe(this).tagSentencesWithFramesImpl(window)}}else{const[,t]=e;this.initialise({url:t})}}initialise(e){var t;if(this.mathLoaded=!1,e.sre&&(t=e.sre,d=t,this.mathLoaded=!0),this.selectionController=new L,this.highlightSettings=new me,this.speechHighlightManager=null,this.hoverSpeak=new oe,this.clickToSpeak=new pe,this.speechObject=new ae,u.tagPage?this.studySkills=new Se:this.studySkills=new le,this.notes=new ve,u.bMathsSymbols&&(this.mathSymbolControl=new se,this.mathWithContext=!1,u.mathSymbolMapping&&this.mathSymbolControl.mathsMappingSetup(u.mathSymbolMapping),u.mathWithContext&&(this.mathWithContext=!0),this.speechObject.setMathSymbolControl(this.mathSymbolControl,this.mathWithContext)),this.hoverSpeakOn=!1,this.url=e.url,null!=e.url&&"undefined"!=typeof MathJax&&MathJax.version&&"function"==typeof MathJax.Ajax.Load){var n=window.MathJax;delete window.MathJax,window.MathJax=n;let t=!1;for(var r in MathJax.Ajax.loaded)if(r.indexOf("toMathML")>-1){t=!0;break}t||MathJax.Ajax.Load(e.url+"toMathML.js"),this.load_script(e.url+"sre_browser.js"),this.mathLoaded=!0}this.predictionOn=!1,this.predictionManager=new ce,this.textareaParser=new a,i.subscribe("pauseHover",this.pauseHover.bind(this)),this.isHoverSpeakEnabled=!1,this.addEventsToWindow(window),u.addEventsToFrames&&(this.setUpiframes(),this.setUpIFrameObserver()),this.ignoreToolbarId=u.toolbarID}getDocumentLanguage(e){return null!=e?frames.document.documentElement.lang:document.documentElement.lang}addEventsToWindow(e){e.addEventListener("click",e=>{let t=e.target.shadowRoot;if(t)for(let e=0;e<t.children.length;e++)if(t.children[e].id==this.ignoreToolbarId)return;this.clickToSpeakOn&&this.mouseClickEvent(e)}),e.addEventListener("mousemove",e=>{let t=e.target.shadowRoot;if(t)for(let e=0;e<t.children.length;e++)if(t.children[e].id==this.ignoreToolbarId)return;this.isHoverSpeakEnabled&&this.mouseOverEvent(e)})}setUpIFrameObserver(){this.targetElement=document.body;this.observer=new MutationObserver(this.observerFunction.bind(this)),this.observer.observe(this.targetElement,{childList:!0,subtree:!0})}observerFunction(e){e.forEach(function(e){[].filter.call(e.addedNodes,function(e){return"IFRAME"==e.nodeName||"SCRIPT"==e.nodeName}.bind(this)).forEach(function(e){"IFRAME"==e.nodeName?e.addEventListener("load",function(t){if(this.addEventsToFrame(e),u.tagPage){new fe(this).tagSentencesWithFramesImpl(e.contentWindow)}}.bind(this)):"SCRIPT"==e.nodeName&&e.src.includes("MathJax.js")&&e.addEventListener("load",function(t){this.forceLoadMath(e.ownerDocument.defaultView)}.bind(this))}.bind(this))}.bind(this))}addEventsToFrame(e){try{var t;e.document?t=e:e.contentWindow&&(t=e.contentWindow),null!=t&&(this.addEventsToWindow(t),this.checkForChildFrames(t),this.observer=new MutationObserver(this.observerFunction.bind(this)),this.observer.observe(t.document.body,{childList:!0,subtree:!0}),void 0!==t.MathJax&&(t.MathJax.Ajax.Load(this.url+"toMathML.js"),this.mathLoaded||(this.load_script(this.url+"sre_browser.js"),this.mathLoaded=!0)))}catch(e){}}checkForChildFrames(e){var t;if(e.frames.length>0)for(t=0;t<e.frames.length;t++)this.addEventsToFrame(e.frames[t])}setUpiframes(){if(window.frames.length>0)for(let e=0;e<window.frames.length;e++)try{this.addEventsToFrame(window.frames[e])}catch(e){}}iframeCallback(e){this.hoverSpeakOn&&this.speechCallback&&this.hoverSpeak.mouseMoved(e,this.speechCallback),this.clickToSpeakOn&&this.speechCallback&&this.clickToSpeak.mouseClick(e,this.speechCallback)}forceLoadMath(e){if(MathJax.version&&"function"==typeof MathJax.Ajax.Load){var t=window.MathJax;if(delete window.MathJax,window.MathJax=t,e){if(e.MathJax.version,"function"==typeof e.MathJax.Ajax.Load){t=e.MathJax;delete e.MathJax,e.MathJax=t;let r=!1;for(var n in e.MathJax.Ajax.loaded)if(n.indexOf("toMathML")>-1){r=!0;break}r||e.MathJax.Ajax.Load(this.url+"toMathML.js"),this.mathLoaded||(this.load_script(this.url+"sre_browser.js"),this.mathLoaded=!0)}}else if(!this.mathLoaded&&MathJax.version&&"function"==typeof MathJax.Ajax.Load){t=window.MathJax;delete window.MathJax,window.MathJax=t;let e=!1;for(var n in MathJax.Ajax.loaded)if(n.indexOf("toMathML")>-1){e=!0;break}e||MathJax.Ajax.Load(this.url+"toMathML.js"),this.load_script(this.url+"sre_browser.js"),this.mathLoaded=!0}}}pauseHover(){this.hoverSpeakOn||this.isHoverSpeakEnabled?(this.hoverSpeakOn=!1,this.isHoverSpeakEnabled=!0,this.pauseHoverTimer=setTimeout(()=>this.unPauseHover(),300)):this.isHoverSpeakEnabled=!1}unPauseHover(){this.isHoverSpeakEnabled&&(this.hoverSpeakOn=!0)}clearHoverSpeak(){this.hoverSpeak.clearHoverSpeak()}load_script(e){var t=document.createElement("script");t.type="text/javascript",t.src=e,t.className="MyInjectedScript",document.getElementsByTagName("head")[0].appendChild(t)}predictionEnabled(e){this.predictionOn=e}getPredictionCoordinates(){return this.predictionManager.getPredictionCoordinates()}getPredictionSentence(){return this.predictionManager.getPredictionSentence()}predictionInsertText(e,t,n,r){this.textareaParser.removeTextatCursor(n,"left",r,t),this.textareaInsertText(e,t)}textareaInsertText(e,t){this.textareaParser.insertText(e,t)}textareaGetText(e){return this.textareaParser.getText(e)}textareaGetCaretPosition(e){return this.textareaParser.getCaretPosition(e)}getInputElement(e){return this.textareaParser.getInputElement(e)}isEditable(){return this.predictionManager.isEditable()}predictionElement(e){let t={target:e};this.predictionManager.onMouseDown(t)}predictionSetSelectionRange(e,t,n){this.predictionManager.setSelectionRange(e,t,n)}hoverSpeakEnabled(e){this.hoverSpeakOn=e,this.isHoverSpeakEnabled=e,e||clearTimeout(this.pauseHoverTimer)}clickToSpeakEnabled(e){this.clickToSpeakOn=e}mouseOverEvent(e,t){this.speechCallback=t,this.isHoverSpeakEnabled?this.hoverSpeak.mouseMoved(e,this.speechCallback):clearTimeout(this.pauseHoverTimer)}mouseClickEvent(e,t){this.clickToSpeakOn&&this.clickToSpeak.mouseClick(e,t)}hasSelection(){return this.selectionController.hasSelection()}getWord(){var e=new Array,t=this.selectionController.getSelectionRange();if(t&&(e=t.toString().split(/\s/)).length>0)return e.length>2||1==e.length?new Array(e[0]):new Array(e[0],e[1]);return null}getSelection(){return this.selectionController.getSelectionRange().toString().split(/\s/)}getSelectionLocal(){return this.getSelection()}clearSelection_(){this.selectionController.clearSelection_()}clearBrowserSelection(){this.selectionController.clearBrowserSelection()}hiliteSelection(){var e=null;if(this.hasSelection()||this.hoverSpeakOn||this.clickToSpeakOn){if(this.sentenceNo=0,this.hoverSpeakOn){var t=this.hoverSpeak.getSelectionRange();this.speechObject.processRange(t,!0)}else if(this.clickToSpeakOn){t=this.clickToSpeak.getSelectionRange();this.speechObject.processRange(t,!0)}else this.speechObject.processRange(this.selectionController.getSelectionRange(),!1);(e=this.speechObject.getFirstSentence())&&""==e.getRawText()&&(e=this.speechObject.getNextSentence(!0))}else{let n;if(null!=u.playStartPoint&&""!=u.playStartPoint)if("string"==typeof u.playStartPoint)try{n=document.getElementById(u.playStartPoint)||document.body.children[0]}catch{n=document.body.children[0]}else try{n=u.playStartPoint||document.body.children[0]}catch{n=document.body.children[0]}else n=document.body.children[0];t=new R(n,0,n,0),this.speechObject.processRange(t,!0),e=this.speechObject.getCurrentSentence()}if(this.selectionController.clearBrowserSelection(),null!=e){this.speechObject.actOnCommand(e);var n=e.getWords();return 0==n.length?"":(this.speechHighlightManager=new U(e,this.highlightSettings),this.speechHighlightManager.highlightRange(),n)}return""}highlightElementById(e){let t=null;if(this.speechObject.processRange(this.selectionController.getElementRangeById(e),!1),t=this.speechObject.getFirstSentence(),t&&""==t.getRawText()&&(t=this.speechObject.getNextSentence(!0)),this.selectionController.clearBrowserSelection(),null!=t){let e=t.getWords();return 0==e.length?"":(this.speechHighlightManager=new U(t,this.highlightSettings),this.speechHighlightManager.highlightRange(),e)}return""}hiliteWord(e){this.speechHighlightManager.highlightWord(e)}stop(){null!=this.speechObject.getCurrentSentence()&&null!=this.speechHighlightManager&&this.speechHighlightManager.unHighlightRange(),this.hoverSpeak.clearHoverTags(),this.clickToSpeak.clearHoverTags()}hiliteNextSentence(e){null!=this.speechHighlightManager&&this.speechHighlightManager.unHighlightRange(),null!=this.hoverSpeak&&this.hoverSpeak.clearHoverTags();var t=this.speechObject.getNextSentence(e);this.speechObject.actOnCommand(t);var n=null;return null!=t&&(n=t.getWords(),this.speechHighlightManager=new U(t,this.highlightSettings),this.speechHighlightManager.highlightRange(t)),n}hilitePreviousSentence(e){null!=this.speechHighlightManager&&this.speechHighlightManager.unHighlightRange(),null!=this.hoverSpeak&&this.hoverSpeak.clearHoverTags();var t=this.speechObject.getPreviousSentence();this.speechObject.actOnCommand(t);var n=null;return null!=t&&(n=t.getWords(),this.speechHighlightManager=new U(t,this.highlightSettings),this.speechHighlightManager.highlightRange(t)),n}getLanguageForSentence(){return this.speechObject.getCurrentSentence().getLangTag()}loadPersistantHighlightToPage(e){null!=e&&this.studySkills.rw_retrieveHighlightDataForPKTReplyImpl(e,null)}restoreHighlights(){this.studySkills.rw_restoreHighlights()}removePersistantHighlight(e){return this.studySkills.studySkillsClearHighlights(e)}addPersistantHighlightToPage(e){return this.studySkills.studySkillsHTMLHighlightRange(e)}highlightSelection(e){var t=this.selectionController.getSelectionObject();this.studySkills.studySkillsHTMLHighlightRange(e,t)}clearHighlights(){var e=null;this.hasSelection()&&(e=this.selectionController.getSelectionObject()),this.studySkills.studySkillsClearHighlights(!1,e)}collectHighlights(e,t){var n=new Array;if(2==e)for(var r=0;r<t.length;r++)n.push(...this.studySkills.studySkillsCollateForColour(t[r]));else n.push(...this.studySkills.studySkillsCollateForPosition(t));return n}collectVocabWords(e){}notesCallbacks(e,t){this.notes.notesCallbacks(e,t)}loadNotes(e){this.notes.loadNotes(e)}removeNote(e){this.notes.rw_removeNote(e)}getNotePostion(e){return this.notes.rw_serialiseStickyNotesImpl(e)}createStickyNote(e){this.notes.rw_createStickyNote(e)}addVoiceNote(){}collectVocabs(e,t,n){return this.studySkills.fetchWords()}onMouseUp(e){}onMouseDown(e){this.predictionManager.onMouseDown(e)}onKeyDown(e){this.predictionManager.onKeyDown(e)}setWordHighlightStyle(e){this.highlightSettings.speechWordColour=e}setSentenceHighlightStyle(e){this.highlightSettings.speechRangeColour=e}getNewDomControl(e){return new we(e)}setAnnounceLinksAsWords(e){u.strAnnounceLinksAsWords=e}getAnnounceLinksAsWords(){return u.strAnnounceLinksAsWords}setBreakList(e,t){y(e,t)}setStyleList(e,t){C(e,t)}setMathSreSettings(e){u.mathSre=e}getMathSreSettings(){return u.mathSre}setPlayStartPoint(e){u.playStartPoint=e}getPlayStartPoint(){return u.playStartPoint}setReadAriaHidden(e){u.overrideAriaHidden=e}getReadAriaHidden(){return u.overrideAriaHidden}setAriaLabelOnMathRoleEnabled(e){u.ariaLabelOnMathRoleEnabled=e}getAriaLabelOnMathRoleEnabled(){return u.ariaLabelOnMathRoleEnabled}setAriaLabelOnMathJaxClassEnabled(e){u.ariaLabelOnMathJaxClassEnabled=e}getAriaLabelOnMathJaxClassEnabled(){return u.ariaLabelOnMathJaxClassEnabled}setWrapperTagClass(e){v(e)}setWrapperTag(e){w(e)}setHighlightTag(e){b(e)}setBreakList(e,t){y(e,t)}setStyleList(e,t){C(e,t)}}}}]);